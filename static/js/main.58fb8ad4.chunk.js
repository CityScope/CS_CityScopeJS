/*! For license information please see main.58fb8ad4.chunk.js.LICENSE.txt */
(this.webpackJsonpcityscopejs=this.webpackJsonpcityscopejs||[]).push([[0],{258:function(t,e){},343:function(t,e){},377:function(t,e){},502:function(t,e){},570:function(t,e,n){"use strict";n.r(e);var r=n(84),a=n.n(r),o=n(9),i=n(2),c=n(7),s=n(31),u=n(0),l=n(237),d=n.n(l),f=function(){var t=window.location,e="csjs_local"in d.a.parse(t.search)?"http://localhost:3000/CS_cityscopeJS/":"https://cityscope.media.mit.edu/CS_cityscopeJS/";return console.log("cityScopeJS location: ",e),e}(),h={docsURL:"https://raw.githubusercontent.com/CityScope/CS_cityscopeJS/master/docs/",cityIO:{baseURL:function(){var t=window.location,e="cityio_local"in d.a.parse(t.search)?"http://127.0.0.1:5000/api/":"https://cityio.media.mit.edu/api/";return console.log("cityIO server location: ",e),e}(),ListOfTables:"tables/list/",interval:500,cityIOmodules:[{name:"header",expectUpdate:!1},{name:"GEOGRID",expectUpdate:!1},{name:"ABM2",expectUpdate:!0},{name:"geojson",expectUpdate:!0},{name:"grid",expectUpdate:!1},{name:"access",expectUpdate:!0},{name:"GEOGRIDDATA",expectUpdate:!1},{name:"indicators",expectUpdate:!0},{name:"textual",expectUpdate:!0},{name:"scenarios",expectUpdate:!0},{name:"tui",expectUpdate:!0}]}},p={map:{mapStyle:{sat:"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true",blue:"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"},layers:{ABM:{endTime:86400,startTime:43200,animationSpeed:10}},initialViewState:{maxZoom:22,zoom:15,pitch:0,bearing:0}}},b={GRID_LAYER_CHECKBOX:{displayName:"CS Grid",cityIOmoduleName:"GEOGRID",initState:!0,initSliderValue:50},ABM_LAYER_CHECKBOX:{displayName:"Animated Trips",cityIOmoduleName:"ABM2",initState:!1,initSliderValue:100},AGGREGATED_TRIPS_LAYER_CHECKBOX:{displayName:"Aggregated Trips",cityIOmoduleName:"ABM2",initState:!1,initSliderValue:100},ACCESS_LAYER_CHECKBOX:{displayName:"Heatmap",cityIOmoduleName:"access",initState:!1,initSliderValue:100},TEXTUAL_LAYER_CHECKBOX:{displayName:"Text",cityIOmoduleName:"text",initState:!1,initSliderValue:100},GEOJSON_LAYER_CHECKBOX:{displayName:"GeoJson",cityIOmoduleName:"geojson",initState:!1,initSliderValue:50},MESH_LAYER_CHECKBOX:{displayName:"Mesh <beta>",cityIOmoduleName:"GEOGRID",initState:!1,initSliderValue:100}},j={ROTATE_CHECKBOX:{displayName:"Rotate Camera",initState:!1,initSliderValue:100},EFFECTS_CHECKBOX:{displayName:"Toggle Effects",initState:!1,initSliderValue:100},ANIMATION_CHECKBOX:{displayName:"Toggle Animation",initState:!1,initSliderValue:100}},O={RESET_VIEW_BUTTON:{displayName:"Reset View",initState:!1},ORTHO_VIEW_BUTTON:{displayName:"Ortho View",initState:!1},NORTH_VIEW_BUTTON:{displayName:"North View",initState:!1}},g={map:{mapStyle:{sat:"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true",dark:"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true",blue:"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"}},GEOGRIDDATA:{color:[0,0,0],height:0,id:0,interactive:"Web",name:"name"},GEOGRID:{features:[],properties:{header:{tableName:"test",cellSize:50,latitude:42.3664655,longitude:-71.0854323,tz:-5,ncols:20,nrows:20,rotation:0,projection:"+proj=lcc +lat_1=42.68333333333333 +lat_2=41.71666666666667 +lat_0=41 +lon_0=-71.5 +x_0=200000 +y_0=750000 +ellps=GRS80 +datum=NAD83 +units=m +no_def"},types:{Office:{LBCS:[{proportion:1,use:{2310:1}}],NAICS:[{proportion:1,use:{5400:1}}],interactive:"Web",color:"#FF5277",height:10,sqm_pperson:20},Park:{LBCS:[{proportion:1,use:{7240:1}}],NAICS:null,interactive:"Web",color:"#38C9FF",sqm_pperson:1},Residential:{LBCS:[{proportion:1,use:{1100:1}}],NAICS:null,interactive:"Web",color:"#FFFF33",height:4,sqm_pperson:90}}},type:"FeatureCollection"}},v=n(120),m=Object(v.b)({name:"cityIOdataState",initialState:{},cityIOisDone:!1,cityIOtableName:"",reducers:{updateCityIOdata:function(t,e){t.cityIOdata=e.payload},toggleCityIOisDone:function(t,e){t.cityIOisDone=e.payload},updateCityIOtableName:function(t,e){t.cityIOtableName=e.payload}}}),y=m.actions,x=y.updateCityIOdata,S=y.toggleCityIOisDone,w=y.updateCityIOtableName,E=m.reducer,C=n(30),I=n(168),L=n.n(I);function _(){_=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new S(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function f(){}function h(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=h.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=h,c(O,"constructor",h),c(h,"constructor",f),f.displayName=c(h,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,i,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},g(O),c(O,i,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var T=function(){var t=Object(s.a)(_().mark((function t(e){var n;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,L.a.get(e);case 3:return n=t.sent,t.abrupt("return",n.data);case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}();function M(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}var A=function(t){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/i.test(t)},G=function(t,e,n){var r=h.cityIO.baseURL+"table/"+e+n,a={method:"post",url:r,data:t,headers:{"Content-Type":"application/json",Accept:"application/json"}};L()(a).then((function(t){"ok"===t.data.status&&console.log("--\x3e cityIO endpoint ".concat(r," was updated <--"))})).catch((function(t){console.log("ERROR:",t)}))},k=h.cityIO.baseURL,N=function(){var t=Object(s.a)(_().mark((function t(e,n){var r,a;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,n);case 2:return r=t.sent,t.next=5,r.json();case 5:return a=t.sent,t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),R=function(){var t=Object(s.a)(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N("".concat(k,"table/").concat(e,"/meta/hashes/GEOGRIDDATA/"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),D=function(){var t=Object(s.a)(_().mark((function t(e){return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N("".concat(k,"module/").concat(e,"/"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P=n(395),B=n(220),F=n(370),z=n(1),U=function(t){var e=t.loadingModules;return Object(z.jsx)(z.Fragment,{children:e.map((function(t,e){return Object(z.jsxs)(P.a,{sx:{position:"fixed",bottom:10*(e+1),width:"100%",zIndex:1e4},children:[Object(z.jsx)(F.a,{color:"secondary"}),Object(z.jsxs)(B.a,{variant:"caption",color:"primary",style:{marginRight:"1vw"},children:["Loading ",t]})]},"box_"+t)}))})};function V(){V=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new S(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function f(){}function h(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=h.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=h,c(O,"constructor",h),c(h,"constructor",f),f.displayName=c(h,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,i,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},g(O),c(O,i,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var H=function(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),t},W=function(t){var e=h,n=Object(C.c)(),r=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),a=t.tableName,l=Object(u.useState)(null),d=Object(o.a)(l,2),f=d[0],p=d[1],b=Object(u.useState)({}),j=Object(o.a)(b,2),O=j[0],g=j[1],v=Object(u.useState)([]),m=Object(o.a)(v,2),y=m[0],w=m[1],E="".concat(e.cityIO.baseURL,"table/").concat(a,"/");function I(){return L.apply(this,arguments)}function L(){return(L=Object(s.a)(V().mark((function t(){var n;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T(E+"meta/id/");case 2:n=t.sent,f!==n&&p(n),setTimeout(I,e.cityIO.interval);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return _=Object(s.a)(V().mark((function t(){var o,s,u,l,d,f,h;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("--- starting update ---"),t.next=3,T(E+"meta/hashes/");case 3:return o=t.sent,s=[],u=[],(l=e.cityIO.cityIOmodules.map((function(t){return t.name}))).forEach((function(t){O[t]!==o[t]?(s.push(T("".concat(E).concat(t,"/"))),u.push(t)):s.push(null),w(u)})),t.next=10,Promise.all(s);case 10:d=t.sent,g(o),f=l.reduce((function(t,e,n){return d[n]?(w(H(y,e)),Object(c.a)(Object(c.a)({},t),{},Object(i.a)({},e,d[n]))):t}),r),h=Object(c.a)(Object(c.a)({},f),{},{tableName:a}),n(x(h)),console.log("--- done updating from cityIO ---"),n(S(!0));case 17:case"end":return t.stop()}}),t)}))),_.apply(this,arguments)}return Object(u.useEffect)((function(){var t=setTimeout(I,e.cityIO.interval);return console.log("reading cityIO every "+e.cityIO.interval+"ms"),function(){return clearTimeout(t)}}),[]),Object(u.useEffect)((function(){f&&function(){_.apply(this,arguments)}()}),[f]),Object(z.jsx)(U,{loadingModules:y})},X=n(672),Y=n(682),K=n(683),J=n(684),q=n(371),Q=n(669),Z=Object(v.b)({name:"menuState",initialState:{editMenuState:{},typesMenuState:{},layersMenuState:{},viewSettingsMenuState:{},animationMenuState:{toggleAnimationState:!1,animationSpeedSliderValue:10}},reducers:{updateLayersMenuState:function(t,e){t.layersMenuState=e.payload},updateTypesMenuState:function(t,e){t.typesMenuState=e.payload},updateEditMenuState:function(t,e){t.editMenuState=e.payload},updateViewSettingsMenuState:function(t,e){t.viewSettingsMenuState=e.payload},updateAnimationMenuState:function(t,e){t.animationMenuState=e.payload}}}),$=Z.actions,tt=$.updateLayersMenuState,et=$.updateTypesMenuState,nt=$.updateEditMenuState,rt=$.updateViewSettingsMenuState,at=($.updateAnimationMenuState,Z.reducer);function ot(){var t=Object(C.c)(),e=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})).GEOGRID.properties.types,n=Object(u.useState)(null),r=Object(o.a)(n,2),a=r[0],i=r[1],s=Object(u.useState)(0),l=Object(o.a)(s,2),d=l[0],f=l[1],h=[{value:0,label:"min"},{value:100,label:"max"}];Object(u.useEffect)((function(){t(et({SELECTED_TYPE:a}))}),[a]);var p=a&&a.LBCS,b=a&&a.NAICS,j=a&&a.description?a.description:null;return Object(z.jsx)(z.Fragment,{children:function(t){var e=[];return Object.keys(t).forEach((function(n,r){var o=t[n].color;"string"!==typeof o&&(o="rgb("+t[n].color[0]+","+t[n].color[1]+","+t[n].color[2]+")"),e.push(Object(z.jsxs)("div",{children:[Object(z.jsx)(X.a,{children:Object(z.jsx)(q.a,{fullWidth:!0,size:"small",variant:"outlined",sx:{"&.MuiButton-text":{color:{col:o}},border:"solid 1px "+o},onClick:function(){return e=t[n],r=n,e=Object(c.a)(Object(c.a)({},e),{},{thisTypeName:r}),d&&e.height&&(e=Object(c.a)(Object(c.a)({},e),{},{height:d})),void i(e);var e,r},children:Object(z.jsx)(B.a,{color:o,variant:"caption",children:n})},Math.random())},"li_menu_".concat(r)),a&&a.thisTypeName===n&&Object(z.jsx)(X.a,{children:Object(z.jsx)(Y.a,{sx:{width:"100%"},children:Object(z.jsxs)(K.a,{children:[j&&Object(z.jsx)(B.a,{variant:"caption",children:j}),a&&a.height&&Object(z.jsxs)("div",{children:[Object(z.jsx)(B.a,{children:"Set Height"}),Object(z.jsx)(Q.a,{valueLabelDisplay:"auto",value:d,size:"small",defaultValue:0,onChange:function(t,e){return f(e)},onChangeCommitted:function(){return i(Object(c.a)(Object(c.a)({},a),{},{height:d}))},min:h[0].value,max:h[1].value,marks:h},"li_types_slider_".concat(r))]},"li_types_div_".concat(r)),p&&Object(z.jsxs)("div",{children:[Object(z.jsx)(B.a,{children:"LBCS"}),Object(z.jsx)(B.a,{variant:"caption",children:JSON.stringify(p,null,"\t")})]}),b&&Object(z.jsxs)("div",{children:[Object(z.jsx)(B.a,{children:"NAICS"}),Object(z.jsx)(B.a,{variant:"caption",children:JSON.stringify(b,null,"\t")})]})]})},"li_types_card_".concat(r))},"li_types_card_".concat(r))]},"li_types_top_div_".concat(r)))})),Object(z.jsx)(J.a,{children:e})}(e)})}var it=n(676),ct=n(372),st=n(392);var ut=function(){var t=Object(C.c)(),e=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),n=Object.keys(e),r={},a=Object(u.useState)((function(){for(var t in b)r[t]={isOn:b[t].initState,slider:b[t].initSliderValue};return r})),s=Object(o.a)(a,2),l=s[0],d=s[1];Object(u.useEffect)((function(){t(tt(l))}),[l]);var f=Object(u.useState)({}),h=Object(o.a)(f,2),p=h[0],j=h[1],O=[];return Object(z.jsx)(it.a,{container:!0,children:function(){var t=function(t){var e=b[t].cityIOmoduleName;n.includes(e)&&O.push(Object(z.jsxs)(it.a,{container:!0,children:[Object(z.jsx)(it.a,{item:!0,xs:4,children:Object(z.jsx)(ct.a,{control:Object(z.jsx)(st.a,{checked:l[t]&&l[t].isOn,color:"primary",onChange:function(e){d(Object(c.a)(Object(c.a)({},l),{},Object(i.a)({},t,Object(c.a)(Object(c.a)({},l[t]),{},{isOn:e.target.checked}))))}},"checkbox_"+t),label:Object(z.jsx)(B.a,{variant:"caption",children:b[t].displayName},"label_"+t)},"formControl_"+t)},"grid_i_1_"+t),l[t]&&l[t].isOn&&Object(z.jsx)(it.a,{item:!0,xs:8,children:Object(z.jsx)(Q.a,{size:"small",valueLabelDisplay:"auto",onChangeCommitted:function(e,n){return function(t,e){j(Object(c.a)(Object(c.a)({},p),{},Object(i.a)({},t,e))),d(Object(c.a)(Object(c.a)({},l),{},Object(i.a)({},t,Object(c.a)(Object(c.a)({},l[t]),{},{slider:e}))))}(t,n)}},"slider_"+t)},"grid_i_2_"+t)]},"grid_con_"+t))};for(var e in b)t(e);return O}()})},lt=n(685);var dt=function(){var t=Object(C.c)(),e=Object(u.useState)((function(){var t={};for(var e in j)t[e]={isOn:j[e].initState,slider:j[e].initSliderValue&&j[e].initSliderValue};return t})),n=Object(o.a)(e,2),r=n[0],a=n[1];Object(u.useLayoutEffect)((function(){t(rt(r))}),[r]);var s=Object(u.useState)({}),l=Object(o.a)(s,2),d=l[0],f=l[1];return Object(z.jsxs)(J.a,{children:[function(t){var e=[],n=function(n){e.push(Object(z.jsx)(q.a,{size:"small",onClick:function(){return function(t){a(Object(c.a)(Object(c.a)({},r),{},{VIEW_CONTROL_BUTTONS:t}))}(n)},children:t[n].displayName},Math.random()))};for(var o in t)n(o);return Object(z.jsx)(lt.a,{color:"primary",children:e})}(O),function(t){var e=[],n=function(n){var o=t[n].initSliderValue;e.push(Object(z.jsxs)("div",{children:[Object(z.jsxs)(X.a,{children:[Object(z.jsx)(st.a,{checked:r[n]&&r[n].isOn,name:n,onChange:function(t){return a(Object(c.a)(Object(c.a)({},r),{},Object(i.a)({},n,Object(c.a)(Object(c.a)({},r[n]),{},{isOn:t.target.checked}))))}},"viewSettingCheckBox_"+n),Object(z.jsx)(B.a,{variant:"caption",children:t[n].displayName},"viewSettingCaption_"+n)]},"viewSettingListItem_"+n),o&&r[n]&&r[n].isOn&&Object(z.jsx)(X.a,{children:Object(z.jsx)(Q.a,{size:"small",valueLabelDisplay:"auto",onChangeCommitted:function(t,e){return function(t,e){f(Object(c.a)(Object(c.a)({},d),{},Object(i.a)({},t,e))),a(Object(c.a)(Object(c.a)({},r),{},Object(i.a)({},t,Object(c.a)(Object(c.a)({},r[t]),{},{slider:e}))))}(n,e)}},"viewSettingSlider_"+n)},"viewSettingListItemSlider_"+n)]},"viewSettingDiv_"+n))};for(var o in t)n(o);return e}(j)]})},ft=n(20),ht=n(373),pt=n(374),bt=n(670),jt=n(645),Ot=n(648),gt=n(686),vt=n(687),mt=n(688),yt=n(275),xt=n.n(yt);function St(){St=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new S(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function f(){}function h(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=h.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=h,c(O,"constructor",h),c(h,"constructor",f),f.displayName=c(h,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,i,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},g(O),c(O,i,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function wt(){var t=Object(u.useState)([]),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(u.useState)(!1),i=Object(o.a)(a,2),c=i[0],l=i[1],d=Object(u.useState)(),f=Object(o.a)(d,2),h=f[0],p=f[1],b=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),j=Object(C.d)((function(t){return t.cityIOdataState.cityIOtableName})),O=function(){l(!1)},g=function(){var t=Object(s.a)(St().mark((function t(){return St().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(h){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,D(h.hash).then((function(t){G(t,j,"/GEOGRIDDATA/")})).finally((function(){O()}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),v=function(){return b.scenarios.map((function(t,e){return Object(z.jsxs)(X.a,{children:[Object(z.jsx)(ht.a,{arrow:!0,placement:"right",title:t.description||"No description",children:Object(z.jsx)(q.a,{fullWidth:!0,size:"small",variant:"outlined",onClick:function(){return function(t){p(t),l(!0)}(t)},children:Object(z.jsx)(B.a,{variant:"caption",children:t.name.substring(0,12)+"..."})},"scenario_button_"+e)},"scenario_tt_"+e),Object(z.jsx)(pt.a,{onClick:function(e){!function(t){var e=Object(ft.a)(b.scenarios),n=e.filter((function(e){return e.hash===t.hash})),r=e.indexOf(n[0]);-1!==r&&e.splice(r,1),G(e,j,"/scenarios/")}(t)},"aria-label":"delete",size:"small",children:Object(z.jsx)(xt.a,{color:"primary",fontSize:"inherit"},"scenario_delicon_"+e)},"scenario_ib_"+e)]},"scenario_grid_item_".concat(e))}))};return Object(u.useEffect)((function(){if(b.scenarios){var t=v();r(t)}}),[b]),Object(z.jsxs)(it.a,{sx:{flexGrow:1},container:!0,children:[Object(z.jsx)(bt.a,{sx:{width:"100%"},badgeContent:b.scenarios&&b.scenarios.length||0,color:"primary",children:Object(z.jsx)(q.a,{fullWidth:!0,variant:"outlined",onClick:function(){R(j).then((function(t){var e={name:"".concat(t),hash:t,description:"this is ".concat(t," description")},n=b.scenarios?Object(ft.a)(b.scenarios):[];n.push(e),G(n,j,"/scenarios/")}))},children:Object(z.jsx)(B.a,{children:"Save This Scenario"})},"save_state_button")}),Object(z.jsx)(J.a,{children:n}),Object(z.jsxs)(jt.a,{open:c,onClose:O,children:[Object(z.jsx)(Ot.a,{id:"alert-dialog-title",children:"Revert to saved scenario?"}),Object(z.jsx)(gt.a,{children:Object(z.jsx)(vt.a,{id:"alert-dialog-description",children:"You can revert to this saved scenario by clicking the button below. Reverting will delete all changes made since the last commit."})}),Object(z.jsxs)(mt.a,{children:[Object(z.jsx)(q.a,{onClick:O,children:"Cancel"}),Object(z.jsx)(q.a,{onClick:g,autoFocus:!0,children:"Revert"})]})]})]})}var Et=n(677),Ct=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)-1;function It(t){var e=t.children,n=t.direction,r=t.width,a=Math.floor(Ct/4),i=Object(u.useState)(r||a),c=Object(o.a)(i,2),s=c[0],l=c[1],d=function t(){document.removeEventListener("mouseup",t,!0),document.removeEventListener("mousemove",f,!0)},f=Object(u.useCallback)((function(t){var e=null;(e="right"===n?document.body.offsetLeft+document.body.offsetWidth-t.clientX+20:document.body.offsetLeft+t.clientX+20)>50&&e<Ct&&l(e)}),[]);return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(P.a,{onMouseDown:function(t){return document.addEventListener("mouseup",d,!0),void document.addEventListener("mousemove",f,!0)},sx:{width:"".concat(5,"px"),padding:"5px 0 0",position:"fixed",height:"1000vh",left:"left"===n?s+"px":void 0,right:"right"===n?s+"px":void 0,zIndex:1,cursor:"ew-resize",backgroundColor:"gray"}}),Object(z.jsx)(Et.a,{anchor:n,open:!0,variant:"persistent",ModalProps:{keepMounted:!0},PaperProps:{style:{width:s}},sx:{display:"flex",flexDirection:"column"},children:e})]})}var Lt=n(332),_t=n.n(Lt),Tt=n(278),Mt=n.n(Tt);function At(){var t=Object(C.c)(),e=Object(u.useState)({EDIT_BUTTON:!1}),n=Object(o.a)(e,2),r=n[0],a=n[1];return Object(u.useEffect)((function(){t(nt(r))}),[r]),Object(z.jsx)(q.a,{fullWidth:!0,id:"EDIT_BUTTON",variant:"outlined",endIcon:r.EDIT_BUTTON?Object(z.jsx)(Mt.a,{}):Object(z.jsx)(_t.a,{}),onClick:function(t){return e=t,void a(Object(c.a)(Object(c.a)({},r),{},Object(i.a)({},e.currentTarget.id,!r[e.currentTarget.id])));var e},children:Object(z.jsx)(B.a,{children:r.EDIT_BUTTON?"submit edits":"start editing"})})}var Gt=function(){var t=Object(C.d)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(B.a,{gutterBottom:!0,children:"CityScope"}),Object(z.jsx)(B.a,{variant:"h3",children:t})]})},kt=function(){var t=Object(C.c)(),e=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})).tui,n=Object(C.d)((function(t){return t.menuState})).layersMenuState;return Object(u.useEffect)((function(){if(e)for(var r in e)t(tt(Object(c.a)(Object(c.a)({},n),{},Object(i.a)({},r,Object(c.a)(Object(c.a)({},n[r]),{},{isOn:e[r]})))))}),[e]),Object(z.jsx)(z.Fragment,{})};var Nt=function(){var t=[Object(z.jsx)(Gt,{}),Object(z.jsx)(At,{}),Object(z.jsx)(ot,{}),Object(z.jsx)(wt,{}),Object(z.jsx)(ut,{}),Object(z.jsx)(dt,{})],e=function(){var e=[];return t.forEach((function(t,n){e.push(Object(z.jsx)(X.a,{children:Object(z.jsx)(Y.a,{variant:"outlined",sx:{width:"100%"},children:Object(z.jsx)(K.a,{children:t})})},n))})),e};return Object(z.jsxs)(It,{direction:"left",width:300,children:[Object(z.jsx)(kt,{}),Object(z.jsx)(J.a,{children:Object(z.jsx)(e,{})})]})},Rt=n(10),Dt=n(407),Pt=n.n(Dt),Bt=function(t){if(!t.mousePos||!t.hoveredCells)return null;var e=t.selectedType,n=t.hoveredCells.object.properties.interactive,r=t.mousePos,a=t.divSize,o=e.color;A(o)&&(o=M(o));var i="rgb("+o[0]+","+o[1]+","+o[2]+")",c="rgba("+o[0]+","+o[1]+","+o[2]+",0.6)",s=r.clientX-a/2,u=r.clientY-a/2,l=n?e.name:": Not-interactive";return Object(z.jsx)("div",{style:{border:"2px solid",backgroundColor:t.mouseDown?c:"rgba(0,0,0,0)",borderColor:i,color:i,borderRadius:"15%",position:"fixed",zIndex:10,pointerEvents:"none",width:a,height:a,left:s,top:u,fontFamily:"Roboto Mono"},children:Object(z.jsxs)("div",{style:{position:"relative",left:a+10,fontSize:"0.8em"},children:[!n&&Object(z.jsx)(Pt.a,{}),l]})})},Ft=function(t){if(!t.mousePos)return null;var e=t.mousePos,n=t.hoveredObj;return Object(z.jsxs)("div",{style:{borderRadius:"10%",position:"fixed",pointerEvents:"none",backgroundColor:"rgba(0,0,0,0.5)",padding:"1vw",color:"rgba(255,255,255,0.9)",zIndex:10,left:e.clientX,top:e.clientY},children:[Object(z.jsxs)(B.a,{children:["Type: ",n.object.properties.name]}),Object(z.jsxs)(B.a,{children:["Height: ",n.object.properties.height]}),Object(z.jsxs)(B.a,{children:["ID: ",n.object.properties.id]})]})};function zt(t){var e=t.editOn,n=t.mousePos,r=t.selectedType,a=t.pickingRadius,o=t.mouseDown,i=t.hoveredObj,c=function(){return e&&r&&Object.keys(r).length&&i?Object(z.jsx)(Bt,{mousePos:n,selectedType:r,divSize:a,mouseDown:o,hoveredCells:i}):i?Object(z.jsx)(Ft,{mousePos:n,hoveredObj:i}):null};return Object(z.jsx)(c,{})}var Ut=n(163),Vt=n(661),Ht=(n(257),n(346)),Wt=n(665);function Xt(t){var e=t.data,n=t.opacity,r=e.access&&e.access.features;return new Wt.a({id:"ACCESS",colorRange:[[233,62,58],[237,104,60],[243,144,63],[253,199,12],[255,243,59]],intensity:n,threshold:.5,data:r&&r,getPosition:function(t){return t.geometry.coordinates},getWeight:function(t){return t.properties[0]},updateTriggers:{getWeight:[0]}})}var Yt=n(345);function Kt(t){var e=t.data,n=t.ABMmode,r=t.opacity;if(e.ABM2)return new Yt.a({id:"AGGREGATED_TRIPS",shadowEnabled:!1,data:e.ABM2.trips,getPath:function(t){return t.path},getColor:function(t){return M(e.ABM2.attr.mode[t.mode].color)},opacity:r,getWidth:5,updateTriggers:{getColor:n},transitions:{getColor:500}})}var Jt=n(654);function qt(t){var e,n=t.data,r=t.ABMmode,a=t.zoomLevel,o=t.time,i=t.opacity;if(n.ABM2)return new Jt.a({opacity:i,id:"ABM",data:n.ABM2.trips,getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},getColor:function(t){return M(n.ABM2.attr.mode[t.mode].color)},shadowEnabled:!1,getWidth:1,widthScale:(e=a,e>15&&e<25?3:e<15&&e>10?12:30),trailLength:500,currentTime:o,updateTriggers:{getColor:r},transitions:{getColor:500}})}var Qt=n(663),Zt=function(t,e,n,r,a){var o=e.height,i=e.color,c=e.name,s=function(t,e,n){var r=e,a=t.x-r/2,o=t.y-r/2;return n.current.pickObjects({x:a,y:o,width:r,height:r})}(t,r,a);s.forEach((function(t){var e=t.object.properties;e&&e.interactive&&(e.color=A(i)?M(i):i,e.height=o,e.name=c)})),n(s)},$t=function(t){var e=t.GEOGRID,n=JSON.parse(JSON.stringify(e));if(t.GEOGRIDDATA&&t.GEOGRIDDATA.length===t.GEOGRID.features.length)for(var r=t.GEOGRIDDATA,a=0;a<e.features.length;a++)n.features[a].properties=r[a],n.features[a].properties=Object(c.a)(Object(c.a)({},n.features[a].properties),{},{id:a});return n};function te(t){var e=t.data,n=t.editOn,r=t.state,a=r.selectedType,o=r.keyDownState,i=r.selectedCellsState,c=r.pickingRadius,s=r.opacity,u=t.updaters,l=u.setSelectedCellsState,d=u.setDraggingWhileEditing,f=u.setHoveredObj,h=t.deckGLref;return new Qt.a({opacity:s,id:"GRID",data:e,pickable:!0,extruded:!0,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:2,getElevation:function(t){return t.properties.height},getFillColor:function(t){return t.properties.color},onClick:function(t){a&&n&&"Shift"!==o&&Zt(t,a,l,c,h)},onDrag:function(t){a&&n&&"Shift"!==o&&Zt(t,a,l,c,h)},onDragStart:function(){a&&n&&"Shift"!==o&&d(!0)},onHover:function(t){t.object&&f(t)},onDragEnd:function(){d(!1)},updateTriggers:{getFillColor:i,getElevation:i},transitions:{getFillColor:300,getElevation:300}})}var ee=n(423);function ne(t){var e=t.data,n=t.coordinates,r=t.opacity;if(e&&e.text){var a=[];return e.text.forEach((function(t){a.push({coordinates:[n.features[t.id].geometry.coordinates[0][0][0],n.features[t.id].geometry.coordinates[0][0][1],100],info:t.info})})),new ee.a({opacity:r,id:"text-layer",data:a,pickable:!0,getPosition:function(t){return t.coordinates},getText:function(t){return t.info},getColor:[255,255,255],getSize:30,getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"center"})}}function re(t){var e=t.data,n=t.opacity;if(e.geojson)return new Qt.a({id:"GeojsonLayer",data:e.geojson,opacity:n,pickable:!0,wireframe:!1,stroked:!0,filled:!0,extruded:!0,lineWidthScale:1,getFillColor:function(t){return M(t.properties.fill)},getLineColor:function(t){return M(t.properties.stroke)},lineWidthMinPixels:2,getElevation:function(t){return t.properties.height},updateTriggers:{getFillColor:e,getElevation:e},transitions:{getFillColor:500,getElevation:500}})}var ae=n(674),oe=n(420);function ie(t){var e=t.data,n=t.opacity;if(e&&e.features)return new ae.a({id:"mesh-layer",data:e.features,loaders:[oe.a],mesh:"./obj/model.obj",getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2]},getColor:function(t){return[255,255,255,255]},getOrientation:function(t){return[-180,90*Math.ceil(4*Math.random()),-90]},getScale:function(t){return t.properties.height>0?[e.properties.header.cellSize/2,n*t.properties.height,e.properties.header.cellSize/2]:[0,0,0]},updateTriggers:{getScale:n}})}var ce=n(413),se=n(679);function ue(){var t=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(C.d)((function(t){return t.menuState})),n=Object(u.useState)(!1),r=Object(o.a)(n,2),a=r[0],i=r[1],s=Object(u.useState)(),l=Object(o.a)(s,2),d=l[0],f=l[1],h=Object(u.useState)(p.map.initialViewState),b=Object(o.a)(h,2),j=b[0],O=b[1],g=Object(u.useState)(),v=Object(o.a)(g,2),m=v[0],y=v[1],x=Object(u.useState)(),S=Object(o.a)(x,2),w=S[0],E=S[1],I=Object(u.useState)(),L=Object(o.a)(I,2),_=L[0],T=L[1],M=Object(u.useState)(),A=Object(o.a)(M,2),k=A[0],N=A[1],R=Object(u.useState)(),D=Object(o.a)(R,2),P=D[0],B=D[1],F=Object(u.useRef)(),U=e.editMenuState.EDIT_BUTTON,V=e.typesMenuState.SELECTED_TYPE,H=e.layersMenuState,W=e.viewSettingsMenuState.VIEW_CONTROL_BUTTONS,X=e.viewSettingsMenuState.EFFECTS_CHECKBOX,Y=e.viewSettingsMenuState.ANIMATION_CHECKBOX,K=Object(u.useState)(0),J=Object(o.a)(K,2),q=J[0],Q=J[1],Z=Object(u.useState)({}),$=Object(o.a)(Z,1)[0],tt=function t(){Y&&Y.isOn&&(Q((function(t){return t>p.map.layers.ABM.endTime?p.map.layers.ABM.startTime:t+Y.slider})),$.id=window.requestAnimationFrame(t))};!Y||Y.isOn||window.cancelAnimationFrame($.id),Object(u.useEffect)((function(){return $.id=window.requestAnimationFrame(tt),function(){window.cancelAnimationFrame($.id)}}),[Y]);var et=Object(u.useState)((function(){return[]})),nt=Object(o.a)(et,2),rt=nt[0],at=nt[1];Object(u.useEffect)((function(){if(X&&X.isOn){var t=new ce.a({color:[255,255,255],intensity:1}),e=new se.a({timestamp:Date.UTC(2019,7,1,X.slider%24),color:[255,255,255],intensity:1,_shadow:!0}),n=new Ht.a({ambientLight:t,dirLight:e});n.shadowColor=[0,0,0,.8],at([n])}else at([])}),[X]);var ot=function(e){var n=t.GEOGRID.features[t.GEOGRID.features.length-1].geometry.coordinates[0][0],r=t.GEOGRID.features[0].geometry.coordinates[0][0],a=[(r[0]+n[0])/2,(r[1]+n[1])/2],o=t.GEOGRID.properties.header;O(Object(c.a)(Object(c.a)({},j),{},{longitude:a[0],latitude:a[1],zoom:"RESET_VIEW_BUTTON"===e?15:j.zoom,pitch:0,bearing:"NORTH_VIEW_BUTTON"===e?0:360-o.rotation,orthographic:"ORTHO_VIEW_BUTTON"===e}))};Object(u.useEffect)((function(){ot(W)}),[W]),Object(u.useEffect)((function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()})),ot()}),[]),Object(u.useEffect)((function(){B($t(t))}),[t.GEOGRIDDATA]),Object(u.useEffect)((function(){if(!U&&P){for(var e=[],n=0;n<P.features.length;n++)e[n]=P.features[n].properties;G(e,t.tableName,"/GEOGRIDDATA/")}}),[U]);var it={ABM:qt({data:t,ABMmode:0,zoomLevel:j.zoom,time:q,opacity:H&&H.ABM_LAYER_CHECKBOX&&.01*H.ABM_LAYER_CHECKBOX.slider}),AGGREGATED_TRIPS:Kt({data:t,ABMmode:0,opacity:H&&H.AGGREGATED_TRIPS_LAYER_CHECKBOX&&.01*H.AGGREGATED_TRIPS_LAYER_CHECKBOX.slider}),GRID:te({data:P,editOn:U,state:{selectedType:V,keyDownState:m,selectedCellsState:d,pickingRadius:40,opacity:H&&H.GRID_LAYER_CHECKBOX&&.01*H.GRID_LAYER_CHECKBOX.slider},updaters:{setSelectedCellsState:f,setDraggingWhileEditing:i,setHoveredObj:N},deckGLref:F}),ACCESS:Xt({data:t,opacity:H&&H.ACCESS_LAYER_CHECKBOX&&.01*H.ACCESS_LAYER_CHECKBOX.slider}),TEXTUAL:ne({data:t,coordinates:P&&P,opacity:H&&H.TEXTUAL_LAYER_CHECKBOX&&.01*H.TEXTUAL_LAYER_CHECKBOX.slider}),GEOJSON:re({data:t,opacity:H&&H.GEOJSON_LAYER_CHECKBOX&&.01*H.GEOJSON_LAYER_CHECKBOX.slider}),MESH:ie({data:P,opacity:H&&H.MESH_LAYER_CHECKBOX&&.01*H.MESH_LAYER_CHECKBOX.slider})},ct=["GRID","TEXTUAL","MESH","GEOJSON","ACCESS","AGGREGATED_TRIPS","ABM"];return Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)("div",{onKeyDown:function(t){y(t.nativeEvent.key)},onKeyUp:function(){return y(null)},onMouseMove:function(t){return E(t.nativeEvent)},onMouseUp:function(){return T(!1)},onMouseDown:function(){return T(!0)},children:[Object(z.jsx)(zt,{editOn:U,mousePos:w,selectedType:V,pickingRadius:40,mouseDown:_,hoveredObj:k}),Object(z.jsx)(Vt.a,{ref:F,viewState:j,effects:rt,onViewStateChange:function(t){var e=t.viewState;e.orthographic="ORTHO_VIEW_BUTTON"===W,O(e)},layers:function(){var t,e=[],n=Object(Rt.a)(ct);try{for(n.s();!(t=n.n()).done;){var r=t.value;H&&H[r+"_LAYER_CHECKBOX"]&&H[r+"_LAYER_CHECKBOX"].isOn&&e.push(it[r])}}catch(a){n.e(a)}finally{n.f()}return e}(),controller:{touchZoom:!0,touchRotate:!0,dragPan:!a,dragRotate:!a,keyboard:!1},children:Object(z.jsx)(Ut.c,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:p.map.mapStyle.sat,preventStyleDiffing:!0})})]})})}var le=n(50),de=n(216),fe={scales:{r:{angleLines:{color:"#696969"},grid:{color:"#696969",circular:!0},pointLabels:{color:"#C0C0C0"},ticks:{color:"#696969"}}}},he={scales:{r:{angleLines:{color:"#363636"},grid:{color:"#363636",circular:!0},pointLabels:{color:"#363636"},ticks:{color:"#363636"}}}},pe={labels:[null,null,null],datasets:[{label:"No indicator data...",data:[null,null,null],backgroundColor:"#363636",borderColor:"#363636",borderWidth:1}]};function be(){le.f.register(le.q,le.n,le.k,le.h,le.t,le.i);var t=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(u.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1];return Object(u.useEffect)((function(){if(t.indicators){var e=function(t){for(var e={labels:[],datasets:[{label:"Project Values",data:[],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1},{label:"Reference Values",data:[],backgroundColor:"rgba(0, 33, 132, 0.2)",borderColor:"rgba(0, 99, 255, 1)",borderWidth:1}]},n=0;n<t.length;n++)"radar"===t[n].viz_type&&(e.labels.push(t[n].name),e.datasets[0].data.push(t[n].value),e.datasets[1].data.push(t[n].ref_value));return e}(t.indicators);a(e)}else a(pe)}),[t]),Object(z.jsx)(z.Fragment,{children:r&&Object(z.jsx)(de.c,{data:r,options:t.indicators?fe:he})})}le.f.register(le.e,le.l,le.c,le.s,le.t,le.i);var je={scales:{r:{angleLines:{color:"#696969"},grid:{color:"#696969",circular:!0},pointLabels:{color:"#C0C0C0"},ticks:{color:"#696969"}}},responsive:!0},Oe={labels:["no data..."],datasets:[{label:"No indicator data...",data:[0],backgroundColor:"#696969"}]};function ge(){var t=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(u.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1];Object(u.useEffect)((function(){if(t.indicators){var e=i(t.indicators);a(e)}else a(Oe)}),[t]);var i=function(t){for(var e={labels:[],datasets:[{label:"Chart Data",data:[],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]},n=0;n<t.length;n++)"bar"===t[n].viz_type&&(e.labels.push(t[n].name),e.datasets[0].data.push(t[n].value));return e};return Object(z.jsx)(z.Fragment,{children:r&&Object(z.jsx)(de.a,{options:je,data:r||Oe})})}function ve(){var t=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(u.useState)({labels:[],datasets:[]}),n=Object(o.a)(e,2),r=n[0],a=n[1];le.f.register(le.a,le.t,le.i);var i=t.GEOGRIDDATA;return Object(u.useEffect)((function(){t.GEOGRID.properties&&function(){var t={labels:[],datasets:[{label:"Area Calculation",data:[],backgroundColor:[],borderColor:[],borderWidth:1}]};i.forEach((function(e){var n=e.name;if(n&&"None"!==n&&""!==n||(n="Unknown type..."),t.labels.includes(n)){var r=t.labels.indexOf(n);t.datasets[0].data[r]=(e.height&&e.height,t.datasets[0].data[r]+1)}else t.labels.push(n),t.datasets[0].data.push(0),t.datasets[0].backgroundColor.push("rgba(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],", 0.2)")),t.datasets[0].borderColor.push("rgba(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],", 0.8)"))})),a(t)}()}),[t]),Object(z.jsx)(z.Fragment,{children:i&&Object(z.jsx)(de.b,{data:r})})}var me=function(){return Object(z.jsx)(It,{direction:"right",width:300,children:Object(z.jsx)(P.a,{sx:{margin:1},children:Object(z.jsxs)(it.a,{container:!0,spacing:1,direction:"row",children:[Object(z.jsx)(it.a,{item:!0,xs:12,xl:8,children:Object(z.jsx)(Y.a,{variant:"outlined",sx:{width:"100%"},children:Object(z.jsx)(K.a,{children:Object(z.jsx)(be,{})})})}),Object(z.jsx)(it.a,{item:!0,xs:12,xl:4,children:Object(z.jsx)(Y.a,{variant:"outlined",sx:{width:"100%"},children:Object(z.jsx)(K.a,{children:Object(z.jsx)(ve,{})})})}),Object(z.jsx)(it.a,{item:!0,xs:12,xl:4,children:Object(z.jsx)(Y.a,{variant:"outlined",sx:{width:"100%"},children:Object(z.jsx)(K.a,{children:Object(z.jsx)(ge,{})})})})]})})})};function ye(){var t=Object(C.d)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(C.d)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(z.jsxs)(z.Fragment,{children:[!t&&Object(z.jsx)(U,{loadingModules:[e]}),e&&Object(z.jsx)(W,{tableName:e}),t&&Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(ue,{}),Object(z.jsx)(Nt,{}),Object(z.jsx)(me,{})]})]})}var xe=n(660),Se=n(681),we={fontFamily:'"Roboto Mono", sans-serif',fontSize:11,fontWeightLight:100,fontWeightRegular:500,fontWeightMedium:700,h1:{fontWeight:700,fontSize:45,letterSpacing:"-1px"},h2:{fontWeight:800,fontSize:29,letterSpacing:"-0.24px"},h3:{fontWeight:700,fontSize:24,letterSpacing:"-0.06px"},h4:{fontWeight:500,fontSize:20,letterSpacing:"-0.06px"},h5:{fontWeight:500,fontSize:16,letterSpacing:"-0.05px"},h6:{fontWeight:500,fontSize:14,letterSpacing:"-0.05px"},overline:{fontWeight:500}},Ee=n(119),Ce=Object(Ee.b)({typography:we,palette:{mode:"dark",primary:{main:"#FFF",light:"#ff5278"},secondary:{main:"#ff5278"},text:{primary:"#fff",secondary:"#ff5278"}},shape:{borderRadius:10},overrides:{MuiOutlinedInput:{notchedOutline:{borderColor:"#ff5278"}}}}),Ie=n(15);function Le(){var t=Object(u.useState)(0),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(Ie.a)(F.a)((function(t){t.theme;return{height:10}}));return Object(u.useEffect)((function(){var t=setInterval((function(){r((function(t){if(100===t)return 0;var e=10*Math.random();return Math.min(t+e,100)}))}),500);return function(){clearInterval(t)}}),[]),Object(z.jsx)(P.a,{sx:{width:"100%",position:"fixed",bottom:"0px"},children:Object(z.jsx)(a,{variant:"determinate",value:n})})}function _e(){_e=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new S(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function f(){}function h(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=h.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=h,c(O,"constructor",h),c(h,"constructor",f),f.displayName=c(h,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,i,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},g(O),c(O,i,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function Te(t){var e=t.getTablesList,n=Object(u.useState)([]),r=Object(o.a)(n,2),a=r[0],i=r[1],c=Object(u.useState)(!0),l=Object(o.a)(c,2),d=l[0],f=l[1];Object(u.useEffect)((function(){a&&e(a)}),[a]);var p=function(){var t=Object(s.a)(_e().mark((function t(){var e,n,r;return _e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.cityIO.baseURL+h.cityIO.ListOfTables,t.next=3,L.a.get(e);case 3:n=t.sent,r=n.data.map(function(){var t=Object(s.a)(_e().mark((function t(e){var n;return _e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(h.cityIO.baseURL,"table/").concat(e,"/"),t.abrupt("return",L.a.get("".concat(n,"GEOGRID/properties/header/")).then((function(t){return i((function(r){return[].concat(Object(ft.a)(r),[{tableURL:n,tableName:e,tableHeader:t.data}])}))})).catch((function(t){return console.log(t.toString())})));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Promise.all(r).then((function(){return f(!1),a}));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(u.useEffect)((function(){p()}),[]),Object(z.jsx)(z.Fragment,{children:d&&Object(z.jsx)(Le,{})})}var Me=n(378),Ae=n(671),Ge=n(678);function ke(t){var e=t.clicked,n=f+"?cityscope=",r=f+"?projection=",a=Object(u.useState)(!1),i=Object(o.a)(a,2),c=i[0],s=i[1];Object(u.useEffect)((function(){s(!0)}),[e]);var l=function(){s(!1)};return Object(z.jsxs)(jt.a,{open:c,onClose:l,"aria-labelledby":"table-select-dialog-title","aria-describedby":"table-select-dialog-description",children:[Object(z.jsxs)(Ot.a,{id:"table-select-dialog-title",children:["CityScope ",e.tableName]}),Object(z.jsx)(gt.a,{children:Object(z.jsx)(vt.a,{id:"table-select-dialog-description",children:Object(z.jsxs)(B.a,{component:"span",children:[Object(z.jsx)(Ge.a,{href:n+e.tableName.toLowerCase(),children:"Go to project"}),", ",Object(z.jsx)(Ge.a,{href:r+e.tableName.toLowerCase(),children:"project this table to TUI"})," ","or"," ",Object(z.jsx)(Ge.a,{target:"blank",href:e.tableURL,children:"view raw data on cityIO."})]})})}),Object(z.jsx)(mt.a,{children:Object(z.jsx)(q.a,{onClick:l,children:"(x) Close"})})]})}function Ne(t){var e=t.tablesList,n=Object(u.useState)(null),r=Object(o.a)(n,2),a=r[0],i=r[1],s={options:e,getOptionLabel:function(t){return t.tableName}};return Object(z.jsxs)(z.Fragment,{children:[a&&Object(z.jsx)(ke,{clicked:a}),Object(z.jsx)(Ae.a,Object(c.a)(Object(c.a)({},s),{},{disablePortal:!0,id:"combo-box-demo",options:e,sx:{width:300},renderInput:function(t){return Object(z.jsx)(Me.a,Object(c.a)(Object(c.a)({},t),{},{label:"Search CityScope Project..."}))},onChange:function(t,e){i(e)}}))]})}var Re=n(415),De=n.n(Re),Pe=n(33),Be=n(689),Fe=n(662),ze=n(657),Ue=n(673),Ve=n(680),He=n(297),We=n.p+"static/media/legoio.148c5ab6.png";function Xe(t){var e=Object(u.useState)([]),n=Object(o.a)(e,2),r=n[0],a=n[1],i=Object(u.useState)(),c=Object(o.a)(i,2),s=c[0],l=c[1],d=Object(u.useState)(),f=Object(o.a)(d,2),h=f[0],p=f[1],b={longitude:-71.060929,latitude:42.3545259,zoom:1,pitch:0,bearing:0,zHeight:2e6},j=Object(u.useState)(b),O=Object(o.a)(j,2),g=O[0],v=O[1],m=Object(u.useState)(g),y=Object(o.a)(m,2),x=y[0],S=y[1],w=!1;Object(u.useEffect)((function(){p(b.zoom),document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()}))}),[b.zoom]),Object(u.useEffect)((function(){var e=[];t.cityIOdata.forEach((function(t,n){e.push({tableURL:t.tableURL,tableName:t.tableName,index:n,tableHeader:t.tableHeader,coord:{from:[t.tableHeader.longitude,t.tableHeader.latitude],to:[t.tableHeader.longitude+n/10,t.tableHeader.latitude+n/10,b.zHeight]}})})),a(e)}),[t,b.zHeight]);var E=[new Fe.a({data:"https://basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,tileSize:96,renderSubLayers:function(t){var e=t.tile.bbox,n=e.west,r=e.south,a=e.east,o=e.north;return new Ue.a(t,{data:null,image:t.data,_imageCoordinateSystem:Pe.a.CARTESIAN,bounds:[n,r,a,o]})}}),new Ve.a({id:"LineLayer",data:r,pickable:!0,getWidth:h<2?.5:0,getSourcePosition:function(t){return t.coord.from},getTargetPosition:function(t){return t.coord.to},getColor:function(t){return[255,82,120]}}),new ee.a({id:"text-layer",data:r,pickable:!0,getPosition:function(t){return t.coord.to},getText:function(t){return t.tableName},getColor:[255,82,120],getSize:h<2?0:10,getAngle:0,getPixelOffset:[10,5],getTextAnchor:"start",getAlignmentBaseline:"center"}),new He.a({id:"icon-layer",data:r,pickable:!0,iconAtlas:We,onClick:function(t){S({longitude:t.object.coord.to[0],latitude:t.object.coord.to[1],zoom:3,pitch:0,bearing:0,transitionDuration:1e3,transitionInterpolator:new ze.a}),l(t)},iconMapping:{marker:{x:0,y:0,width:768,height:768,mask:!1}},getIcon:function(t){return"marker"},sizeScale:1,getSize:h<5?20:10,getPosition:function(t){return[t.coord.to[0],t.coord.to[1],b.zHeight]}})];return Object(z.jsxs)(z.Fragment,{children:[s&&s.object&&Object(z.jsx)(ke,{clicked:s.object}),Object(z.jsx)(Vt.a,{views:new Be.a,onHover:function(t){var e=t.object;return w=Boolean(e)},getCursor:function(t){return t.isDragging?"grabbing":w?"crosshair":"grab"},layers:E,controller:!0,initialViewState:x,onViewportChange:v,onViewStateChange:function(t){return p(t.viewState.zoom)},ContextProvider:Ut.b.Provider})]})}function Ye(){var t=Object(u.useState)([]),e=Object(o.a)(t,2),n=e[0],r=e[1];return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Xe,{cityIOdata:n}),Object(z.jsxs)(P.a,{sx:{width:"100%",padding:5},children:[Object(z.jsx)(Te,{getTablesList:r}),Object(z.jsxs)(it.a,{container:!0,spacing:2,children:[Object(z.jsx)(it.a,{item:!0,xs:12,children:Object(z.jsx)(Ne,{tablesList:n})}),Object(z.jsxs)(it.a,{item:!0,xs:12,lg:6,zIndex:10,children:[Object(z.jsx)(B.a,{variant:"h1",children:"MIT CityScope"}),Object(z.jsxs)(B.a,{variant:"h4",children:["MIT CityScope is an open-source urban modeling and simulation platform. CityScope allows users to examine different design alternatives, and observe their impact through multiple layers of urban analytics.",Object(z.jsx)(Ge.a,{href:"https://github.com/CityScope",target:"blank",children:"Join the CityScope open-source development"}),"  ",Object(z.jsx)(De.a,{fontSize:"small"})]})]})]})]})]})}function Ke(t){var e=t.editMode,n=Object(u.useRef)(null),r=p,a=Object(u.useState)(),i=Object(o.a)(a,2),s=i[0],l=i[1],d=Object(C.d)((function(t){return t.cityIOdataState.cityIOdata})),f=d.GEOGRID.properties.header;Object(u.useEffect)((function(){if(document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()})),localStorage.getItem("projectionViewStateStorage")){console.log("loading prev. projectionViewStateStorage...");var t=localStorage.getItem("projectionViewStateStorage");l(JSON.parse(t))}else l(Object(c.a)(Object(c.a)({},s),{},{longitude:f.longitude,latitude:f.latitude,zoom:15,pitch:0,bearing:360-f.rotation,orthographic:!0}))}),[]);var h=Object(u.useState)(r.map.layers.ABM.startTime),b=Object(o.a)(h,2),j=b[0],O=b[1],g=Object(u.useState)({}),v=Object(o.a)(g,1)[0],m=function t(){O((function(t){return t>r.map.layers.ABM.endTime?r.map.layers.ABM.startTime:t+r.map.layers.ABM.animationSpeed})),v.id=window.requestAnimationFrame(t)};Object(u.useEffect)((function(){return v.id=window.requestAnimationFrame(m),function(){return window.cancelAnimationFrame(v.id)}}),[v]);var y=[new Qt.a({id:"GRID",data:$t(d),opacity:.5,extruded:!1,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:5,getFillColor:function(t){return t.properties.color},transitions:{getFillColor:500}}),new Wt.a({id:"ACCESS",colorRange:[[233,62,58],[237,104,60],[243,144,63]],intensity:.8,threshold:.5,data:d.access&&d.access.features,getPosition:function(t){return t.geometry.coordinates},getWeight:function(t){return t.properties[0]},updateTriggers:{getWeight:[0]}}),new ee.a({id:"text",data:d.GEOGRID&&d.GEOGRID.features,getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2]},getText:function(t){return t.properties.name.length>10?t.properties.name.substring(0,7)+"...":t.properties.name},getColor:function(t){return[0,0,0]},getSize:8}),new Jt.a({id:"ABM",data:d.ABM2&&d.ABM2.trips,getColor:function(t){return M(d.ABM2.attr.mode[t.mode].color)},getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},fadeTrail:!0,getWidth:10,trailLength:200,currentTime:j})];return Object(z.jsx)(Vt.a,{ref:n,viewState:s,onViewStateChange:function(t){var e=t.viewState;localStorage.setItem("projectionViewStateStorage",JSON.stringify(e)),l(Object(c.a)(Object(c.a)({},e),{},{pitch:0,orthographic:!0}))},layers:y,controller:{keyboard:!1},children:!e&&Object(z.jsx)(Ut.c,{width:"100%",height:"100%",asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:r.map.mapStyle.blue,preventStyleDiffing:!0})})}var Je=n(5),qe=n(6),Qe=n(12),Ze=n(13),$e=20/1.5,tn={container:{width:20,height:20,borderRadius:"50%",position:"absolute",border:"1px solid white",cursor:"move"},"top-left":{left:-$e,top:-$e},"bottom-left":{left:-$e,bottom:-$e},"top-right":{top:-$e,right:-$e},"bottom-right":{bottom:-$e,right:-$e}},en=function(t){var e,n=t.position,r=t.translation,a=t.onMouseEnter,o=t.onMouseDown,i=t.onMouseUp,s=t.className,u=void 0===s?"":s,l=t.style,d=void 0===l?{}:l;return Object(z.jsx)("div",{onMouseEnter:function(){return a&&a(n)},onMouseDown:function(t){return o(t,n)},onMouseUp:function(){return i(n)},className:u,style:Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)({},tn.container),tn[n]),d),{},{transform:(e=r,"translate(".concat(e[0],"px, ").concat(e[1],"px)"))})})},nn=n(504).solve,rn=function(t,e){for(var n=[],r=[],a=0,i=t.length;a<i;++a){var c=Object(o.a)(t[a],2),s=c[0],u=c[1],l=Object(o.a)(e[a],2),d=l[0],f=l[1];n.push([s,u,1,0,0,0,-s*d,-u*d],[0,0,0,s,u,1,-s*f,-u*f]),r.push(d,f)}var h=nn(n,r,!0);return[h[0],h[3],0,h[6],h[1],h[4],0,h[7],0,0,1,0,h[2],h[5],0,1].map((function(t){return function(t,e){var n=Math.pow(10,e),r=t*n;return Math.round(r)/n}(t,10)}))},an=function(t){return"matrix3d(".concat(t.join(", "),")")},on={position:"relative"},cn=["top-left","top-right","bottom-right","bottom-left"],sn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],un=function(){var t={};return cn.forEach((function(e){t[e]=[0,0]})),t},ln=function(t){Object(Qe.a)(n,t);var e=Object(Ze.a)(n);function n(){var t;Object(Je.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))).container=void 0,t.layerTranslateDelta=void 0,t.anchorTranslateDelta=void 0,t.isAnchorDragging=!1,t.targetPoints=void 0,t.anchorMoving=void 0,t.state={matrix:sn,translateDelta:un(),sourcePoints:void 0,transformOrigin:[0,0],containerTranslate:[t.props.x||0,t.props.y||0]},t.onAnchorMouseDown=function(e,n){e.stopPropagation(),t.anchorTranslateDelta=[e.pageX-t.state.translateDelta[n][0],e.pageY-t.state.translateDelta[n][1]],t.anchorMoving=n},t.onAnchorMouseMove=function(e){if(t.anchorTranslateDelta&&t.state.sourcePoints&&t.anchorMoving){e.preventDefault(),e.stopPropagation();var n=cn.indexOf(t.anchorMoving),r=e.pageX-t.anchorTranslateDelta[0],a=e.pageY-t.anchorTranslateDelta[1];t.targetPoints[n]=[t.state.sourcePoints[n][0]+r,t.state.sourcePoints[n][1]+a],t.setState({matrix:rn(t.state.sourcePoints,t.targetPoints),translateDelta:Object(c.a)(Object(c.a)({},t.state.translateDelta),{},Object(i.a)({},t.anchorMoving,[r,a]))})}},t.onAnchorMouseUp=function(e){t.anchorTranslateDelta=void 0,t.anchorMoving=void 0},t.onMouseUp=function(){t.layerTranslateDelta=void 0},t.onMouseMove=function(e){if(t.layerTranslateDelta&&t.props.isEditMode){var n=[e.pageX-t.layerTranslateDelta[0],e.pageY-t.layerTranslateDelta[1]];t.setState({containerTranslate:n})}},t.onMouseDown=function(e){var n=t.state.containerTranslate;t.layerTranslateDelta=[e.pageX-n[0],e.pageY-n[1]]},t}return Object(qe.a)(n,[{key:"componentDidMount",value:function(){if(window.addEventListener("mousemove",this.onAnchorMouseMove),window.addEventListener("mousemove",this.onMouseMove),this.container){var t=this.container.getBoundingClientRect(),e=t.width,n=t.height,r=[[0,0],[e-0,0],[e-0,n-0],[0,n-0]];if(this.targetPoints=[].concat(r),this.setState({sourcePoints:r}),localStorage.getItem("projMap")){console.log("loading prev. projMap...");var a=localStorage.getItem("projMap");this.setState(JSON.parse(a))}}}},{key:"componentDidUpdate",value:function(t,e){localStorage.setItem("projMap",JSON.stringify(e))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onAnchorMouseMove),window.removeEventListener("mousemove",this.onMouseMove)}},{key:"render",value:function(){var t,e=this,n=this.props,r=n.style,a=n.isEditMode,o=n.className,i=n.anchorStyle,s=n.anchorClassName,u=this.state,l=u.translateDelta,d=u.matrix,f=u.containerTranslate,h=u.transformOrigin;return Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)("div",{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,style:{cursor:a?"all-scroll":"inherit",position:"relative",display:"inline-block",transform:(t=f,"translate(".concat(t[0],"px, ").concat(t[1],"px)"))},children:[Object(z.jsx)("div",{ref:function(t){e.container=t},style:Object(c.a)(Object(c.a)(Object(c.a)({},on),r),{},{pointerEvents:a?"none":"all",transform:an(d),transformOrigin:"".concat(h[0],"px ").concat(h[1],"px 0px")}),className:o,children:this.props.children}),a&&Object(z.jsx)("div",{children:cn.map((function(t,n){return Object(z.jsx)(en,{style:i,className:s,translation:l[t],position:t,onMouseDown:e.onAnchorMouseDown,onMouseUp:e.onAnchorMouseUp},t)}))})]})})}}]),n}(u.Component);function dn(){return Object(z.jsx)(it.a,{container:!0,alignItems:"center",justify:"center",children:Object(z.jsx)(q.a,{sx:{zIndex:"tooltip",top:"50vh",left:"50vw"},variant:"contained",startIcon:Object(z.jsx)(xt.a,{}),children:"Reset Projection Mapping"})})}function fn(){var t=Object(u.useState)(!1),e=Object(o.a)(t,2),n=e[0],r=e[1];return Object(u.useEffect)((function(){console.log("Keystone starting...");var t=function(t){" "===t.key&&r((function(t){return!t}))};return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}),[n]),Object(z.jsxs)(z.Fragment,{children:[n&&Object(z.jsx)("div",{onClick:function(){return localStorage.getItem("projMap")&&localStorage.removeItem("projMap"),localStorage.getItem("projectionViewStateStorage")&&localStorage.removeItem("projectionViewStateStorage"),void window.location.reload()},children:Object(z.jsx)(dn,{})}),Object(z.jsx)("div",{style:{height:"100vh",width:"100vw",overflow:"hidden",position:"fixed",top:0,left:0,zIndex:1e3},children:Object(z.jsx)("div",{children:Object(z.jsx)(ln,{style:{height:"100vh",width:"100vw",backgroundColor:n?"rgba(255,0,0)":null},isEditMode:n,children:Object(z.jsx)(Ke,{editMode:n})})})})]})}function hn(){var t=Object(C.d)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(C.d)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(z.jsxs)(z.Fragment,{children:[e&&Object(z.jsx)(W,{tableName:e}),t&&Object(z.jsx)(fn,{})]})}function pn(t){if(!t.mousePos)return null;var e=t.mousePos,n=t.mouseDown,r=t.selectedType,a=t.divSize,o=e.x-a/2,i=e.y-a/2;return Object(z.jsx)("div",{style:{border:"2px solid",backgroundColor:n?r.color:"rgba(0,0,0,0)",borderColor:r.color,color:r.color,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:a,height:a,left:o||0,top:i||0},children:Object(z.jsx)("div",{style:{position:"relative",left:a+10,fontSize:"0.5em"},children:r.name})})}var bn=Object(v.b)({name:"menuState",initialState:{editorMapCenter:{latitude:g.GEOGRID.properties.header.latitude,longitude:g.GEOGRID.properties.header.longitude},gridMaker:{},gridProps:{},typesEditorState:{}},reducers:{updateEditorMapCenter:function(t,e){t.editorMapCenter=e.payload},updateGridProps:function(t,e){t.gridProps=e.payload},updateGridMaker:function(t,e){t.gridMaker=e.payload},updateTypesEditorState:function(t,e){t.typesEditorState=e.payload}}}),jn=bn.actions,On=jn.updateEditorMapCenter,gn=jn.updateGridProps,vn=jn.updateGridMaker,mn=jn.updateTypesEditorState,yn=bn.reducer;function xn(){var t=Object(C.c)(),e=Object(u.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1],i=Object(C.d)((function(t){return t.editorMenuState.typesEditorState.selectedRow})),s=Object(C.d)((function(t){return t.editorMenuState.gridMaker}));Object(u.useEffect)((function(){a(s)}),[s]);var l=Object(C.d)((function(t){return t.editorMenuState.editorMapCenter})),d=Object(u.useRef)(null);Object(u.useEffect)((function(){P(l)}),[l]);var f=Object(u.useState)(g.map.initialViewState),h=Object(o.a)(f,2),p=h[0],b=h[1],j=Object(u.useState)(),O=Object(o.a)(j,2),v=O[0],m=O[1],y=Object(u.useState)(),x=Object(o.a)(y,2),S=x[0],w=x[1],E=Object(u.useState)(),I=Object(o.a)(E,2),L=I[0],_=I[1],T=Object(u.useState)(!1),G=Object(o.a)(T,2),k=G[0],N=G[1],R=Object(u.useState)(),D=Object(o.a)(R,1)[0],P=function(t){b(Object(c.a)(Object(c.a)({},p),{},{latitude:t&&t.latCenter||g.GEOGRID.properties.header.latitude,longitude:t&&t.lonCenter||g.GEOGRID.properties.header.longitude,zoom:15,pitch:0,bearing:0,orthographic:!0}))};Object(u.useEffect)((function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()})),P()}),[]);var B=function(t){if(i){var e=i.height,n=i.name,r=i.color,o=i.interactive,s=function(t){var e=t.x-20,n=t.y-20;return d.current.pickObjects({x:e,y:n,width:40,height:40})}(t);s.forEach((function(t,i){var s=Object(c.a)({},t.object.properties);s.color=A(r)?M(r):r,s.height=parseInt(e),s.name=n,"No"!==o?s.interactive=o:delete s.interactive,a((function(e){return Object(c.a)(Object(c.a)({},e),{},{features:e.features.map((function(e){return t.index===e.properties.id?Object(c.a)(Object(c.a)({},e),{},{properties:s}):e}))})}))}))}};return Object(z.jsxs)("div",{onKeyDown:function(t){m(t.nativeEvent.key)},onKeyUp:function(){m(null)},onMouseMove:function(t){return w(t.nativeEvent)},onMouseUp:function(){t(vn(r)),_(!1)},onMouseDown:function(){return _(!0)},children:[i&&Object(z.jsx)(pn,{mousePos:S,selectedType:i,divSize:40,mouseDown:L}),Object(z.jsx)(Vt.a,{ref:d,viewState:p,onViewStateChange:function(t){var e=t.viewState;b(e)},layers:[new Qt.a({id:"GRID",opacity:.5,stroked:!1,filled:!0,wireframe:!0,visible:!0,pickable:!0,data:r,extruded:!0,lineWidthScale:1,lineWidthMinPixels:1,getElevation:function(t){return t.properties.height},getFillColor:function(t){return t.properties.color},onClick:function(t,e){e.rightButton||"Shift"===v||B(t)},onDrag:function(t,e){e.rightButton||"Shift"===v||B(t)},onDragStart:function(t,e){e.rightButton||"Shift"===v||N(!0)},onDragEnd:function(){N(!1)},updateTriggers:{getFillColor:D,getElevation:D}})],controller:{touchZoom:!0,touchRotate:!0,dragPan:!k,dragRotate:!k,keyboard:!1},children:Object(z.jsx)(Ut.a,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:g.map.mapStyle.sat,preventStyleDiffing:!0})})]})}var Sn=n(658),wn=n(416),En=n.n(wn);function Cn(t){var e=Object(C.c)();return Object(z.jsx)(q.a,{onClick:function(){e(On({latCenter:parseFloat(t.mapCenter[0]),lonCenter:parseFloat(t.mapCenter[1])}))},variant:"outlined",startIcon:Object(z.jsx)(En.a,{}),children:"Center Map to Grid"})}function In(){var t=g,e=Object(C.c)(),n=Object(u.useState)({tableName:t.GEOGRID.properties.header.tableName,latitude:t.GEOGRID.properties.header.latitude,longitude:t.GEOGRID.properties.header.longitude,tz:t.GEOGRID.properties.header.tz,nrows:t.GEOGRID.properties.header.nrows,ncols:t.GEOGRID.properties.header.nrows,rotation:t.GEOGRID.properties.header.rotation,cellSize:t.GEOGRID.properties.header.cellSize,projection:t.GEOGRID.properties.header.projection}),r=Object(o.a)(n,2),a=r[0],s=r[1],l=function(t){var e=t.target,n=e.id,r=e.value;s(Object(c.a)(Object(c.a)({},a),{},Object(i.a)({},n,r)))};return Object(u.useEffect)((function(){e(gn(a))}),[a]),Object(z.jsxs)(J.a,{children:[Object(z.jsx)(X.a,{children:Object(z.jsx)(B.a,{variant:"h4",children:"Project Properties"})}),Object(z.jsx)(X.a,{children:Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"tableName",label:"CityScope Project Name",defaultValue:a.tableName})}),Object(z.jsx)(X.a,{children:Object(z.jsxs)(Sn.a,{direction:"row",spacing:1,children:[Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"latitude",label:"Latitude",defaultValue:a.latitude,type:"number"}),Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"longitude",label:"Longitude",defaultValue:a.longitude,type:"number"}),Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"tz",label:"Time Zone (GMT)",defaultValue:a.tz,type:"number"})]})}),Object(z.jsx)(X.a,{children:Object(z.jsx)(Cn,{mapCenter:[a.latitude,a.longitude]})}),Object(z.jsx)(X.a,{children:Object(z.jsxs)(Sn.a,{direction:"row",spacing:1,children:[Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"nrows",label:"Rows",defaultValue:a.nrows,type:"number",InputProps:{inputProps:{max:100,min:0}}}),Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"ncols",label:"Columns",defaultValue:a.ncols,type:"number",InputProps:{inputProps:{max:100,min:0}}}),Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"rotation",label:"Rotation (deg)",defaultValue:a.rotation,type:"number",InputProps:{inputProps:{max:360,min:0}}}),Object(z.jsx)(Me.a,{onChange:function(t){return l(t)},variant:"outlined",id:"cellSize",label:"Cell Size (m^2)",defaultValue:a.cellSize,type:"number",InputProps:{inputProps:{max:1e3,min:1}}})]})}),Object(z.jsx)(X.a,{children:Object(z.jsx)(Me.a,{size:"small",onChange:function(t){return l(t)},variant:"outlined",id:"projection",label:"Projection",defaultValue:a.projection,type:"string",helperText:"Default projection should work for most CityScope cases. Find specific projections at: https://epsg.io/"})})]})}var Ln=n(417),_n=n.n(Ln),Tn=n(691),Mn=n(251);function An(t){return t*Math.PI/180}function Gn(t){return 180*t/Math.PI}var kn=function(t){var e=Object.keys(t);return t[e[e.length*Math.random()<<0]]};function Nn(){var t=Object(C.c)(),e=Object(u.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1],i=Object(u.useState)(!1),c=Object(o.a)(i,2),s=c[0],l=c[1],d=Object(C.d)((function(t){return t.editorMenuState.gridProps})),f=Object(C.d)((function(t){return t.editorMenuState.typesEditorState.tableData}));Object(u.useEffect)((function(){t(vn(r))}),[r]);var h=function(){a(function(t,e){for(var n=parseFloat(t.longitude),r=parseFloat(t.latitude),a=parseFloat(t.rotation),o=t.projection,i=parseFloat(t.cellSize),c=parseFloat(t.nrows),s=parseFloat(t.ncols),u=Mn.a.defs("EPSG:4326"),l={lon:n,lat:r},d=(90-a+360)%360,f=i*s/6371e3,h=An(l.lat),p=An(l.lon),b=An(d),j=Math.asin(Math.sin(h)*Math.cos(f)+Math.cos(h)*Math.sin(f)*Math.cos(b)),O={lon:Gn(p+Math.atan2(Math.sin(b)*Math.sin(f)*Math.cos(h),Math.cos(f)-Math.sin(h)*Math.sin(j))),lat:Gn(j)},g=Object(Mn.a)(u,o,[l.lon,l.lat]),v=Object(Mn.a)(u,o,[O.lon,O.lat]),m=(v[1]-g[1])/(v[0]-g[0]),y=Math.atan(m),x=Math.cos(y),S=Math.sin(y),w=[],E=[],C=0;C<c;C++)for(var I=0;I<s;I++)w.push(I*i),E.push(-C*i);for(var L=[],_=[],T=0;T<w.length;T++)L.push(w[T]*x-E[T]*S),_.push(w[T]*S+E[T]*x);for(var A=[],G=[],k=0;k<L.length;k++)A.push(g[0]+L[k]),G.push(g[1]+_[k]);for(var N=A[1]-A[0],R=G[1]-G[0],D=A[s]-A[0],P=G[s]-G[0],B=[],F={type:"FeatureCollection",features:[]},z=e,U=0;U<A.length;U++){for(var V=kn(z),H={type:"Feature",geometry:{type:"Polygon",coordinates:null},properties:{color:M(V.color),height:V.height,name:V.name,interactive:V.interactive,id:U}},W=[[A[U],G[U]],[A[U]+D,G[U]+P],[A[U]+D+N,G[U]+P+R],[A[U]+N,G[U]+R],[A[U],G[U]]],X=[],Y=0;Y<5;Y++){var K=Object(Mn.a)(o,u,W[Y]);X.push(K)}H.geometry.coordinates=[X],B.push(H)}return F.features=B,F}(d,f))};return Object(z.jsx)(z.Fragment,{children:d&&f&&Object(z.jsx)(Tn.a,{onClick:function(){l(!0),new Promise((function(t){setTimeout((function(){l(!1),h()}),100),t()}))},loading:s,loadingPosition:"start",variant:"outlined",startIcon:Object(z.jsx)(_n.a,{}),children:"Generate Grid"})})}var Rn=n(418),Dn=n.n(Rn),Pn={columns:[{title:"Type",field:"name"},{title:"Description",field:"description"},{title:"Height",field:"height",type:"numeric"},{title:"Interactive",field:"interactive",lookup:{No:"No",Web:"Web",TUI:"TUI"}},{title:"Color",field:"color",type:"string"},{title:"LBCS",field:"LBCS",type:"string"},{title:"NAICS",field:"NAICS",type:"string"}],data:function(t){var e=[];return Object.keys(t).forEach((function(n,r){e.push({id:r,name:n,description:"[edit info for type: "+n+"]",color:t[n].color,height:t[n].height?t[n].height:0,LBCS:t[n].LBCS?JSON.stringify(t[n].LBCS):null,NAICS:t[n].NAICS?JSON.stringify(t[n].NAICS):null,interactive:t[n].interactive})})),e}(g.GEOGRID.properties.types)};function Bn(){var t=Object(u.useState)(Pn),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(C.c)(),i=Object(u.useState)(),s=Object(o.a)(i,2),l=s[0],d=s[1],f=Object(u.useState)(),h=Object(o.a)(f,2),p=h[0],b=h[1];return Object(u.useEffect)((function(){a(mn({tableData:n.data,selectedRow:l,rowColor:p}))}),[n,l,p]),Object(z.jsx)(Dn.a,{title:Object(z.jsx)(B.a,{variant:"h4",children:"Types Editor"}),columns:n.columns,data:n.data,options:{paging:!1,search:!0,selection:!1,rowStyle:function(t){return{backgroundColor:l&&l.tableData.id===t.tableData.id?p:null}}},onRowClick:function(t,e){d(e),b(e.color)},editable:{onRowAdd:function(t){return new Promise((function(e){e(),setTimeout((function(){r((function(e){var n=Object(ft.a)(e.data);return t.id=n.length,n.push(t),Object(c.a)(Object(c.a)({},e),{},{data:n})}))}),50)}))},onRowUpdate:function(t,e){return new Promise((function(n){n(),setTimeout((function(){e&&r((function(n){var r=Object(ft.a)(n.data),a=r.map((function(t){return t.id})).indexOf(e.id);return r[a]=t,Object(c.a)(Object(c.a)({},n),{},{data:r})}))}),50)}))}}})}function Fn(){var t=Object(u.useState)(!1),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(u.useState)(),i=Object(o.a)(a,2),s=i[0],l=i[1],d=Object(C.d)((function(t){return t.editorMenuState.gridProps})),f=Object(C.d)((function(t){return t.editorMenuState.typesEditorState.tableData})),p=Object(C.d)((function(t){return t.editorMenuState.gridMaker})),b=p&&p.features&&p.features.length>0,j=function(){var t,e,n=g.GEOGRID,r=p.features,a=function(t,e,n,r){var a=Object(c.a)({},t),o={};return e.forEach((function(t){o[t.name]=Object(c.a)({},t),o[t.name].LBCS="string"===typeof t.LBCS?JSON.parse(t.LBCS):t.LBCS,o[t.name].NAICS="string"===typeof t.NAICS?JSON.parse(t.NAICS):t.NAICS})),a.properties.types=o,a.properties.header=Object(c.a)({},r),["longitude","latitude","rotation","nrows","ncols","cellSize"].forEach((function(t){a.properties.header[t]=parseFloat(a.properties.header[t])})),a.features=n,a}(n,f,r,d),o=function(t){var e=[];return t.forEach((function(t){e.push(t.properties)})),e}(r),i=a.properties.header.tableName.toLowerCase(),s="".concat(h.cityIO.baseURL,"table/").concat(i,"/"),u={GEOGRID:a,GEOGRIDDATA:o};L()((t=s,e=u,{method:"post",url:t,data:e,headers:{"Content-Type":"application/json",Accept:"application/json"}})).then((function(t){l(function(t,e){var n="https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+e;return Object(z.jsxs)(B.a,{color:"textPrimary",variant:"caption",children:["CityIO is ",t.data.status,". Grid deployed to"," ",Object(z.jsx)(Ge.a,{color:"textSecondary",href:n,children:n})]})}(t,i))})).catch((function(t){return console.log("ERROR: ".concat(t))}))};return Object(z.jsx)(z.Fragment,{children:b&&Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(Tn.a,{onClick:function(){r(!0),new Promise((function(t){setTimeout((function(){r(!1),j()}),1500),t()}))},loading:n,loadingPosition:"start",variant:"outlined",startIcon:Object(z.jsx)(Mt.a,{}),children:"Commit Grid to cityIO"}),Object(z.jsxs)("div",{style:{width:"100%"},children:[" ",s]})]})})}function zn(){var t=[Object(z.jsx)(B.a,{variant:"h2",children:"CityScope Grid Editor"}),Object(z.jsx)(B.a,{children:"This editor can create and `commit` spatial layouts (`grids`) as a baseline for CityScope projects. Use the menus and map to edit girds, types, and props, and commit them to cityIO."}),Object(z.jsx)(In,{}),Object(z.jsxs)(it.a,{container:!0,spacing:2,children:[Object(z.jsx)(it.a,{item:!0,children:Object(z.jsx)(Nn,{})}),Object(z.jsx)(it.a,{item:!0,children:Object(z.jsx)(Fn,{})})]}),Object(z.jsx)(Bn,{})],e=function(){var e=[];return t.forEach((function(t,n){e.push(Object(z.jsx)(X.a,{children:Object(z.jsx)(Y.a,{variant:"outlined",sx:{width:"100%"},children:Object(z.jsx)(K.a,{children:t})})},n))})),e};return Object(z.jsx)(It,{direction:"left",width:500,children:Object(z.jsx)(J.a,{children:Object(z.jsx)(e,{})})})}function Un(){return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(zn,{}),Object(z.jsx)(xn,{})]})}var Vn=function(){var t=Object(C.c)(),e=Object(u.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1];Object(u.useEffect)((function(){document.title=r?"CityScopeJS | ".concat(r):"CityScopeJS"}),[r]);var i=Object(u.useState)(),c=Object(o.a)(i,2),s=c[0],l=c[1],f=function(e,n){var r=n&&n.toLowerCase();r&&""!==r?(a(r),t(w(r)),l(e)):l("cityio")};return Object(u.useEffect)((function(){var t=window.location,e=d.a.parse(t.search),n=Object.keys(e);n.includes("cityscope")?f("cityscopejs",e.cityscope):n.includes("projection")?f("projection"):n.includes("editor")?l("grideditor"):l("cityio")}),[]),Object(z.jsxs)(Se.a,{theme:Ce,children:[Object(z.jsx)(xe.a,{}),Object(z.jsxs)(z.Fragment,{children:["cityscopejs"===s&&Object(z.jsx)(ye,{}),"grideditor"===s&&Object(z.jsx)(Un,{}),"cityio"===s&&Object(z.jsx)(Ye,{}),"projection"===s&&Object(z.jsx)(hn,{})]})]})},Hn=n(73),Wn=Object(v.b)({name:"menuState",initialState:{animationTime:0},reducers:{updateAnimationTimeState:function(t,e){t.animationTime=e.payload}}}),Xn=(Wn.actions.updateAnimationTimeState,Wn.reducer),Yn=Object(Hn.c)({cityIOdataState:E,menuState:at,editorMenuState:yn,animationState:Xn}),Kn=Object(v.a)({reducer:Yn});a.a.render(Object(z.jsx)(z.Fragment,{children:Object(z.jsx)(C.a,{store:Kn,children:Object(z.jsx)(Vn,{})})}),document.getElementById("root"))}},[[570,1,2]]]);
//# sourceMappingURL=main.58fb8ad4.chunk.js.map