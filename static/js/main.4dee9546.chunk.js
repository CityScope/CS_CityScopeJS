/*! For license information please see main.4dee9546.chunk.js.LICENSE.txt */
(this.webpackJsonpcityscopejs=this.webpackJsonpcityscopejs||[]).push([[0],{29:function(e){e.exports=JSON.parse('{"docsURL":"https://raw.githubusercontent.com/CityScope/CS_cityscopeJS/master/docs/","SOCKETS":{"URL":"ws://localhost:8080"},"cityIO":{"baseURL":"https://cityio.media.mit.edu/api/table/","ListOfTables":"https://cityio.media.mit.edu/api/tables/list/","interval":500,"cityIOmodules":[{"name":"header","expectUpdate":false},{"name":"GEOGRID","expectUpdate":false},{"name":"ABM2","expectUpdate":true},{"name":"grid","expectUpdate":false},{"name":"access","expectUpdate":true},{"name":"GEOGRIDDATA","expectUpdate":false},{"name":"indicators","expectUpdate":true},{"name":"textual","expectUpdate":true}]},"menu":{"toggles":{"GRID":{"displayName":"Interactive Grid","showOnInit":true,"requireModule":"GEOGRID"},"ABM":{"displayName":"Mobility Simulation","showOnInit":false,"requireModule":"ABM2"},"AGGREGATED_TRIPS":{"displayName":"Aggregated Trips","showOnInit":false,"requireModule":"ABM2"},"ACCESS":{"displayName":"Accessibility Analysis","showOnInit":false,"requireModule":"access"},"ROTATE":{"displayName":"Rotate Camera","showOnInit":false,"requireModule":false},"TEXTUAL":{"displayName":"Toggle Information","showOnInit":true,"requireModule":"GEOGRID"},"SHADOWS":{"displayName":"Toggle Shadows","showOnInit":true,"requireModule":"GEOGRID"}}},"map":{"mapStyle":{"sat":"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true","blue":"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"},"layers":{"ABM":{"startSimHour":0,"endSimHour":86400,"currentSimHour":43200,"animationSpeed":20},"heatmap":{"colors":[[255,0,130],[0,150,255]]}},"initialViewState":{"zoom":17,"pitch":0,"bearing":0}}}')},391:function(e,t){},632:function(e,t){},66:function(e){e.exports=JSON.parse('{"map":{"mapStyle":{"sat":"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true","dark":"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true","blue":"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"}},"GEOGRIDDATA":{"color":[0,0,0],"height":0,"id":0,"interactive":"Web","name":"name"},"GEOGRID":{"features":[],"properties":{"geogrid_to_tui_mapping":{},"header":{"cellSize":50,"latitude":42.3664655,"longitude":-71.0854323,"tz":-5,"ncols":20,"nrows":20,"rotation":0,"projection":"+proj=lcc +lat_1=42.68333333333333 +lat_2=41.71666666666667 +lat_0=41 +lon_0=-71.5 +x_0=200000 +y_0=750000 +ellps=GRS80 +datum=NAD83 +units=m +no_def"},"types":{"Institutional":{"LBCS":[{"proportion":0.3,"use":{"6700":1}},{"proportion":0.7,"use":{"2310":0.3,"4100":0.7}}],"NAICS":[{"proportion":0.3,"use":{"7121":1}},{"proportion":0.7,"use":{"6111":0.3,"6113":0.1,"6115":0.1,"6116":0.2,"8133":0.15,"8134":0.15}}],"interactive":"Web","color":"#B32745","height":4,"sqm_pperson":400},"Office":{"LBCS":[{"proportion":1,"use":{"2310":1}}],"NAICS":[{"proportion":1,"use":{"5400":1}}],"interactive":"Web","color":"#FF5277","height":10,"sqm_pperson":20},"Park":{"LBCS":[{"proportion":1,"use":{"7240":1}}],"NAICS":null,"interactive":"Web","color":"#38C9FF","sqm_pperson":1},"Road":{"LBCS":[{"proportion":1,"use":{"5210":1}}],"NAICS":null,"interactive":"Web","color":"#308FB3","height":1,"sqm_pperson":4},"Residential":{"LBCS":[{"proportion":1,"use":{"1100":1}}],"NAICS":null,"interactive":"Web","color":"#FFFF33","height":4,"sqm_pperson":90},"Retail":{"LBCS":[{"proportion":1,"use":{"2100":0.6,"2200":0.4}}],"NAICS":[{"proportion":1,"use":{"4451":0.02,"4453":0.02,"7224":0.26,"7225":0.7}}],"interactive":"Web","color":"#FF835E","height":4,"sqm_pperson":150},"Campus":{"LBCS":[{"proportion":1,"use":{"2310":1}}],"NAICS":[{"proportion":1,"use":{"3336":0.5,"5414":0.2,"5415":0.1,"5417":0.2}}],"interactive":"Web","color":"#A2FF91","height":10,"sqm_pperson":50},"Industrial":{"LBCS":[{"proportion":1,"use":{"3110":1}}],"NAICS":[{"proportion":1,"use":{"4841":0.2,"5617":0.3,"5619":0.3,"8111":0.2}}],"interactive":"Web","color":"#E83FB8","height":4,"sqm_pperson":60},"Low Income housing":{"LBCS":[{"proportion":0.1,"use":{"2200":1}},{"proportion":0.75,"use":{"2310":1}},{"proportion":0.15,"use":{"1200":1}}],"NAICS":[{"proportion":0.1,"use":{"7224":0.5,"7225":0.5}},{"proportion":0.75,"use":{"5414":0.4,"5415":0.2,"5417":0.4}},{"proportion":0.15,"use":{"7211":1}}],"interactive":"Web","color":"#E945FF","height":20,"sqm_pperson":50},"Residential Low Density":{"LBCS":[{"proportion":1,"use":{"1100":1}}],"NAICS":null,"interactive":"Web","color":"#7FB34B","height":4,"sqm_pperson":320}}},"type":"FeatureCollection"}}')},757:function(e,t,n){},759:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(37),o=n.n(i),c=n(138),s=n(44),l=n(787),u=n(460),d=n(461),j=Object(u.a)((function(){return Object(d.a)({"@global":{"*":{boxSizing:"border-box",margin:0,padding:0},html:{"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale",height:"100%",width:"100%"},body:{backgroundColor:"#18191a",height:"100%",width:"100%"},a:{textDecoration:"none"},"#root":{height:"100%",width:"100%"}}})})),p=function(){return j(),null},h=n(189),b=n(38),O={fontFamily:'"Roboto Mono", sans-serif',fontSize:14,fontWeightLight:100,fontWeightRegular:500,fontWeightMedium:700,h1:{fontWeight:700,fontSize:45,letterSpacing:"-1px"},h2:{fontWeight:800,fontSize:29,letterSpacing:"-0.24px"},h3:{fontWeight:700,fontSize:24,letterSpacing:"-0.06px"},h4:{fontWeight:500,fontSize:20,letterSpacing:"-0.06px"},h5:{fontWeight:500,fontSize:16,letterSpacing:"-0.05px"},h6:{fontWeight:500,fontSize:14,letterSpacing:"-0.05px"},overline:{fontWeight:500}},f=Object(h.a)({zIndex:{appBar:999},palette:{background:{default:"#ff5278",paper:"#18191a",dark:"#ff5278"},primary:{main:"#FFF",light:"#ff5278"},secondary:{main:"#ff5278"},text:{primary:b.colors.grey[100],secondary:"#ff5278"}},typography:O,shape:{borderRadius:20},overrides:{MuiListItem:{root:{"&$selected":{backgroundColor:"#18191a",boxShadow:"12px 12px 16px 0 rgba(0,0,0),-8px -8px 12px 0 rgba(40,41,42)","&:hover":{backgroundColor:"#ff5278"}}},button:{"&:hover":{backgroundColor:"#ff5278"}}},MuiOutlinedInput:{notchedOutline:{borderColor:"#ff5278"}},MuiAppBar:{colorPrimary:{backgroundColor:"#18191a",color:"#FFF"}},MuiDivider:{root:{backgroundColor:"#FFF",opacity:.1}},MuiCard:{root:{boxShadow:"12px 12px 16px 0 rgba(0,0,0),-8px -8px 12px 0 rgba(40,41,42)"}},MuiButton:{root:{boxShadow:"12px 12px 16px 0 rgba(0,0,0),-8px -8px 12px 0 rgba(40,41,42)","&:hover":{boxShadow:"12px 12px 16px 0  #000,-2px -2px 16px 0  #ff5278"}}}}}),m=n(18),g=n(315),x=n.n(g),v=n(537),y=n.n(v),S=n(536),E=n.n(S),C=n(362),I=n(770),D=n(790),T=n(791),w=n(800),A=n(114),M=n(103),R=n(809),N=n(810),G=n(811),_=n(16),k=n(207),L=n(5),P=n(771),F=n(462),B=n(4),W=Object(u.a)((function(e){return{item:{display:"flex",paddingTop:0,paddingBottom:0},button:{color:e.palette.text.main,fontWeight:e.typography.fontWeightMedium,justifyContent:"flex-start",letterSpacing:0,padding:"10px 8px",textTransform:"none",width:"100%"},icon:{marginRight:e.spacing(1)},title:{marginRight:"auto"},active:{color:e.palette.text.secondary,"& $title":{fontWeight:e.typography.fontWeightBold},"& $icon":{color:e.palette.text.secondary}}}})),z=function(e){var t=e.className,n=e.href,a=e.icon,r=e.title,i=Object(k.a)(e,["className","href","icon","title"]),o=W();return Object(B.jsx)(P.a,Object(_.a)(Object(_.a)({className:Object(L.a)(o.item,t),disableGutters:!0},i),{},{children:Object(B.jsxs)(F.a,{activeClassName:o.active,className:o.button,component:c.c,to:n,children:[a&&Object(B.jsx)(a,{className:o.icon,size:"20"}),Object(B.jsx)("span",{className:o.title,children:r})]})}))},U=[{href:"/home",icon:R.a,title:"Home"},{href:"/cityioviewer",icon:E.a,title:"CityScope Projects"},{href:"/",icon:N.a,title:"CityScopeJS"},{href:"/editor",icon:G.a,title:"Grid Editor"},{href:"/projection",icon:y.a,title:"Projection Mapping"}],J=Object(u.a)((function(){return{mobileDrawer:{width:"30vw",top:48,height:"calc(100% - 48px)",boxShadow:"22px 22px 22px 0 rgba(0,0,0)"}}})),V=function(e){var t=e.openNavDrawer,n=e.onMobileNavOpen,a=J(),r=Object(B.jsxs)(C.a,{height:"100%",display:"flex",flexDirection:"column",p:3,children:[Object(B.jsx)(I.a,{children:U.map((function(e){return Object(B.jsx)(z,{style:{padding:"2vh"},href:e.href,title:e.title,icon:e.icon,onClick:n},e.title)}))}),Object(B.jsx)(C.a,{flexGrow:1}),Object(B.jsx)(D.a,{elevation:5,p:2,children:Object(B.jsxs)(T.a,{position:"bottom",children:[Object(B.jsx)(w.a,{href:"http://github.com/CityScope/CS_cityscopeJS/",color:"default",size:"small",children:Object(B.jsx)(x.a,{})}),Object(B.jsx)(C.a,{p:2}),Object(B.jsx)(A.a,{align:"left",variant:"h5",children:"MIT CityScope"}),Object(B.jsx)(A.a,{align:"left",variant:"caption",children:(new Date).getFullYear()})]})})]});return Object(B.jsx)(B.Fragment,{children:Object(B.jsx)(M.a,{anchor:"left",classes:{paper:a.mobileDrawer},open:t,elevation:10,variant:"persistent",children:r})})};V.defaultProps={onMobileClose:function(){},openNavDrawer:!1};var Y=V,H=n(789),q=n(474),X=n(378),K=n(538),Q=n.n(K),Z=Object(u.a)((function(){return{root:{}}})),$=function(e){var t=e.className,n=e.onMobileNavOpen,a=Object(k.a)(e,["className","onMobileNavOpen"]),r=Z();return Object(B.jsx)(H.a,Object(_.a)(Object(_.a)({className:Object(L.a)(r.root,t),elevation:5},a),{},{children:Object(B.jsxs)(q.a,{variant:"dense",children:[Object(B.jsx)(X.a,{color:"inherit",onClick:n,children:Object(B.jsx)(Q.a,{})}),Object(B.jsx)(c.b,{to:"/",children:Object(B.jsx)(A.a,{className:r.name,color:"textPrimary",variant:"h5",children:"MIT CityScope"})})]})}))},ee=Object(u.a)((function(e){return{root:{backgroundColor:e.palette.background,display:"flex",height:"100%",overflow:"hidden",width:"100%"},content:{paddingTop:48,flex:"1 1 auto",height:"100vh",overflow:"auto"}}})),te=function(){var e=ee(),t=Object(a.useState)(!0),n=Object(m.a)(t,2),r=n[0],i=n[1];return Object(B.jsxs)("div",{className:e.root,children:[Object(B.jsx)(Y,{openNavDrawer:!r,onMobileNavOpen:function(){return i(!r)}}),Object(B.jsx)($,{onMobileNavOpen:function(){return i(!r)}}),Object(B.jsx)("div",{className:e.content,children:Object(B.jsx)(s.b,{})})]})},ne=n(792),ae=n(539),re=Object(a.forwardRef)((function(e,t){var n=e.children,a=e.title,r=void 0===a?"":a,i=Object(k.a)(e,["children","title"]);return Object(B.jsxs)("div",Object(_.a)(Object(_.a)({ref:t},i),{},{children:[Object(B.jsx)(ae.a,{children:Object(B.jsxs)("title",{children:["CityScopeJS ",">"," ",r]})}),n]}))})),ie=Object(u.a)((function(e){return{root:{backgroundColor:e.palette.background,height:"100%",paddingBottom:e.spacing(3),paddingTop:e.spacing(3)},image:{marginTop:50,display:"inline-block",maxWidth:"100%",width:560}}})),oe=function(){var e=ie();return Object(B.jsx)(re,{className:e.root,title:"404",children:Object(B.jsx)(C.a,{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",children:Object(B.jsxs)(ne.a,{maxWidth:"md",children:[Object(B.jsx)(A.a,{align:"center",color:"textPrimary",variant:"h1",children:"404"}),Object(B.jsx)(A.a,{align:"center",color:"textPrimary",variant:"h5",children:"The page you are looking for isn\u2019t here"})]})})})},ce=n(200),se=n(201),le=n(208),ue=n(206);function de(e){if(!e.mousePos)return null;var t=e.mousePos,n=e.selectedType,a=e.divSize,r="rgba("+n.color[0]+","+n.color[1]+","+n.color[2]+",0.6)",i=t.clientX-a/2,o=t.clientY-a/2;return Object(B.jsx)("div",{style:{border:"2px solid",backgroundColor:e.mouseDown?r:"rgba(0,0,0,0)",borderColor:n.color,color:n.color,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:a,height:a,left:i,top:o},children:Object(B.jsx)("div",{style:{position:"relative",left:a+10,fontSize:"0.5em"},children:n.name})})}var je=n(22),pe=n(143),he=n(818),be=(n(284),n(820)),Oe=n(66),fe="GET_CITYIO_DATA";function me(e){return{type:fe,data:e}}var ge="LISTEN_TO_MAP_EVENTS";var xe="LISTEN_TO_ABM_SLIDERS";function ve(e){return{type:xe,data:e}}var ye="LISTEN_TO_ABM_MODE";var Se="LISTEN_TO_ACCESS_TOGGLE";var Ee="MENU_INTERACTION";var Ce="LISTEN_TO_EDIT_MENU";function Ie(e){return{type:Ce,data:e}}var De="SET_READY_STATE";function Te(e){return{type:De,data:e}}var we="SET_LOADING_STATE";function Ae(e){return{type:we,data:e}}var Me="SET_SCENARIO_NAMES";function Re(e){return{type:Me,data:e}}var Ne="ADD_LOADING_MODULES";function Ge(e){return{type:Ne,data:e}}var _e="REMOVE_LOADING_MODULES";function ke(e){return{type:_e,data:e}}var Le="SET_UI_WEBSOCKET_DATA";var Pe="SET_UI_WEBSOCKET_READY";var Fe="LISTEN_TO_GRID_CREATOR";function Be(e){return{type:Fe,data:e}}var We="LISTEN_TO_ROW_EDIT";function ze(e){return{type:We,data:e}}var Ue="LISTEN_TO_TYPES_LIST";var Je="LISTEN_TO_BASE_MAP_CENTER";function Ve(e){return{type:Je,data:e}}var Ye=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},He=function(e){Object(le.a)(n,e);var t=Object(ue.a)(n);function n(e){var a;return Object(ce.a)(this,n),(a=t.call(this,e))._toggleOrthoView=function(e){e.orthographic=!!a.props.menu.includes("RESET_VIEW")},a._onViewStateChange=function(e){var t=e.viewState;a.setState({viewState:t})},a.componentDidUpdate=function(e){a.props.mapCenter!==e.mapCenter&&a.setState({viewState:Object(_.a)(Object(_.a)({},a.state.viewState),{},{latitude:a.props.mapCenter.latCenter,longitude:a.props.mapCenter.lonCenter,pitch:0,bearing:0,orthographic:!1})})},a._mulipleObjPicked=function(e){var t=a.state.pickingRadius,n=e.x-t/2,r=e.y-t/2;return a.deckGL.pickObjects({x:n,y:r,width:t,height:t})},a._handleGridcellEditing=function(e){if(a.props.selectedType){var t=a.props.selectedType,n=t.height,r=t.name,i=t.color,o=t.interactive,c=a._mulipleObjPicked(e);c.forEach((function(e){var t=e.object.properties;t.color=Ye(i),t.height=parseInt(n),t.name=r,"No"!==o?t.interactive=o:delete t.interactive})),a.setState({selectedCellsState:c})}},a._renderSelectionTarget=function(){return a.props.selectedType&&Object(B.jsx)(de,{mousePos:a.state.mousePos,selectedType:a.props.selectedType,divSize:a.state.pickingRadius,mouseDown:a.state.mouseDown})},a._handleKeyUp=function(){a.setState({keyDownState:null})},a._handleKeyDown=function(e){a.setState({keyDownState:e.nativeEvent.key})},a.state={selectedType:null,draggingWhileEditing:!1,selectedCellsState:null,pickingRadius:40,viewState:Oe.map.initialViewState},a.dirLightSettings={timestamp:Date.UTC(2019,7,1,12),color:[255,255,255],intensity:1,_shadow:!0},a}return Object(se.a)(n,[{key:"componentDidMount",value:function(){this._rightClickViewRotate(),this._setViewStateToTableHeader()}},{key:"_setViewStateToTableHeader",value:function(){this.setState({viewState:Object(_.a)(Object(_.a)({},this.state.viewState),{},{latitude:Oe.GEOGRID.properties.header.latitude,longitude:Oe.GEOGRID.properties.header.longitude,zoom:15,pitch:0,bearing:0,orthographic:!0})})}},{key:"_rightClickViewRotate",value:function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}))}},{key:"_renderLayers",value:function(){var e=this,t=[];return t.push(new be.a({id:"GRID",opacity:.5,stroked:!1,filled:!0,wireframe:!0,data:this.props.createdGrid,visible:!0,pickable:!0,extruded:!0,lineWidthScale:1,lineWidthMinPixels:1,getElevation:function(e){return e.properties.height},getFillColor:function(e){return e.properties.color},onClick:function(t,n){n.rightButton||"Shift"===e.state.keyDownState||e._handleGridcellEditing(t)},onDrag:function(t,n){n.rightButton||"Shift"===e.state.keyDownState||e._handleGridcellEditing(t)},onDragStart:function(t,n){n.rightButton||"Shift"===e.state.keyDownState||e.setState({draggingWhileEditing:!0})},onDragEnd:function(){e.setState({draggingWhileEditing:!1})},updateTriggers:{getFillColor:this.state.selectedCellsState,getElevation:this.state.selectedCellsState},transitions:{getFillColor:500,getElevation:500}})),t}},{key:"render",value:function(){var e=this;return Object(B.jsxs)("div",{className:"baseMap",onKeyDown:this._handleKeyDown,onKeyUp:this._handleKeyUp,onMouseMove:function(t){return e.setState({mousePos:t.nativeEvent})},onMouseUp:function(){return e.setState({mouseDown:!1})},onMouseDown:function(){return e.setState({mouseDown:!0})},children:[this._renderSelectionTarget(),Object(B.jsx)(he.a,{ref:function(t){e.deckGL=t&&t.deck},viewState:this.state.viewState,onViewStateChange:this._onViewStateChange,layers:this._renderLayers(),controller:{touchZoom:!0,touchRotate:!0,dragPan:!this.state.draggingWhileEditing,dragRotate:!this.state.draggingWhileEditing,keyboard:!1},children:Object(B.jsx)(pe.a,{dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:Oe.map.mapStyle.sat,preventStyleDiffing:!0})})]})}}]),n}(a.Component),qe={listenToBaseMapCenter:Ve},Xe=Object(je.b)((function(e){return{selectedType:e.ROW_EDIT,mapCenter:e.BASE_MAP_CENTER,createdGrid:e.GRID_CREATED}}),qe)(He),Ke=n(78),Qe=n(550),Ze=n.n(Qe),$e=n(801);function et(){var e=r.a.useState({columns:[{title:"Type",field:"name"},{title:"Description",field:"description"},{title:"Height",field:"height",type:"numeric"},{title:"Interactive",field:"interactive",lookup:{No:"No",Web:"Web",TUI:"TUI"}},{title:"Color",field:"color",type:"string"},{title:"LBCS",field:"LBCS",type:"string"},{title:"NAICS",field:"NAICS",type:"string"}],data:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({name:n,description:"description for: "+n,color:e[n].color,height:e[n].height?e[n].height:0,LBCS:e[n].LBCS?JSON.stringify(e[n].LBCS):null,NAICS:e[n].NAICS?JSON.stringify(e[n].NAICS):null,interactive:e[n].interactive})})),t}(Oe.GEOGRID.properties.types)}),t=Object(m.a)(e,2),n=t[0],i=t[1],o=Object(je.c)(),c=Object(a.useState)(null),s=Object(m.a)(c,2),l=s[0],u=s[1],d=Object(a.useState)(null),j=Object(m.a)(d,2),p=j[0],h=j[1];return Object(a.useEffect)((function(){var e;o((e=n.data,{type:Ue,data:e}))})),Object(B.jsx)($e.a,{container:!0,children:Object(B.jsx)($e.a,{item:!0,xs:12,s:12,m:12,l:12,xl:12,children:Object(B.jsx)(Ze.a,{title:Object(B.jsx)(A.a,{variant:"h2",children:"Types Editor"}),columns:n.columns,data:n.data,options:{paging:!1,search:!0,selection:!1,rowStyle:function(e){return{fontFamily:"Roboto Mono",fontSize:12,backgroundColor:l===e.tableData.id?p:null}}},onRowClick:function(e,t){u(t.tableData.id),h(t.color),o(ze(t))},editable:{onRowAdd:function(e){return new Promise((function(t){setTimeout((function(){t(),i((function(t){var n=Object(Ke.a)(t.data);return n.push(e),Object(_.a)(Object(_.a)({},t),{},{data:n})}))}),200)}))},onRowUpdate:function(e,t){return new Promise((function(n){setTimeout((function(){n(),t&&i((function(n){var a=Object(Ke.a)(n.data);return a[a.indexOf(t)]=e,Object(_.a)(Object(_.a)({},n),{},{data:a})})),o(ze(e))}),200)}))},onRowDelete:function(e){return new Promise((function(t){console.log(e),setTimeout((function(){t(),i((function(t){var n=Object(Ke.a)(t.data);return n.splice(n.indexOf(e),1),Object(_.a)(Object(_.a)({},t),{},{data:n})})),o(Be(null))}),200)}))}}})})})}var tt=n(124),nt=n(476),at=n(568),rt=n.n(at),it=n(263);function ot(e){return e*Math.PI/180}function ct(e){return 180*e/Math.PI}var st=function(e){var t=Object.keys(e);return e[t[t.length*Math.random()<<0]]};function lt(e){var t=Object(je.c)(),n=Object(je.d)((function(e){return e})),a=function(){var a=function(e,t){for(var n=parseFloat(e.longitude),a=parseFloat(e.latitude),r=parseFloat(e.rotation),i=e.projection,o=parseFloat(e.cellSize),c=parseFloat(e.nrows),s=parseFloat(e.ncols),l=it.a.defs("EPSG:4326"),u={lon:n,lat:a},d=(90-r+360)%360,j=o*s/6371e3,p=ot(u.lat),h=ot(u.lon),b=ot(d),O=Math.asin(Math.sin(p)*Math.cos(j)+Math.cos(p)*Math.sin(j)*Math.cos(b)),f={lon:ct(h+Math.atan2(Math.sin(b)*Math.sin(j)*Math.cos(p),Math.cos(j)-Math.sin(p)*Math.sin(O))),lat:ct(O)},m=Object(it.a)(l,i,[u.lon,u.lat]),g=Object(it.a)(l,i,[f.lon,f.lat]),x=(g[1]-m[1])/(g[0]-m[0]),v=Math.atan(x),y=Math.cos(v),S=Math.sin(v),E=[],C=[],I=0;I<c;I++)for(var D=0;D<s;D++)E.push(D*o),C.push(-I*o);for(var T=[],w=[],A=0;A<E.length;A++)T.push(E[A]*y-C[A]*S),w.push(E[A]*S+C[A]*y);for(var M=[],R=[],N=0;N<T.length;N++)M.push(m[0]+T[N]),R.push(m[1]+w[N]);for(var G=M[1]-M[0],_=R[1]-R[0],k=M[s]-M[0],L=R[s]-R[0],P=[],F={type:"FeatureCollection",features:[]},B=t,W=0;W<M.length;W++){for(var z=st(B),U={type:"Feature",geometry:{type:"Polygon",coordinates:null},properties:{color:Ye(z.color),height:z.height,name:z.name,interactive:z.interactive,id:W}},J=[[M[W],R[W]],[M[W]+k,R[W]+L],[M[W]+k+G,R[W]+L+_],[M[W]+G,R[W]+_],[M[W],R[W]]],V=[],Y=0;Y<5;Y++){var H=Object(it.a)(i,l,J[Y]);V.push(H)}U.geometry.coordinates=[V],P.push(U)}return F.features=P,F}(e.gridProps,n.TYPES_LIST);t(Be(a))};return Object(B.jsx)(F.a,{onClick:function(){a()},variant:"outlined",color:"default",startIcon:Object(B.jsx)(rt.a,{}),children:"Create Grid"})}var ut=n(204),dt=n.n(ut),jt=n(569),pt=n.n(jt),ht=n(55),bt=n.n(ht),Ot=n(802),ft=function(e,t,n,a){var r=e,i={};return t.forEach((function(e){i[e.name]=e,i[e.name].LBCS="string"==typeof e.LBCS?JSON.parse(e.LBCS):e.LBCS,i[e.name].NAICS="string"==typeof e.NAICS?JSON.parse(e.NAICS):e.NAICS})),r.properties.types=i,r.properties.header=a,r.properties.header.longitude=parseFloat(r.properties.header.longitude),r.properties.header.latitude=parseFloat(r.properties.header.latitude),r.properties.header.rotation=parseFloat(r.properties.header.rotation),r.properties.header.nrows=parseFloat(r.properties.header.nrows),r.properties.header.ncols=parseFloat(r.properties.header.ncols),r.properties.header.cellSize=parseFloat(r.properties.header.cellSize),r.features=n,r};function mt(e){var t=r.a.useState(null),n=Object(m.a)(t,2),a=n[0],i=n[1],o=Object(je.d)((function(e){return e})),c=o.GRID_CREATED,s=function(){var t=Oe.GEOGRID,n=o.TYPES_LIST,a=o.GRID_CREATED.features,r=e.gridProps,c=ft(t,n,a,r),s=function(e){var t=[];return e.forEach((function(e){t.push(e.properties)})),t}(a),l=c.properties.header.tableName.toLowerCase(),u={geoGridURL:"https://cityio.media.mit.edu/api/table/update/"+l+"/GEOGRID",geoGridDataURL:"https://cityio.media.mit.edu/api/table/update/"+l+"/GEOGRIDDATA"},d=function(e,t){return{method:"post",url:e,data:t,headers:{"Content-Type":"application/json",Accept:"application/json"}}};bt()(d(u.geoGridURL,c)).then((function(e){i(function(e,t){var n="https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+t;return Object(B.jsxs)(A.a,{color:"textPrimary",variant:"caption",children:["CityIO is ",e.data.status,". Grid deployed to"," ",Object(B.jsx)(Ot.a,{color:"textSecondary",href:n,children:n})]})}(e,l))})).then((function(){bt()(d(u.geoGridDataURL,{})),console.log("removed GEOGRIDDATA")})).then((function(){bt()(d(u.geoGridDataURL,s)),console.log("mirrored GEOGRID to GEOGRIDDATA")})).catch((function(e){console.log("ERROR:",e)}))};return Object(B.jsx)(B.Fragment,{children:c&&Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(F.a,{onClick:function(){s()},variant:"outlined",color:"default",startIcon:Object(B.jsx)(dt.a,{}),children:"Commit Grid to cityIO"}),Object(B.jsx)(F.a,{onClick:function(){!function(){var t=Oe.GEOGRID,n=o.TYPES_LIST,a=o.GRID_CREATED.features,r=e.gridProps,i=ft(t,n,a,r),c="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i)),s=document.createElement("a");s.setAttribute("href",c),s.setAttribute("download","grid.json"),document.body.appendChild(s),s.click(),s.remove()}()},variant:"outlined",color:"default",startIcon:Object(B.jsx)(pt.a,{}),children:"Download JSON"}),Object(B.jsxs)("div",{style:{width:"100%"},children:[" ",a]})]})})}var gt=n(570),xt=n.n(gt);function vt(e){var t=Object(je.c)();return Object(B.jsx)(F.a,{onClick:function(){t(Ve({latCenter:parseFloat(e.mapCenter[0]),lonCenter:parseFloat(e.mapCenter[1])}))},variant:"outlined",color:"default",startIcon:Object(B.jsx)(xt.a,{}),style:{fontSize:"12px"},children:"Center Map"})}function yt(){var e=Object(u.a)((function(e){return{notchedOutline:{borderWidth:"1px",borderColor:e.palette.text.secondary},root:{"& .MuiTextField-root":{margin:e.spacing(1),flexWrap:"wrap"},"& > *":{margin:e.spacing(1)}}}})),t=r.a.useState({tableName:"CityScopeJS",latitude:Oe.GEOGRID.properties.header.latitude,longitude:Oe.GEOGRID.properties.header.longitude,tz:Oe.GEOGRID.properties.header.tz,nrows:Oe.GEOGRID.properties.header.nrows,ncols:Oe.GEOGRID.properties.header.nrows,rotation:Oe.GEOGRID.properties.header.rotation,cellSize:Oe.GEOGRID.properties.header.cellSize,projection:Oe.GEOGRID.properties.header.projection}),n=Object(m.a)(t,2),a=n[0],i=n[1],o=function(e){var t=e.target,n=t.id,r=t.value;i(Object(_.a)(Object(_.a)({},a),{},Object(tt.a)({},n,r)))},c=e();return Object(B.jsxs)("form",{className:c.root,noValidate:!0,autoComplete:"off",children:[Object(B.jsx)(A.a,{variant:"h2",children:"Grid Properties"}),Object(B.jsx)("div",{className:c.root,children:Object(B.jsx)(nt.a,{InputProps:{classes:{notchedOutline:c.notchedOutline}},onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"tableName",label:"CityScope Project Name",defaultValue:a.tableName})}),Object(B.jsxs)("div",{className:c.root,children:[Object(B.jsx)(nt.a,{InputProps:{classes:{notchedOutline:c.notchedOutline}},onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"latitude",label:"Latitude",defaultValue:a.latitude,type:"number"}),Object(B.jsx)(nt.a,{InputProps:{classes:{notchedOutline:c.notchedOutline}},onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"longitude",label:"Longitude",defaultValue:a.longitude,type:"number"}),Object(B.jsx)(nt.a,{InputProps:{classes:{notchedOutline:c.notchedOutline}},onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"tz",label:"Time Zone (GMT)",defaultValue:a.tz,type:"number"})]}),Object(B.jsx)("div",{className:c.root,children:Object(B.jsx)(vt,{mapCenter:[a.latitude,a.longitude]})}),Object(B.jsxs)("div",{className:c.root,children:[Object(B.jsx)(nt.a,{onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"nrows",label:"Rows",defaultValue:a.nrows,type:"number",InputProps:{classes:{notchedOutline:c.notchedOutline},inputProps:{max:100,min:0}}}),Object(B.jsx)(nt.a,{onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"ncols",label:"Columns",defaultValue:a.ncols,type:"number",InputProps:{classes:{notchedOutline:c.notchedOutline},inputProps:{max:100,min:0}}}),Object(B.jsx)(nt.a,{onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"rotation",label:"Rotation (deg)",defaultValue:a.rotation,type:"number",InputProps:{classes:{notchedOutline:c.notchedOutline},inputProps:{max:360,min:0}}}),Object(B.jsx)(nt.a,{onChange:function(e){return o(e)},variant:"outlined",className:c.textField,id:"cellSize",label:"Cell Size (m^2)",defaultValue:a.cellSize,type:"number",InputProps:{classes:{notchedOutline:c.notchedOutline},inputProps:{max:1e3,min:0}}})]}),Object(B.jsx)("div",{className:c.root,children:Object(B.jsx)(nt.a,{InputProps:{classes:{notchedOutline:c.notchedOutline}},onChange:function(e){return o(e)},variant:"outlined",id:"projection",label:"Projection",defaultValue:a.projection,type:"string",helperText:"Default projection should work for most CityScope cases. Find specific projections at: https://epsg.io/"})}),Object(B.jsxs)("div",{className:c.root,children:[Object(B.jsx)(lt,{gridProps:a}),Object(B.jsx)(mt,{gridProps:a})]})]})}function St(){return Object(B.jsxs)(I.a,{children:[Object(B.jsx)(P.a,{children:Object(B.jsx)(A.a,{variant:"h1",children:"CityScope Grid Editor"})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(A.a,{children:"This tool is for creating CityScope projects with virtual editable girds, types, and props, and deploy them to cityIO."})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(yt,{})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(et,{})})]})}var Et=Object(u.a)((function(e){return{root:{margin:"auto",height:"100%",paddingBottom:e.spacing(3),paddingTop:e.spacing(3)}}}));function Ct(){var e=Et();return Object(B.jsx)(re,{className:e.root,title:"Editor",children:Object(B.jsx)(ne.a,{maxWidth:!1,children:Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)($e.a,{container:!0,spacing:5,children:[Object(B.jsx)($e.a,{item:!0,xs:12,l:6,md:6,xl:4,children:Object(B.jsx)(D.a,{elevation:15,style:{maxHeight:"85vh",overflow:"auto"},children:Object(B.jsx)(T.a,{children:Object(B.jsx)(St,{})})})}),Object(B.jsx)($e.a,{item:!0,xs:12,l:6,md:6,xl:8,children:Object(B.jsx)(D.a,{elevation:15,style:{height:"85vh",width:"100%",position:"relative"},children:Object(B.jsx)(T.a,{children:Object(B.jsx)(Xe,{})})})})]})})})})}var It=n(74),Dt=n.n(It),Tt=n(111),wt=n(29),At=n(205),Mt=function(e,t,n){var a=wt.cityIO.baseURL+e+"/meta/hashes";bt.a.get(a).then((function(a){var r,i=Object.keys(a.data).filter((function(e){return e.includes("scenarios")})).map((function(e){return parseInt(e.replace("scenarios",""))})),o=[],c=Object(At.a)(i);try{for(c.s();!(r=c.n()).done;){var s=r.value;o.push(Rt(e,s))}}catch(l){c.e(l)}finally{c.f()}Promise.all(o).then((function(e){t(e.map((function(e){return{name:e.data.name,id:e.data.id}}))),n&&n(!1)})).catch((function(e){return console.log("error getting scenario names",e)}))})).catch((function(e){console.log("Error getting scenarios",e)}))},Rt=function(e,t){var n=wt.cityIO.baseURL+e+"/scenarios"+t+"/info";return bt.a.get(n)},Nt=function(){var e=Object(Tt.a)(Dt.a.mark((function e(t){var n;return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,bt.a.get(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();function Gt(e){var t=e.tableName,n=Object(a.useState)(null),r=Object(m.a)(n,2),i=r[0],o=r[1],c=Object(a.useState)({}),s=Object(m.a)(c,2),l=s[0],u=s[1],d=wt.cityIO.baseURL+t,j=Object(je.d)((function(e){return e.CITYIO})),p=Object(je.c)();function h(){return b.apply(this,arguments)}function b(){return(b=Object(Tt.a)(Dt.a.mark((function e(){var t;return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nt(d+"/meta/id");case 2:t=e.sent,i!==t&&o(t),setTimeout(h,wt.cityIO.interval);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(Tt.a)(Dt.a.mark((function e(){var n,a,r,i,o,c;return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nt(d+"/meta/hashes");case 2:return n=e.sent,a=[],r=[],(i=wt.cityIO.cityIOmodules.map((function(e){return e.name}))).forEach((function(e){l[e]!==n[e]?(a.push(Nt(d+"/"+e)),r.push(e)):a.push(null)})),p(Ge(r)),e.next=10,Promise.all(a);case 10:o=e.sent,u(n),(c=i.reduce((function(e,t,n){return o[n]?(console.log("updating ".concat(t)),Object(_.a)(Object(_.a)({},e),{},Object(tt.a)({},t,o[n]))):e}),j)).tableName=t,p(ke(r)),p(me(c)),console.log("done updating from cityIO"),p(Te(!0)),p(Ae(!1));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){var e=setTimeout(h,wt.cityIO.interval);return console.log("reading cityIO every"+wt.cityIO.interval+"ms"),function(){return clearTimeout(e)}}),[]),Object(a.useEffect)((function(){i&&(p(Ae(!0)),Mt(t,(function(e){return p(Re(e))})),function(){O.apply(this,arguments)}())}),[i]),null}for(var _t=n(831),kt=n(803),Lt=n(830),Pt=n(805),Ft=n(788),Bt=n(799),Wt=n(130),zt=Object.keys(wt.menu.toggles),Ut=[],Jt=0;Jt<zt.length;Jt++)Object.values(wt.menu.toggles)[Jt].showOnInit&&Ut.push(zt[Jt]);var Vt={MENU:Ut,CITYIO:{},SCENARIO_NAMES:[],MAP:{},LOADING_MODULES:[],SLIDERS:{time:[wt.map.layers.ABM.startSimHour,wt.map.layers.ABM.currentSimHour,wt.map.layers.ABM.endSimHour],speed:wt.map.layers.ABM.animationSpeed},ABM_MODE:"mode",ACCESS_TOGGLE:0,SELECTED_TYPE:null,READY:!1,LOADING:!1,ROW_EDIT:null,BASE_MAP_CENTER:{latCenter:null,lonCenter:null},TYPES_LIST:null,GRID_CREATED:null};function Yt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case fe:return Object(_.a)(Object(_.a)({},e),{},{CITYIO:t.data});case Ee:return Object(_.a)(Object(_.a)({},e),{},{MENU:t.data});case ge:return Object(_.a)(Object(_.a)({},e),{},{MAP:t.data});case xe:return Object(_.a)(Object(_.a)({},e),{},{SLIDERS:t.data});case ye:return Object(_.a)(Object(_.a)({},e),{},{ABM_MODE:t.data});case Se:return Object(_.a)(Object(_.a)({},e),{},{ACCESS_TOGGLE:t.data});case Ce:return Object(_.a)(Object(_.a)({},e),{},{SELECTED_TYPE:t.data});case De:return Object(_.a)(Object(_.a)({},e),{},{READY:t.data});case we:return Object(_.a)(Object(_.a)({},e),{},{LOADING:t.data});case Me:return Object(_.a)(Object(_.a)({},e),{},{SCENARIO_NAMES:t.data});case Ne:return Object(_.a)(Object(_.a)({},e),{},{LOADING_MODULES:Object(Ke.a)(new Set([].concat(Object(Ke.a)(e.LOADING_MODULES),Object(Ke.a)(t.data))))});case _e:return Object(_.a)(Object(_.a)({},e),{},{LOADING_MODULES:e.LOADING_MODULES.filter((function(e){return!t.data.includes(e)}))});case Le:return Object(_.a)(Object(_.a)({},e),{},{UI_WEBSOCKET_DATA:t.data});case Pe:return Object(_.a)(Object(_.a)({},e),{},{UI_WEBSOCKET_READY:t.data});case We:return Object(_.a)(Object(_.a)({},e),{},{ROW_EDIT:t.data});case Ue:return Object(_.a)(Object(_.a)({},e),{},{TYPES_LIST:t.data});case Fe:return Object(_.a)(Object(_.a)({},e),{},{GRID_CREATED:t.data});case Je:return Object(_.a)(Object(_.a)({},e),{},{BASE_MAP_CENTER:t.data});default:return e}}var Ht=window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),qt=Object(Wt.d)(Yt,Ht),Xt=n(549),Kt=n(833),Qt=n(400);function Zt(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}var $t=function(e){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/i.test(e)},en=function(e){var t=e.GEOGRID;if(e.GEOGRIDDATA&&e.GEOGRIDDATA.length===e.GEOGRID.features.length)for(var n=e.GEOGRIDDATA,a=0;a<t.features.length;a++)t.features[a].properties=n[a],t.features[a].properties.id=a;return JSON.parse(JSON.stringify(t))},tn=function(e){for(var t=e.access,n=t.features.map((function(e){return e.geometry.coordinates})),a=t.features.map((function(e){return e.properties})),r=[],i=0;i<n.length;i++)r.push({coordinates:n[i],values:a[i]});return r},nn=function(e,t,n){var a=new Set(wt.cityIO.cityIOmodules.filter((function(e){return e.expectUpdate})).map((function(e){return e.name}))),r=new Set(Object.keys(qt.getState().CITYIO)),i=Object(Ke.a)(r).filter((function(e){return a.has(e)})),o={method:"post",url:"https://cityio.media.mit.edu/api/table/update/"+t+n,data:e,headers:{"Content-Type":"application/json",Accept:"application/json"}};bt()(o).then((function(e){"ok"===e.data.status&&qt.dispatch(Ge(i))})).catch((function(e){console.log("ERROR:",e)}))},an=function(e,t,n,a,r){var i=t.height,o=t.color,c=t.name,s=function(e,t,n){var a=t,r=e.x-a/2,i=e.y-a/2;return n.current.pickObjects({x:r,y:i,width:a,height:a})}(e,a,r);s.forEach((function(e){var t=e.object.properties;t&&t.interactive&&(t.color=$t(o)?Zt(o):o,t.height=i,t.name=c)})),n(s)},rn=new Date;rn.setHours(0,0,0,0);var on=function(e,t){t.tz&&rn.setHours(t.tz,0,0,0);var n=new Xt.a({color:[255,255,255],intensity:.85}),a=new Kt.a({timestamp:0,color:[255,255,255],intensity:1,_shadow:!0}),r=new Qt.a({ambientLight:n,dirLight:a});r.shadowColor=[0,0,0,.5],e.current=[r]},cn=function(e,t){var n=rn.getTime()+1e3*e,a=new Date(n);t.current[0].directionalLights[0].timestamp=Date.UTC(a.getFullYear(),a.getMonth(),a.getDay(),a.getHours(),a.getMinutes(),a.getSeconds())},sn=n(73);function ln(e){var t=["#85C4C8","#C22E00","#1E96BE","#EC9370","#F6D18A"],n=Object(a.useState)(!1),r=Object(m.a)(n,2),i=r[0],o=r[1],c=function(){var n=[];return e.typeInfo.forEach((function(e,a){n.push({angle:e.proportion,label:JSON.stringify(e.use),color:t[a]})})),n}();return Object(B.jsx)(B.Fragment,{children:Object(B.jsx)(sn.g,{colorType:"literal",animation:!0,className:"donut-chart-example",innerRadius:15,radius:25,getLabel:function(e){return e.label},showLabels:!1,getAngle:function(e){return e.angle},data:c,onValueMouseOver:function(e){o(e)},onSeriesMouseOut:function(){return o(!1)},width:50,height:50,padAngle:.1,children:!1!==i&&Object(B.jsx)(sn.e,{value:i,children:Object(B.jsx)("div",{style:{background:"rgba(0,0,0,0.8)",fontSize:10},children:Object(B.jsx)(A.a,{variant:"caption",gutterBottom:!0,children:i.label})})})})})}var un=Object(je.b)((function(e){return{cityioData:e.CITYIO}}),null)((function(e){var t=r.a.useState(null),n=Object(m.a)(t,2),a=n[0],i=n[1],o=Object(je.c)(),c=Object(je.d)((function(e){return e.SELECTED_TYPE})),s=c?c.height:null,l=[{value:0,label:"min"},{value:100,label:"max"}],u=function(e){return"string"==typeof e?JSON.parse(e):e};return Object(B.jsx)(B.Fragment,{children:function(t){var n=[];return Object.keys(t).forEach((function(r,d){var j=t[r].description?t[r].description:null,p=t[r].color,h=u(e.cityioData.GEOGRID.properties.types[r].LBCS),b=u(e.cityioData.GEOGRID.properties.types[r].NAICS);$t(p)&&(p=Zt(p));var O="rgb("+p[0]+","+p[1]+","+p[2]+")",f=a===r,m=!1;t[r].height&&(m=!0),n.push(Object(B.jsxs)("div",{children:[Object(B.jsxs)(P.a,{alignItems:"flex-start",button:!0,variant:"raised",selected:f,onClick:function(e){return n=r,(a=t[r]).name=n,i(n),void o(Ie(a));var n,a},children:[Object(B.jsx)(kt.a,{children:Object(B.jsx)(Lt.a,{style:{backgroundColor:O,color:"black"},children:r.charAt(0)})}),Object(B.jsx)(Pt.a,{primary:r})]}),Object(B.jsx)(Ft.a,{in:f,children:Object(B.jsx)(C.a,{spacing:1,p:1,m:1,children:Object(B.jsx)(D.a,{elevation:15,children:Object(B.jsxs)(T.a,{children:[Object(B.jsx)(A.a,{variant:"h5",children:"Type Information"}),j&&Object(B.jsx)(A.a,{variant:"caption",children:j}),Object(B.jsx)(C.a,{spacing:1,p:1,m:1}),Object(B.jsxs)($e.a,{container:!0,spacing:3,children:[Object(B.jsx)($e.a,{item:!0,xs:6,l:6,md:6,xl:6,container:!0,children:h&&Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(A.a,{variant:"caption",children:"LBCS"}),Object(B.jsx)(ln,{typeInfo:h})]})}),Object(B.jsx)($e.a,{item:!0,xs:6,l:6,md:6,xl:6,container:!0,children:b&&Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(A.a,{variant:"caption",children:"NAICS"}),Object(B.jsx)(ln,{typeInfo:b})]})}),m&&Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)($e.a,{item:!0,xs:10,l:10,md:10,xl:10,container:!0,children:[Object(B.jsx)(A.a,{gutterBottom:!0,children:"Set Height"}),Object(B.jsx)(_t.a,{value:s,valueLabelDisplay:"auto",onChange:function(e,t){return o(Ie(Object(_.a)(Object(_.a)({},c),{},{height:t})))},getAriaLabel:function(e){return e.toString()},min:l[0].value,max:l[1].value,marks:l})]})})]})]})})})}),Object(B.jsx)(Bt.a,{})]},Math.random()))})),Object(B.jsx)(I.a,{children:n})}(e.cityioData.GEOGRID.properties.types)})})),dn=Object(u.a)({root:{width:"80%",marginLeft:28},subtitle1:{marginTop:12},subtitle2:{marginTop:12}});function jn(e){var t=e.trips.tripsData,n=t.mode,a=t.profile;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(A.a,{variant:"h6",gutterBottom:!0,children:"mode"===e.tripTypeValue?"Mode Choise":"Profiles "}),Object(B.jsx)(sn.c,{height:300,width:150,items:function(e){var t="mode"===e?n:a,r=[];for(var i in t)r.push({title:t[i].name,color:t[i].color});return r}(e.tripTypeValue)})]})}var pn=n(827),hn=n(469),bn=n(464),On=n(382),fn=[{value:0,label:"12AM"},{value:21600,label:"6AM"},{value:43200,label:"12PM"},{value:64800,label:"6PM"},{value:86400,label:"12AM"}];var mn=function(e){var t=dn(),n=Object(je.d)((function(e){return e.SLIDERS})),a=Object(je.c)(),i=r.a.useState("mode"),o=Object(m.a)(i,2),c=o[0],s=o[1];return Object(B.jsxs)("div",{className:t.root,children:[Object(B.jsx)(On.a,{component:"fieldset",children:Object(B.jsxs)(hn.a,{"aria-label":"tripType",name:"tripType",value:c,onChange:function(e){var t;a((t=e.target.value,{type:ye,data:t})),s(e.target.value)},children:[Object(B.jsx)(bn.a,{value:"mode",control:Object(B.jsx)(pn.a,{}),label:"Mode Choice"}),Object(B.jsx)(bn.a,{value:"profile",control:Object(B.jsx)(pn.a,{}),label:"Profile"})]})}),Object(B.jsx)(jn,{trips:e,tripTypeValue:c}),Object(B.jsx)(A.a,{className:t.subtitle1,variant:"subtitle2",id:"range-slider",gutterBottom:!0,children:"Simulation Range"}),Object(B.jsx)(_t.a,{min:0,max:86400,marks:fn,value:n.time,onChange:function(e,t){a(ve(Object(_.a)(Object(_.a)({},n),{},{time:t})))},valueLabelDisplay:"off","aria-labelledby":"range-slider"}),Object(B.jsx)(A.a,{className:t.subtitle2,variant:"subtitle2",id:"continuous-slider",gutterBottom:!0,children:"Simulation Speed"}),Object(B.jsx)(_t.a,{min:0,max:100,value:n.speed,onChange:function(e,t){a(ve(Object(_.a)(Object(_.a)({},n),{},{speed:t})))},valueLabelDisplay:"auto","aria-labelledby":"continuous-slider"})]})},gn=Object(u.a)({root:{width:"80%",marginLeft:28},subtitle1:{marginTop:12},subtitle2:{marginTop:12}});var xn=function(){var e=gn(),t=Object(je.d)((function(e){return e.SLIDERS})),n=Object(je.c)();return Object(B.jsxs)("div",{className:e.root,children:[Object(B.jsx)(A.a,{className:e.subtitle1,variant:"subtitle2",id:"range-slider",gutterBottom:!0,children:"Time of day"}),Object(B.jsx)(_t.a,{min:0,max:86400,marks:[{value:0,label:"12AM"},{value:21600,label:"6AM"},{value:43200,label:"12PM"},{value:64800,label:"6PM"},{value:86400,label:"12AM"}],value:t.time,onChange:function(e,a){n(ve(Object(_.a)(Object(_.a)({},t),{},{time:a})))},valueLabelDisplay:"off","aria-labelledby":"range-slider"})]})},vn=n(804),yn=n(806);var Sn=function(e){var t=Object(je.d)((function(e){return e.ACCESS_TOGGLE})),n=e.cityioData,a=n&&n.access&&n.access.properties?n.access.properties:[],r=Object(je.c)(),i=wt.map.layers.heatmap.colors,o=i.length-1;return Object(B.jsxs)(I.a,{children:[Object(B.jsx)(P.a,{children:Object(B.jsx)(sn.b,{width:500,startColor:"rgb("+i[0][0]+","+i[0][1]+","+i[0][2]+")",endColor:"rgb("+i[o][0]+","+i[o][1]+","+i[o][2]+")",startTitle:"No Access",endTitle:"Full Access"})}),a.map((function(e,n){return Object(B.jsxs)(P.a,{children:[Object(B.jsx)(Pt.a,{primary:e,style:{textTransform:"capitalize"}}),Object(B.jsx)(vn.a,{children:Object(B.jsx)(yn.a,{edge:"end",checked:t===n,onChange:function(){r({type:Se,data:n})}})})]},e)}))]})};var En=function(e){for(var t=e.handleToggle,n=Object(je.d)((function(e){return{menuState:e.MENU,cityioData:e.CITYIO}})),a=n.menuState,r=n.cityioData,i=wt.menu.toggles,o=Object.keys(i),c=[],s=Object.keys(r),l=0;l<o.length;l++){var u=i[o[l]].requireModule,d=!!a.includes(o[l]);if(s.includes(u)||!1===u){var j=Object(B.jsxs)("div",{children:[Object(B.jsxs)(P.a,{children:[Object(B.jsx)(yn.a,{edge:"start",onChange:t(o[l]),checked:d}),Object(B.jsx)(Pt.a,{primary:i[o[l]].displayName})]}),"SHADOWS"===o[l]&&Object(B.jsx)(Ft.a,{in:d,children:Object(B.jsx)(xn,{})}),"ABM"===o[l]&&Object(B.jsx)(Ft.a,{in:d,children:Object(B.jsx)(mn,{tripsData:r.ABM2.attr})}),"ACCESS"===o[l]&&Object(B.jsx)(Ft.a,{in:d,style:{marginLeft:24},children:Object(B.jsx)(Sn,{cityioData:r})})]},o[l]);c.push(j)}}return Object(B.jsx)(I.a,{children:c})},Cn=n(793),In=n(798),Dn=n(796),Tn=n(797),wn=n(795);function An(e){var t=r.a.useState(!1),n=Object(m.a)(t,2),a=n[0],i=n[1],o=r.a.useState(""),c=Object(m.a)(o,2),s=c[0],l=c[1],u=Object(je.c)(),d=e.tableName,j=e.toggleDrawer,p=function(){i(!1)},h=Object(je.d)((function(e){return e.CITYIO})),b=Object(je.d)((function(e){return e.SCENARIO_NAMES})),O=function(e){var t={GEOGRIDDATA:h.GEOGRIDDATA,info:{id:e,name:s}},n={method:"post",url:wt.cityIO.baseURL+"update/"+d+"/scenarios"+e,data:t,headers:{"Content-Type":"application/json",Accept:"application/json"}};bt()(n).then((function(e){console.log("Successfully saved grid data and network"),u(Ae(!1)),j(),p()})).catch((function(e){console.log("%c"+e),console.log("ERROR:",e),p()}))};return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(F.a,{disabled:b.length>=10,variant:"outlined",color:"default",onClick:function(){i(!0)},startIcon:Object(B.jsx)(dt.a,{}),children:"Save Scenario"}),Object(B.jsxs)(Cn.a,{open:a,onClose:p,"aria-labelledby":"form-dialog-title",children:[Object(B.jsx)(In.a,{id:"form-dialog-title",children:"Save Scenario"}),Object(B.jsxs)(Dn.a,{children:[Object(B.jsx)(Tn.a,{children:"Name:"}),Object(B.jsx)(nt.a,{autoFocus:!0,margin:"dense",id:"name",fullWidth:!0,value:s,onChange:function(e){return l(e.target.value)}})]}),Object(B.jsxs)(wn.a,{children:[Object(B.jsx)(F.a,{onClick:p,color:"default",children:"Cancel"}),Object(B.jsx)(F.a,{onClick:function(){u(Ae(!0)),function(){var e={method:"get",url:wt.cityIO.baseURL+d+"/meta/hashes",headers:{"Content-Type":"application/json",Accept:"application/json"}};bt()(e).then((function(e){var t=Object.keys(e.data).filter((function(e){return e.includes("scenarios")})).map((function(e){return parseInt(e.replace("scenarios",""))}));console.log("successfully got scenarios");var n=t.length?Math.max.apply(Math,Object(Ke.a)(t))+1:0;O(n)})).catch((function(e){console.log("Error getting scenarios",e)}))}()},color:"default",children:"Save"})]})]})]})}var Mn=n(572),Rn=n.n(Mn);var Nn=function(e){var t=Object(je.d)((function(e){return e.CITYIO})),n=Object(je.d)((function(e){return e.SCENARIO_NAMES})),a=Object(je.c)();return Object(B.jsx)(I.a,{children:n.map((function(e){return Object(B.jsxs)(P.a,{children:[Object(B.jsx)(F.a,{style:{textTransform:"none"},onClick:function(){a(Ae(!0)),function(e,n){var a={method:"get",url:wt.cityIO.baseURL+e+"/scenarios"+n,headers:{"Content-Type":"application/json",Accept:"application/json"}};bt()(a).then((function(e){var n=e.data.GEOGRIDDATA;nn(n,t.tableName,"/GEOGRIDDATA")})).catch((function(e){console.log("ERROR:",e)}))}(t.tableName,e.id)},children:Object(B.jsx)(A.a,{variant:"h6",children:e.name})}),Object(B.jsx)(F.a,{onClick:function(){a(Ae(!0)),function(e,n){var r={method:"get",url:wt.cityIO.baseURL+"clear/"+e+"/scenarios"+n,headers:{"Content-Type":"application/json",Accept:"application/json"}};bt()(r).then((function(e){Mt(t.tableName,(function(e){return a(Re(e))}),(function(e){return a(Ae(e))}))})).catch((function(e){console.log("ERROR:",e)}))}(t.tableName,e.id)},children:Object(B.jsx)(Rn.a,{})})]},e.id)}))})};function Gn(e){var t=e.tableName;return Object(B.jsxs)(I.a,{children:[Object(B.jsx)(P.a,{children:Object(B.jsx)(An,{tableName:t})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(Bt.a,{})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(Nn,{})})]})}var _n=n(573),kn=n.n(_n),Ln=n(574),Pn=n.n(Ln);var Fn=function(e){var t=e.tableName,n=Object(je.d)((function(e){return e.MENU})),a=Object(je.c)(),r=function(e){return function(){var t=n.indexOf(e),r=Object(Ke.a)(n);-1===t?r.push(e):r.splice(t,1),a({type:Ee,data:r})}};return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)(I.a,{children:[Object(B.jsx)(P.a,{children:Object(B.jsx)(A.a,{variant:"h2",children:"Grid Edit"})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(F.a,{startIcon:n.includes("EDIT")?Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(dt.a,{}),"Send to cityIO"]}):Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(kn.a,{}),"Edit Mode"]}),color:"default",onClick:r("EDIT")})}),Object(B.jsx)(un,{}),Object(B.jsx)(P.a,{children:Object(B.jsx)(A.a,{variant:"h2",children:"Scenarios"})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(Gn,{tableName:t,handleToggle:r})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(A.a,{variant:"h2",children:"View Options"})}),Object(B.jsx)(P.a,{children:Object(B.jsx)(F.a,{startIcon:Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(Pn.a,{}),"Reset View"]}),color:"default",onClick:r("RESET_VIEW")})})]}),Object(B.jsx)(En,{handleToggle:r})]})},Bn=n(575),Wn=n.n(Bn),zn=function(e){if(!e.mousePos||!e.hoveredCells)return null;var t=e.selectedType,n=e.hoveredCells.object.properties.interactive,a=e.mousePos,r=e.divSize,i=t.color;$t(i)&&(i=Zt(i));var o="rgb("+i[0]+","+i[1]+","+i[2]+")",c="rgba("+i[0]+","+i[1]+","+i[2]+",0.6)",s=a.clientX-r/2,l=a.clientY-r/2,u=n?t.name:"Not-interactive";return Object(B.jsx)("div",{style:{border:"2px solid",backgroundColor:e.mouseDown?c:"rgba(0,0,0,0)",borderColor:o,color:o,borderRadius:"15%",position:"fixed",zIndex:10,pointerEvents:"none",width:r,height:r,left:s,top:l},children:Object(B.jsxs)("div",{style:{position:"relative",left:r+10,fontSize:"0.8em"},children:[!n&&Object(B.jsx)(Wn.a,{}),u,":"]})})},Un=function(e){if(!e.mousePos)return null;var t=e.mousePos;return Object(B.jsxs)("div",{style:{borderRadius:"10%",position:"fixed",pointerEvents:"none",backgroundColor:"rgba(0,0,0,0.5)",padding:"1vw",color:"rgba(255,255,255,0.9)",zIndex:10,left:t.clientX,top:t.clientY,fontFamily:"monospace",fontSize:"0.65em",fontWeight:500},children:[Object(B.jsxs)("p",{children:["Type:",e.hoveredObj.object.properties.name]}),Object(B.jsxs)("p",{children:["Floors:",e.hoveredObj.object.properties.height]}),Object(B.jsxs)("p",{children:["ID:",e.hoveredObj.object.properties.id]})]})};function Jn(e){var t=e.editOn,n=e.mousePos,a=e.selectedType,r=e.pickingRadius,i=e.mouseDown,o=e.hoveredObj;return t?a&&Object(B.jsx)(zn,{mousePos:n,selectedType:a,divSize:r,mouseDown:i,hoveredCells:o}):o&&Object(B.jsx)(Un,{mousePos:n,hoveredObj:o})}var Vn=function(e){Object(le.a)(n,e);var t=Object(ue.a)(n);function n(e){var a;return Object(ce.a)(this,n),(a=t.call(this,e)).animationFrame=null,a}return Object(se.a)(n,[{key:"componentWillUnmount",value:function(){this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)}},{key:"componentDidMount",value:function(){this._animate()}},{key:"_animate",value:function(){var e=this.props,t=e.toggles,n=t.rotateOn,a=t.ABMOn,r=e.state,i=r.viewState,o=r.sliders,c=e.updaters,s=c.listenToSlidersEvents,l=c.sunEffects,u=c.setViewState,d=e.dispatch;if(n){var j=i.bearing?i.bearing:0;j<360?j+=.05:j=0,u(Object(_.a)(Object(_.a)({},i),{},{bearing:j}))}if(a){var p=o.time[1],h=o.speed,b=o.time[0],O=o.time[2],f=parseInt(p)+parseInt(h);(p<b||p>O)&&(f=b),d(s(Object(_.a)(Object(_.a)({},o),{},{time:[o.time[0],f,o.time[2]]}))),l&&l.updateSunDirection(f)}this.animationFrame=window.requestAnimationFrame(this._animate.bind(this))}},{key:"render",value:function(){return null}}]),n}(a.Component),Yn=n(821);function Hn(e){var t=e.data,n=e.accessToggle;return new Yn.a({id:"ACCESS",colorRange:wt.map.layers.heatmap.colors,radiusPixels:200,opacity:.5,threshold:.5,data:t,getPosition:function(e){return e.coordinates},getWeight:function(e){return e.values[n]},updateTriggers:{getWeight:[n]}})}var qn=n(331);function Xn(e){var t=e.data,n=e.cityioData,a=e.ABMmode;return new qn.a({id:"AGGREGATED_TRIPS",_shadow:!1,data:t,getPath:function(e){var t=Math.random()<.5?5e-5*Math.random():-5e-5*Math.random();for(var n in e.path)e.path[n][0]=e.path[n][0]+t,e.path[n][1]=e.path[n][1]+t,e.path[n][2]=2*e.mode[0];return e.path},getColor:function(e){return Zt(n.ABM2.attr[a][e[a]].color)},opacity:.2,getWidth:1.5,updateTriggers:{getColor:a},transitions:{getColor:500}})}var Kn=n(817);function Qn(e){var t,n=e.data,a=e.cityioData,r=e.ABMmode,i=e.zoomLevel,o=e.sliders;return new Kn.a({id:"ABM",data:n,getPath:function(e){return e.path},getTimestamps:function(e){return e.timestamps},getColor:function(e){return Zt(a.ABM2.attr[r][e[r]].color)},getWidth:1,widthScale:(t=i,t>15&&t<25?3:t<15&&t>10?12:30),opacity:.8,rounded:!0,trailLength:500,currentTime:o.time[1],updateTriggers:{getColor:r},transitions:{getColor:500}})}function Zn(e){var t=e.data,n=e.editOn,a=e.state,r=a.selectedType,i=a.keyDownState,o=a.selectedCellsState,c=a.pickingRadius,s=e.updaters,l=s.setSelectedCellsState,u=s.setDraggingWhileEditing,d=s.setHoveredObj,j=e.deckGL;return new be.a({id:"GRID",data:t,pickable:!0,extruded:!0,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:2,getElevation:function(e){return e.properties.height},getFillColor:function(e){return e.properties.color},onClick:function(e){r&&n&&"Shift"!==i&&an(e,r,l,c,j)},onDrag:function(e){r&&n&&"Shift"!==i&&an(e,r,l,c,j)},onDragStart:function(){r&&n&&"Shift"!==i&&u(!0)},onHover:function(e){e.object&&d(e)},onDragEnd:function(){u(!1)},updateTriggers:{getFillColor:o,getElevation:o},transitions:{getFillColor:500,getElevation:500}})}var $n=n(825);function ea(e){var t=e.data,n=e.coordinates;if(t&&n&&n.features){var a=[];return t.forEach((function(e){a.push({coordinates:[n.features[e.id].geometry.coordinates[0][0][0],n.features[e.id].geometry.coordinates[0][0][1],100],info:e.info})})),new $n.a({id:"text-layer",data:a,pickable:!0,getPosition:function(e){return e.coordinates},getText:function(e){return e.info},getColor:[255,255,255],getSize:30,getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"center"})}}function ta(){var e=Object(a.useState)(!1),t=Object(m.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(null),o=Object(m.a)(i,2),c=o[0],s=o[1],l=Object(a.useState)(wt.map.initialViewState),u=Object(m.a)(l,2),d=u[0],j=u[1],p=Object(a.useState)(null),h=Object(m.a)(p,2),b=h[0],O=h[1],f=Object(a.useState)(null),g=Object(m.a)(f,2),x=g[0],v=g[1],y=Object(a.useState)(null),S=Object(m.a)(y,2),E=S[0],C=S[1],I=Object(a.useState)(null),D=Object(m.a)(I,2),T=D[0],w=D[1],A=Object(a.useState)(null),M=Object(m.a)(A,2),R=M[0],N=M[1],G=Object(a.useState)(null),k=Object(m.a)(G,2),L=k[0],P=k[1],F=Object(a.useState)(null),W=Object(m.a)(F,2),z=W[0],U=W[1],J=Object(a.useState)({}),V=Object(m.a)(J,2),Y=V[0],H=V[1],q=Object(a.useState)(!1),X=Object(m.a)(q,2),K=X[0],Q=X[1],Z=Object(a.useRef)(),$=Object(a.useRef)(),ee=Object(je.c)(),te=Object(je.d)((function(e){return[e.CITYIO,e.SLIDERS,e.MENU,e.ACCESS_TOGGLE,e.SELECTED_TYPE,e.ABM_MODE]})),ne=Object(m.a)(te,6),ae=ne[0],re=ne[1],ie=ne[2],oe=ne[3],ce=ne[4],se=ne[5],le=ie.includes("ABM"),ue=ie.includes("ROTATE"),de=ie.includes("SHADOWS"),be=ie.includes("EDIT"),Oe=ie.includes("RESET_VIEW");Object(a.useEffect)((function(){me(),on(Z,ae.GEOGRID.properties.header),fe(),Q(!0)}),[]),Object(a.useEffect)((function(){K&&cn(re.time[1],Z)}),[re.time]),Object(a.useEffect)((function(){if(K){var e=de?[0,0,0,.5]:[0,0,0,0];Z.current[0].shadowColor=e}}),[de]),Object(a.useEffect)((function(){U(en(ae)),ae.access&&N(tn(ae)),ae.textual&&P(ae.textual),ae.ABM2&&H(ae.ABM2)}),[ae]),Object(a.useEffect)((function(){if(K&&!be){for(var e=[],t=0;t<z.features.length;t++)e[t]=z.features[t].properties;nn(e,ae.tableName,"/GEOGRIDDATA")}}),[be]),Object(a.useEffect)((function(){K&&fe()}),[Oe]);var fe=function(){var e=ae.GEOGRID.properties.header;j(Object(_.a)(Object(_.a)({},d),{},{longitude:e.longitude,latitude:e.latitude,zoom:15,pitch:0,bearing:360-e.rotation,orthographic:!0}))},me=function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}))},ge={ABM:Qn({data:Y.trips,cityioData:ae,ABMmode:se,zoomLevel:d.zoom,sliders:re}),AGGREGATED_TRIPS:Xn({data:Y.trips,cityioData:ae,ABMmode:se}),GRID:Zn({data:z,editOn:ie.includes("EDIT"),state:{selectedType:ce,keyDownState:b,selectedCellsState:c,pickingRadius:40},updaters:{setSelectedCellsState:s,setDraggingWhileEditing:r,setHoveredObj:w},deckGL:$}),ACCESS:Hn({data:R,accessToggle:oe}),TEXTUAL:ea({data:L&&L,coordinates:z})},xe=["TEXTUAL","ABM","AGGREGATED_TRIPS","GRID","ACCESS"];return Object(B.jsxs)("div",{className:"baseMap",onKeyDown:function(e){O(e.nativeEvent.key)},onKeyUp:function(){return O(null)},onMouseMove:function(e){return v(e.nativeEvent)},onMouseUp:function(){return C(!1)},onMouseDown:function(){return C(!0)},children:[Object(B.jsx)(Jn,{editOn:be,mousePos:x,selectedType:ce,pickingRadius:40,mouseDown:E,hoveredObj:T}),Object(B.jsx)(Vn,{toggles:{ABMOn:le,rotateOn:ue},state:{sliders:re,viewState:d},updaters:{listenToSlidersEvents:ve,updateSunDirection:cn,setViewState:j},dispatch:ee}),Object(B.jsx)(he.a,{ref:$,viewState:d,onViewStateChange:function(e){var t=e.viewState;j(t)},layers:function(){var e,t=[],n=Object(At.a)(xe);try{for(n.s();!(e=n.n()).done;){var a=e.value;ie.includes(a)&&t.push(ge[a])}}catch(r){n.e(r)}finally{n.f()}return t}(),effects:Z.current,controller:{touchZoom:!0,touchRotate:!0,dragPan:!n,dragRotate:!n,keyboard:!1},children:Object(B.jsx)(pe.a,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:wt.map.mapStyle.sat,preventStyleDiffing:!0})})]})}var na=n(467),aa=function(){var e=Object(je.d)((function(e){return[e.LOADING_MODULES]})),t=Object(m.a)(e,1)[0];return Object(B.jsx)(B.Fragment,{children:t.map((function(e,t){return Object(B.jsxs)(C.a,{position:"fixed",bottom:50*t,right:"2vw",width:"10vw",zIndex:"101",margin:"0",children:[Object(B.jsx)(na.a,{color:"secondary"}),Object(B.jsx)(A.a,{variant:"h6",color:"primary",style:{marginRight:"10px"},children:e})]},e)}))})},ra=function(){return Object(B.jsxs)(ne.a,{maxWidth:"md",children:[Object(B.jsx)(C.a,{mt:"3em"}),Object(B.jsx)(A.a,{color:"textPrimary",variant:"h1",children:"CityScopeJS"}),Object(B.jsx)(C.a,{mt:"3em"}),Object(B.jsx)(A.a,{color:"textPrimary",variant:"h5",children:"Enter your CityScopeJS project name in the search bar:"}),Object(B.jsx)(A.a,{variant:"h5",color:"textSecondary",children:"(this page URL)/CS_CityScopeJS/?cityscope=projectName"}),Object(B.jsx)(C.a,{mt:"3em"})]})},ia=(n(376),n(757),300),oa=["#ff5278","#660016"];function ca(e){var t=Object(a.useState)(null),n=Object(m.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){if(e&&e.cityioData&&e.cityioData.indicators&&e.cityioData.indicators.length>0){var t=function(e){for(var t={},n={},a=[],r=0;r<e.length;r++)"radar"===e[r].viz_type&&(t[e[r].name]=[e[r].value],n[e[r].name]=[e[r].ref_value],e[r].domain=[0,1],a.push(e[r]));return{radarData:[t,n],domains:a}}(e.cityioData.indicators);i(t)}}),[e]),Object(B.jsx)("div",{children:r&&r.domains&&Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(sn.f,{className:"Radar blur",animation:!0,data:r.radarData,domains:r.domains,colorRange:oa,style:{polygons:{fillOpacity:.2,strokeWidth:2},axes:{text:{opacity:0,fontWeight:700,fill:"white",fontFamily:"Roboto Mono"},strokeWidth:0},labels:{fontFamily:"Roboto Mono",textAnchor:"middle",fontSize:10,fill:"white"}},margin:{left:50,top:50,bottom:50,right:50},width:ia,height:ia,children:Object(B.jsx)(sn.a,{style:{fill:"white",fillOpacity:.1,backgroundColor:"#FFF",opacity:.5,stroke:"white",width:.1},tickValues:Object(Ke.a)(new Array(11)).map((function(e,t){return t/10-1}))})}),Object(B.jsx)(sn.c,{items:["Design","Reference"],colors:oa,style:{fontFamily:"Roboto Mono"}})]})})}function sa(e){var t=Object(a.useState)(null),n=Object(m.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)(null),c=Object(m.a)(o,2),s=c[0],l=c[1];Object(a.useEffect)((function(){if(e&&e.cityioData&&e.cityioData.indicators&&e.cityioData.indicators.length>0){var t=u(e.cityioData.indicators);i(t.barChartData)}}),[e]);var u=function(e){for(var t=[],n=0;n<e.length;n++)"bar"===e[n].viz_type&&t.push({x:e[n].name,y:e[n].value});return{barChartData:t}};return Object(B.jsx)(B.Fragment,{children:r&&Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)(C.a,{flexDirection:"column",children:[Object(B.jsx)(C.a,{alignContent:"center",p:3,children:Object(B.jsxs)(sn.d,{opacity:.2,xType:"ordinal",width:250,height:250,stackBy:"y",yDomain:[0,1],children:[Object(B.jsx)(sn.i,{style:{text:{fill:"#FFF",fontFamily:"Roboto Mono"}},tickLabelAngle:90}),Object(B.jsx)(sn.j,{style:{text:{fill:"#FFF"}}}),Object(B.jsx)(sn.h,{animation:!0,onValueMouseOver:function(e){l(e)},data:r})]})}),Object(B.jsx)(C.a,{alignContent:"center",children:s&&Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(A.a,{variant:"caption",gutterBottom:!0,children:s.x}),Object(B.jsx)(C.a,{m:3}),Object(B.jsx)(A.a,{gutterBottom:!0,children:s.y})]})})]})})})}function la(e){var t=250,n=Object(a.useState)(!1),r=Object(m.a)(n,2),i=r[0],o=r[1],c=Object(a.useState)(null),s=Object(m.a)(c,2),l=s[0],u=s[1];return Object(a.useEffect)((function(){var t=function(){var t=e.cityioData.GEOGRID.properties.header.cellSize,n=e.cityioData.GEOGRIDDATA,a={};n.forEach((function(e){var n=e.name;if("None"!==e.name)if(a.hasOwnProperty(n)){a[n].count=a[n].count+1;var r=e.height<1?1:e.height;a[n].area=a[n].area+r*t}else a[n]={},a[n].area=0,a[n].count=0,a[n].name=n,a[n].color=function(e,t,n){function a(e){var t=e.toString(16);return 1===t.length?"0"+t:t}return"#"+a(e)+a(t)+a(n)}(e.color[0],e.color[1],e.color[2])}));var r=[];for(var i in a)r.push(a[i]);return{children:r,color:1}}();u(t)}),[e]),Object(B.jsxs)(I.a,{children:[l&&l.children&&Object(B.jsx)(P.a,{alignItems:"center",children:Object(B.jsx)(sn.g,{colorType:"literal",animation:!0,className:"donut-chart-example",innerRadius:75,radius:125,getLabel:function(e){return e.name},labelsRadiusMultiplier:.95,labelsStyle:{textAnchor:"middle",font:"sans-serif",fontSize:11,fill:"#FFF",textShadow:"2px 2px 2px #000",fontFamily:"Roboto Mono"},showLabels:!0,getAngle:function(e){return e.area},data:l.children,onValueMouseOver:function(e){return o(e)},onSeriesMouseOut:function(){return o(!1)},width:t,height:t,padAngle:.01,children:!1!==i&&Object(B.jsx)(sn.e,{value:i,children:Object(B.jsx)("div",{style:{background:"rgba(0,0,0,0.8)",fontSize:14},children:Object(B.jsxs)(A.a,{variant:"caption",gutterBottom:!0,children:["Area: ",i.area," sqm"]})})})})}),i.name&&Object(B.jsxs)(I.a,{children:[Object(B.jsx)(P.a,{children:Object(B.jsx)(A.a,{variant:"caption",children:i.name})}),Object(B.jsx)(P.a,{children:Object(B.jsxs)(A.a,{children:[i.area," sqm"]})})]})]})}var ua=function(e){return Object(B.jsx)(B.Fragment,{children:e.cityIOdata&&Object(B.jsxs)(I.a,{children:[Object(B.jsx)(P.a,{alignItems:"center",children:Object(B.jsx)(la,{cityioData:e.cityIOdata})}),Object(B.jsx)(Bt.a,{}),Object(B.jsx)(P.a,{children:Object(B.jsx)(ca,{cityioData:e.cityIOdata})}),Object(B.jsx)(Bt.a,{}),Object(B.jsx)(P.a,{children:Object(B.jsx)(sa,{cityioData:e.cityIOdata})})]})})},da=Object(u.a)((function(e){return{root:{"& > *":{margin:e.spacing(1)}}}}));function ja(e){var t=e.setSelectedTable,n=da(),r=Object(a.useState)(),i=Object(m.a)(r,2),o=i[0],c=i[1];return Object(a.useEffect)((function(){var e=[],n=wt.cityIO.ListOfTables,a=wt.cityIO.baseURL;bt.a.get(n).then((function(n){n.data.forEach((function(n){var r=function(e,t){var n=e.indexOf(t);return e.slice(0,n)+e.slice(n+t.length,e.length)}(n,a);e.push(Object(B.jsx)(F.a,{variant:"outlined",color:"secondary",onClick:function(){bt.a.get(a+r+"/GEOGRID").then((function(e){200===e.status&&t(r)})).catch((function(e){console.log(e)}))},children:r},Math.random()))})),c(e)}))}),[t]),Object(B.jsx)("div",{className:n.root,children:o})}var pa=Object(u.a)((function(e){return{root:{margin:"auto",height:"100%",paddingBottom:e.spacing(3),paddingTop:e.spacing(3)}}}));function ha(){var e=pa(),t=Object(a.useState)(null),n=Object(m.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)(null),c=Object(m.a)(o,2),s=c[0],l=c[1];Object(a.useEffect)((function(){var e=window.location.toString(),t="cityscope=",n=e.substring(e.indexOf(t)+t.length);-1!==e.indexOf(t)&&n.length>0&&l(n)}),[]),Object(a.useEffect)((function(){if(console.log(r),r){var e=window.location.toString();window.location.replace(e+"?cityscope="+r)}}),[r]);var u=Object(je.d)((function(e){return e.READY})),d=Object(je.d)((function(e){return e.CITYIO}));return Object(B.jsx)(re,{className:e.root,title:"CitySCopeJS",children:Object(B.jsxs)(ne.a,{maxWidth:null,children:[!u&&Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)(ne.a,{maxWidth:"md",children:[Object(B.jsx)(ra,{}),Object(B.jsx)(ja,{setSelectedTable:i})]})}),s&&Object(B.jsx)(Gt,{tableName:s}),u&&Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)($e.a,{container:!0,spacing:5,children:[Object(B.jsx)($e.a,{item:!0,xs:6,l:3,md:3,xl:2,container:!0,children:Object(B.jsx)($e.a,{item:!0,container:!0,direction:"column",spacing:2,children:Object(B.jsx)($e.a,{item:!0,xs:12,l:12,md:12,xl:12,children:Object(B.jsx)(D.a,{elevation:15,style:{maxHeight:"85vh",overflow:"auto"},children:Object(B.jsx)(T.a,{children:Object(B.jsx)(Fn,{tableName:s})})})})})}),Object(B.jsx)($e.a,{item:!0,xs:6,l:6,md:6,xl:8,children:Object(B.jsx)(D.a,{elevation:15,style:{height:"85vh",width:"100%",position:"relative"},children:Object(B.jsx)(ta,{})})}),Object(B.jsx)($e.a,{item:!0,xs:6,l:3,md:3,xl:2,children:Object(B.jsx)(D.a,{elevation:15,style:{maxHeight:"85vh",overflow:"auto"},children:Object(B.jsx)(ua,{cityIOdata:d})})})]})}),Object(B.jsx)(aa,{})]})})}function ba(){var e=Object(a.useState)({author:"",branch:"",date:"",sha:"",link:""}),t=Object(m.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){fetch("https://api.github.com/repos/CityScope/CS_cityscopeJS/branches/master").then((function(e){e.json().then((function(e){r({author:e.commit.commit.author.name,date:e.commit.commit.author.date,sha:e.commit.sha})}))})).catch((function(e){console.log(e)}))}),[]),Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)(A.a,{color:"textSecondary",variant:"caption",children:[Object(B.jsx)("h2",{children:"CityScopeJS Development Tracking"}),Object(B.jsx)("h4",{children:"Last Commit"}),Object(B.jsxs)("div",{children:["Author: ",JSON.parse(JSON.stringify(n.author))]}),Object(B.jsxs)("div",{children:["Date: ",JSON.parse(JSON.stringify(n.date))]}),Object(B.jsxs)("div",{children:["Hash: ",JSON.parse(JSON.stringify(n.sha))]})]})})}var Oa=Object(u.a)((function(e){return{root:{margin:"auto",height:"100%",paddingBottom:e.spacing(3),paddingTop:e.spacing(3)},gridCell:{textAlign:"center"},divider:{margin:e.spacing(3)}}}));function fa(){var e=Oa();return Object(B.jsx)(re,{className:e.root,title:"Home",children:Object(B.jsxs)(ne.a,{maxWidth:"sm",className:e.content,children:[Object(B.jsx)(A.a,{color:"textPrimary",variant:"h1",children:"CityScopeJS"}),Object(B.jsx)(Bt.a,{className:e.divider,light:!0}),Object(B.jsx)(A.a,{color:"textPrimary",variant:"h5",children:"CityScopeJS is a unified front-end for MIT CityScope project, an open-source urban modeling and simulation platform. CityScopeJS allows users to examine different urban-design alternatives, and observe their impact through multiple layers of urban analytics modules, such as economy, traffic and ABM simulation, urban access, storm-water, noise and more."}),Object(B.jsx)(Bt.a,{className:e.divider,light:!0}),Object(B.jsxs)($e.a,{container:!0,spacing:2,children:[Object(B.jsx)($e.a,{item:!0,xs:12,l:6,md:6,xl:6,children:Object(B.jsx)(A.a,{color:"textPrimary",variant:"h6",gutterBottom:!0,children:"CityScopeJS is an open-source project, developed by MIT, the CityScope Network, and contributers from all over the world. Join us!"})}),Object(B.jsx)($e.a,{item:!0,xs:12,l:6,md:6,xl:6,className:e.gridCell,children:Object(B.jsx)(w.a,{href:"http://github.com/CityScope/CS_cityscopeJS/",color:"default",children:Object(B.jsx)(x.a,{})})})]}),Object(B.jsx)(Bt.a,{className:e.divider,light:!0}),Object(B.jsx)(C.a,{flex:1,children:Object(B.jsx)(ba,{})})]})})}var ma=function(){var e=Object(Tt.a)(Dt.a.mark((function e(t){var n;return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,bt.a.get(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();function ga(e){var t=e.tableName,n=Object(a.useState)(null),r=Object(m.a)(n,2),i=r[0],o=r[1],c=Object(a.useState)({}),s=Object(m.a)(c,2),l=s[0],u=s[1],d=wt.cityIO.baseURL+t,j=Object(je.d)((function(e){return e.CITYIO})),p=Object(je.c)();function h(){return b.apply(this,arguments)}function b(){return(b=Object(Tt.a)(Dt.a.mark((function e(){var t;return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ma(d+"/meta/id");case 2:t=e.sent,i!==t&&o(t),setTimeout(h,wt.cityIO.interval);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=Object(Tt.a)(Dt.a.mark((function e(){var n,a,r,i,o,c;return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ma(d+"/meta/hashes");case 2:return n=e.sent,a=[],r=[],(i=wt.cityIO.cityIOmodules.map((function(e){return e.name}))).forEach((function(e){l[e]!==n[e]?(a.push(ma(d+"/"+e)),r.push(e)):a.push(null)})),p(Ge(r)),e.next=10,Promise.all(a);case 10:o=e.sent,u(n),(c=i.reduce((function(e,t,n){return o[n]?(console.log("updating ".concat(t)),Object(_.a)(Object(_.a)({},e),{},Object(tt.a)({},t,o[n]))):e}),j)).tableName=t,p(ke(r)),p(me(c)),console.log("done updating from cityIO"),p(Te(!0)),p(Ae(!1));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){var e=setTimeout(h,wt.cityIO.interval);return console.log("reading cityIO every -> "+wt.cityIO.interval+"ms"),function(){return clearTimeout(e)}}),[]),Object(a.useEffect)((function(){i&&(p(Ae(!0)),function(){O.apply(this,arguments)}())}),[i]),null}function xa(e){var t=e.active,n=e.data,a=e.accessToggle;return new Yn.a({visible:t,id:"ACCESS",colorRange:wt.map.layers.heatmap.colors,radiusPixels:200,opacity:.5,threshold:.5,data:n,getPosition:function(e){return e.coordinates},getWeight:function(e){return e.values[a]},updateTriggers:{getWeight:[a]}})}function va(e){var t=e.active,n=e.data,a=e.cityioData,r=e.ABMmode;return new qn.a({visible:t,id:"AGGREGATED_TRIPS",_shadow:!1,data:n,getPath:function(e){var t=Math.random()<.5?5e-5*Math.random():-5e-5*Math.random();for(var n in e.path)e.path[n][0]=e.path[n][0]+t,e.path[n][1]=e.path[n][1]+t,e.path[n][2]=2*e.mode[0];return e.path},getColor:function(e){return Zt(a.ABM2.attr[r][e[r]].color)},opacity:.2,getWidth:1.5,updateTriggers:{getColor:r},transitions:{getColor:500}})}function ya(e){var t,n=e.active,a=e.data,r=e.cityioData,i=e.ABMmode,o=e.zoomLevel,c=e.time;return new Kn.a({id:"ABM",data:a,getPath:function(e){return e.path},getTimestamps:function(e){return e.timestamps},getColor:function(e){return Zt(r.ABM2.attr[i][e[i]].color)},visible:n,getWidth:1,widthScale:(t=o,t>15&&t<25?3:t<15&&t>10?12:30),opacity:.8,rounded:!0,trailLength:500,currentTime:c,updateTriggers:{getColor:i},transitions:{getColor:500}})}function Sa(e){var t=e.active,n=e.data;return new be.a({visible:t,id:"GRID",data:n,extruded:!0,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:2,getElevation:function(e){return e.properties.height},getFillColor:function(e){return e.properties.color},transitions:{getFillColor:500,getElevation:500}})}function Ea(e){var t=Object(a.useState)(wt.map.initialViewState),n=Object(m.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)(null),c=Object(m.a)(o,2),s=c[0],l=c[1],u=Object(a.useState)(null),d=Object(m.a)(u,2),j=d[0],p=d[1],h=Object(a.useState)({}),b=Object(m.a)(h,2),O=b[0],f=b[1],g=Object(a.useRef)(),x=Object(a.useRef)(),v=Object(je.d)((function(e){return[e.CITYIO]})),y=Object(m.a)(v,1)[0],S=Object(je.d)((function(e){return e.UI_WEBSOCKET_DATA}));Object(a.useEffect)((function(){g.current&&cn(e.viewSettings.time,g)}),[e.viewSettings]);Object(a.useEffect)((function(){if(E(),on(g,y.GEOGRID.properties.header),localStorage.getItem("deckGLviewState")){console.log("loading prev. deckGLviewState...");var e=localStorage.getItem("deckGLviewState");i(JSON.parse(e))}else!function(){var e=y.GEOGRID.properties.header;i(Object(_.a)(Object(_.a)({},r),{},{longitude:e.longitude,latitude:e.latitude,zoom:15,pitch:0,bearing:360-e.rotation,orthographic:!0}))}();g.current[0].shadowColor=[0,0,0,1]}),[y.GEOGRID.properties.header]),Object(a.useEffect)((function(){p(en(y)),y.access&&l(tn(y)),y.ABM2&&f(y.ABM2)}),[y]);var E=function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}))},C={ABM:ya({active:S.ABMLayer.active,data:O.trips,cityioData:y,ABMmode:S.ABMLayer.ABMmode,zoomLevel:S.ABMLayer.zoomLevel,time:S.time}),AGGREGATED_TRIPS:va({active:S.AggregatedTripsLayer.active,data:O.trips,cityioData:y,ABMmode:S.AggregatedTripsLayer.ABMmode}),GRID:Sa({active:S.GridLayer.active,data:j}),ACCESS:xa({active:S.AccessLayer.active,data:s,accessToggle:S.AccessLayer.accessToggle})},I=["ABM","AGGREGATED_TRIPS","GRID","ACCESS"];return Object(B.jsx)(he.a,{ref:x,viewState:r,onViewStateChange:function(e){var t=e.viewState;localStorage.setItem("deckGLviewState",JSON.stringify(t)),i(t)},layers:function(){var e,t=[],n=Object(At.a)(I);try{for(n.s();!(e=n.n()).done;){var a=e.value;t.push(C[a])}}catch(r){n.e(r)}finally{n.f()}return t}(),effects:g.current,controller:{keyboard:!1},children:Object(B.jsx)(pe.a,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:wt.map.mapStyle.sat,preventStyleDiffing:!0})})}var Ca=n(758).solve,Ia=function(e,t){for(var n=[],a=[],r=0,i=e.length;r<i;++r){var o=Object(m.a)(e[r],2),c=o[0],s=o[1],l=Object(m.a)(t[r],2),u=l[0],d=l[1];n.push([c,s,1,0,0,0,-c*u,-s*u],[0,0,0,c,s,1,-c*d,-s*d]),a.push(u,d)}var j=Ca(n,a,!0);return[j[0],j[3],0,j[6],j[1],j[4],0,j[7],0,0,1,0,j[2],j[5],0,1].map((function(e){return function(e,t){var n=Math.pow(10,t),a=e*n;return Math.round(a)/n}(e,10)}))},Da=function(e){return"matrix3d(".concat(e.join(", "),")")},Ta=function(e){return"translate(".concat(e[0],"px, ").concat(e[1],"px)")},wa=20/1.5,Aa={container:{width:20,height:20,borderRadius:"50%",position:"absolute",border:"1px solid white",cursor:"move"},"top-left":{left:-wa,top:-wa},"bottom-left":{left:-wa,bottom:-wa},"top-right":{top:-wa,right:-wa},"bottom-right":{bottom:-wa,right:-wa}},Ma=function(e){var t=e.position,n=e.translation,a=e.onMouseEnter,r=e.onMouseDown,i=e.onMouseUp,o=e.className,c=void 0===o?"":o,s=e.style,l=void 0===s?{}:s;return Object(B.jsx)("div",{onMouseEnter:function(){return a&&a(t)},onMouseDown:function(e){return r(e,t)},onMouseUp:function(){return i(t)},className:c,style:Object(_.a)(Object(_.a)(Object(_.a)(Object(_.a)({},Aa.container),Aa[t]),l),{},{transform:Ta(n)})})},Ra={position:"relative"},Na=["top-left","top-right","bottom-right","bottom-left"],Ga=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_a=function(){var e={};return Na.forEach((function(t){e[t]=[0,0]})),e},ka=function(e){Object(le.a)(n,e);var t=Object(ue.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).container=void 0,e.layerTranslateDelta=void 0,e.anchorTranslateDelta=void 0,e.isAnchorDragging=!1,e.targetPoints=void 0,e.anchorMoving=void 0,e.state={matrix:Ga,translateDelta:_a(),sourcePoints:void 0,transformOrigin:[0,0],containerTranslate:[e.props.x||0,e.props.y||0]},e.onAnchorMouseDown=function(t,n){t.stopPropagation(),e.anchorTranslateDelta=[t.pageX-e.state.translateDelta[n][0],t.pageY-e.state.translateDelta[n][1]],e.anchorMoving=n},e.onAnchorMouseMove=function(t){if(e.anchorTranslateDelta&&e.state.sourcePoints&&e.anchorMoving){t.preventDefault(),t.stopPropagation();var n=Na.indexOf(e.anchorMoving),a=t.pageX-e.anchorTranslateDelta[0],r=t.pageY-e.anchorTranslateDelta[1];e.targetPoints[n]=[e.state.sourcePoints[n][0]+a,e.state.sourcePoints[n][1]+r],e.setState({matrix:Ia(e.state.sourcePoints,e.targetPoints),translateDelta:Object(_.a)(Object(_.a)({},e.state.translateDelta),{},Object(tt.a)({},e.anchorMoving,[a,r]))})}},e.onAnchorMouseUp=function(t){e.anchorTranslateDelta=void 0,e.anchorMoving=void 0},e.onMouseUp=function(){e.layerTranslateDelta=void 0},e.onMouseMove=function(t){if(e.layerTranslateDelta&&e.props.isEditMode){var n=[t.pageX-e.layerTranslateDelta[0],t.pageY-e.layerTranslateDelta[1]];e.setState({containerTranslate:n})}},e.onMouseDown=function(t){var n=e.state.containerTranslate;e.layerTranslateDelta=[t.pageX-n[0],t.pageY-n[1]]},e}return Object(se.a)(n,[{key:"componentDidMount",value:function(){if(window.addEventListener("mousemove",this.onAnchorMouseMove),window.addEventListener("mousemove",this.onMouseMove),this.container){var e=this.container.getBoundingClientRect(),t=e.width,n=e.height,a=[[0,0],[t,0],[t,n],[0,n]];if(this.targetPoints=[].concat(a),this.setState({sourcePoints:a}),localStorage.getItem("projMap")){console.log("loading prev. projMap...");var r=localStorage.getItem("projMap");this.setState(JSON.parse(r))}}}},{key:"componentDidUpdate",value:function(e,t){console.log("saving edited projMap...",JSON.stringify(t)),localStorage.setItem("projMap",JSON.stringify(t))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onAnchorMouseMove),window.removeEventListener("mousemove",this.onMouseMove)}},{key:"render",value:function(){var e=this,t=this.props,n=t.style,a=t.isEditMode,r=t.className,i=t.anchorStyle,o=t.anchorClassName,c=this.state,s=c.translateDelta,l=c.matrix,u=c.containerTranslate,d=c.transformOrigin;return Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)("div",{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,style:{cursor:a?"all-scroll":"inherit",position:"relative",display:"inline-block",transform:Ta(u)},children:[Object(B.jsx)("div",{ref:function(t){e.container=t},style:Object(_.a)(Object(_.a)(Object(_.a)({},Ra),n),{},{pointerEvents:a?"none":"all",transform:Da(l),transformOrigin:"".concat(d[0],"px ").concat(d[1],"px 0px")}),className:r,children:this.props.children}),a&&Object(B.jsx)("div",{children:Na.map((function(t,n){return Object(B.jsx)(Ma,{style:i,className:o,translation:s[t],position:t,onMouseDown:e.onAnchorMouseDown,onMouseUp:e.onAnchorMouseUp},t)}))})]})})}}]),n}(a.Component),La=n(577),Pa=n.n(La),Fa=Object(u.a)((function(e){return{button:{margin:e.spacing(1),position:"fixed",bottom:"1vh",zIndex:1001,maxWidth:"50vw"}}}));function Ba(){var e=Fa();return Object(B.jsx)($e.a,{container:!0,alignItems:"center",justify:"center",children:Object(B.jsx)(F.a,{variant:"contained",color:"secondary",className:e.button,startIcon:Object(B.jsx)(Pa.a,{}),children:"Reset Projection Mapping"})})}function Wa(){var e=Object(a.useState)(!1),t=Object(m.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){var e=function(e){var t=e.key;" "===t&&(r((function(e){return!e})),console.log(t,n))};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[n]),Object(B.jsxs)(B.Fragment,{children:[n&&Object(B.jsx)("div",{onClick:function(){return localStorage.getItem("projMap")&&localStorage.removeItem("projMap"),localStorage.getItem("deckGLviewState")&&localStorage.removeItem("deckGLviewState"),void window.location.reload()},children:Object(B.jsx)(Ba,{})}),Object(B.jsx)("div",{style:{height:"100%",width:"100vw",overflow:"hidden",position:"fixed",top:0,left:0,zIndex:1e3},children:Object(B.jsx)("div",{children:Object(B.jsx)(ka,{style:{height:"100vh",width:"100vw"},isEditMode:n,children:Object(B.jsx)(Ea,{})})})})]})}var za=function(){var e=Object(je.c)();return Object(a.useEffect)((function(){var t=new WebSocket(wt.SOCKETS.URL);t.onopen=function(){t.send("CityScopeJS"),t.onmessage=function(t){var n=t.data;e(function(e){return{type:Pe,data:e}}(!0)),e(function(e){return{type:Le,data:e}}(JSON.parse(n)))}}}),[e]),null};function Ua(){var e=Object(je.d)((function(e){return e.READY})),t=Object(je.d)((function(e){return e.UI_WEBSOCKET_READY})),n=Object(u.a)((function(e){return{root:{"& > *":{margin:"auto",height:"100%",paddingBottom:e.spacing(3),paddingTop:e.spacing(3)}}}})),r=Object(a.useState)(null),i=Object(m.a)(r,2),o=i[0],c=i[1],s=function(){return Object(B.jsxs)(ne.a,{maxWidth:"md",children:[Object(B.jsx)(A.a,{color:"textPrimary",variant:"h1",children:"Projection tool"}),Object(B.jsx)(C.a,{mt:"3em"}),Object(B.jsx)(A.a,{color:"textPrimary",children:"This tool is used to project and display CityScopeJS tables in passive mode, such as projectors, TVs, or other non-interactive displays."}),Object(B.jsx)(C.a,{mt:"2em"}),Object(B.jsx)(A.a,{color:"textPrimary",variant:"caption",children:"start by selecting your CityScopeJS project. Press 'Spacebar' to toggle keystone. Note: Not all CityScope projects below are ready for CityScopeJS."}),Object(B.jsx)(C.a,{mt:"2em"}),Object(B.jsx)(ja,{setSelectedTable:c})]})},l=n();return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(za,{}),Object(B.jsxs)(re,{className:l.root,title:"Keystone",children:[!e&&Object(B.jsx)(s,{}),o&&Object(B.jsx)(ga,{tableName:o}),e&&t&&Object(B.jsx)(Wa,{})]})]})}var Ja=n(829),Va=n(581),Ya=n.p+"static/media/legoio.148c5ab6.png";function Ha(e){var t=Object(a.useState)([]),n=Object(m.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)(),c=Object(m.a)(o,2),s=c[0],l=c[1],u=Object(a.useState)(),d=Object(m.a)(u,2),j=d[0],p=d[1],h={longitude:-71.060929,latitude:42.3545259,zoom:2,pitch:0,bearing:0},b=Object(a.useState)(h),O=Object(m.a)(b,2)[1],f=!1;Object(a.useEffect)((function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}));var t=[];e.cityIOdata.forEach((function(e,n){t.push({index:n,info:e.tableHeader,coord:{from:[e.tableHeader.longitude,e.tableHeader.latitude],to:[e.tableHeader.longitude+Math.random(),e.tableHeader.latitude+Math.random(),1e5]}})})),i(t)}),[e]);var g=[new Ja.a({id:"arc-layer",data:r,pickable:!0,getWidth:3,getSourcePosition:function(e){return e.coord.from},getTargetPosition:function(e){return e.coord.to},getSourceColor:function(e){return[0,0,0]},getTargetColor:function(e){return[255,82,120]}}),new $n.a({id:"text-layer",data:r,pickable:!0,getPosition:function(e){return e.coord.to},getText:function(e){return e.info.tableName?e.info.tableName:"no name..."},getColor:[255,255,255],getSize:j<3?0:20,getAngle:0,getPixelOffset:[30,0],getTextAnchor:"start",getAlignmentBaseline:"center"}),new Va.a({id:"icon-layer",data:r,pickable:!0,iconAtlas:Ya,onClick:function(e){return l(e)},iconMapping:{marker:{x:0,y:0,width:768,height:768,mask:!1}},getIcon:function(e){return"marker"},sizeScale:1,getSize:j<5?75:50,getPosition:function(e){return[e.coord.to[0],e.coord.to[1],1e5]}})];return Object(B.jsxs)(B.Fragment,{children:[s&&s.object&&Object(B.jsx)(D.a,{elevation:15,style:{position:"fixed",zIndex:100,margin:50,bottom:"10vh"},children:Object(B.jsx)(T.a,{children:Object(B.jsxs)(C.a,{p:1,m:1,children:[Object(B.jsxs)(A.a,{variant:"h2",color:"textPrimary",children:["CityScope ",s.object.info.tableName]}),Object(B.jsx)(A.a,{color:"textSecondary",children:Object(B.jsx)(Ot.a,{href:"https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+s.object.info.tableName,children:"Go to this project >>>"})})]})})}),Object(B.jsx)(he.a,{onHover:function(e){var t=e.object;return f=Boolean(t)},getCursor:function(e){return e.isDragging?"grabbing":f?"crosshair":"grab"},layers:g,controller:!0,initialViewState:h,onViewportChange:O,onViewStateChange:function(e){return p(e.viewState.zoom)},ContextProvider:pe.b.Provider,children:Object(B.jsx)(pe.a,{reuseMaps:!0,preventStyleDiffing:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:Oe.map.mapStyle.sat})})]})}function qa(){var e=Object(a.useState)([]),t=Object(m.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!0),o=Object(m.a)(i,2),c=o[0],s=o[1],l=function(){var e=Object(Tt.a)(Dt.a.mark((function e(){var t,n,a;return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=wt.cityIO.ListOfTables,e.next=3,bt.a.get(t);case 3:n=e.sent,a=n.data.map(function(){var e=Object(Tt.a)(Dt.a.mark((function e(t){return Dt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",bt.a.get(t+"/GEOGRID/properties/header").then((function(e){return r((function(n){return[].concat(Object(Ke.a)(n),[{table:t,tableHeader:e.data}])}))})).catch((function(e){return console.log(e.toString())})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Promise.all(a).then((function(){}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){l().then(s(!1))}),[]),Object(B.jsx)(B.Fragment,{children:!c&&Object(B.jsx)(Ha,{cityIOdata:n})})}function Xa(){var e=Object(u.a)((function(e){return{root:{"& > *":{margin:"auto",height:"100%",paddingBottom:e.spacing(3),paddingTop:e.spacing(3)}}}}))();return Object(B.jsx)(B.Fragment,{children:Object(B.jsx)(re,{className:e.root,title:"CityScope Projects List",children:Object(B.jsxs)(ne.a,{maxWidth:!1,children:[Object(B.jsx)(D.a,{elevation:15,style:{position:"fixed",zIndex:100,margin:50},children:Object(B.jsxs)(T.a,{children:[Object(B.jsx)(A.a,{color:"textPrimary",variant:"h1",children:"Projects Map"}),Object(B.jsx)(C.a,{mt:"3em"}),Object(B.jsx)(A.a,{color:"textPrimary",children:"List of current CityScope projects around the world."})]})}),Object(B.jsx)(D.a,{elevation:15,style:{height:"85vh",width:"100%",position:"relative"},children:Object(B.jsx)(T.a,{children:Object(B.jsx)(qa,{})})})]})})})}var Ka=[{path:"/",element:Object(B.jsx)(te,{}),children:[{path:"/home",element:Object(B.jsx)(fa,{})},{path:"/",element:Object(B.jsx)(ha,{})},{path:"/editor",element:Object(B.jsx)(Ct,{})},{path:"/projection",element:Object(B.jsx)(Ua,{})},{path:"/cityioviewer",element:Object(B.jsx)(Xa,{})},{path:"*",element:Object(B.jsx)(s.a,{to:"/404"})},{path:"404",element:Object(B.jsx)(oe,{})}]}],Qa=function(){var e=Object(s.i)(Ka);return Object(B.jsxs)(l.a,{theme:f,children:[Object(B.jsx)(p,{}),e]})},Za=function(e){var t=e.children,n=e.store;return Object(B.jsx)(je.a,{store:n,children:t})};o.a.render(Object(B.jsx)(Za,{store:qt,children:Object(B.jsx)(c.a,{basename:"https://cityscope.media.mit.edu/CS_cityscopeJS",children:Object(B.jsx)(Qa,{})})}),document.getElementById("root"))}},[[759,1,2]]]);
//# sourceMappingURL=main.4dee9546.chunk.js.map