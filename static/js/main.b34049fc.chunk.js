(this.webpackJsonpcityscopejs=this.webpackJsonpcityscopejs||[]).push([[0],{257:function(t,e){},344:function(t,e){},379:function(t,e){},411:function(t,e){},571:function(t,e,n){"use strict";n.r(e);var r=n(69),a=n.n(r),o=n(8),i=n(0),c=n(662),s=n(683),u=n(31),l=n(158),d=Object(l.b)({name:"cityIOdataState",initialState:{},cityIOisDone:!1,cityIOtableName:"",reducers:{updateCityIOdata:function(t,e){t.cityIOdata=e.payload},toggleCityIOisDone:function(t,e){t.cityIOisDone=e.payload},updateCityIOtableName:function(t,e){t.cityIOtableName=e.payload}}}),h=d.actions,f=h.updateCityIOdata,p=h.toggleCityIOisDone,b=h.updateCityIOtableName,j=d.reducer,g=n(239),O=n.n(g),v={fontFamily:'"Roboto Mono", sans-serif',fontSize:11,fontWeightLight:100,fontWeightRegular:500,fontWeightMedium:700,h1:{fontWeight:700,fontSize:45,letterSpacing:"-1px"},h2:{fontWeight:800,fontSize:29,letterSpacing:"-0.24px"},h3:{fontWeight:700,fontSize:24,letterSpacing:"-0.06px"},h4:{fontWeight:500,fontSize:20,letterSpacing:"-0.06px"},h5:{fontWeight:500,fontSize:16,letterSpacing:"-0.05px"},h6:{fontWeight:500,fontSize:14,letterSpacing:"-0.05px"},overline:{fontWeight:500}},m=n(118),y=Object(m.b)({typography:v,palette:{mode:"dark",primary:{main:"#FFF",light:"#ff5278"},secondary:{main:"#ff5278"},text:{primary:"#fff",secondary:"#ff5278"}},shape:{borderRadius:10},overrides:{MuiOutlinedInput:{notchedOutline:{borderColor:"#ff5278"}}}}),x=n(2),w=n(5),S=n(32),E=function(){var t=window.location,e="csjs_local"in O.a.parse(t.search)?"http://localhost:3000/CS_cityscopeJS/":"https://cityscope.media.mit.edu/CS_cityscopeJS/";return console.log("cityScopeJS location: ",e),e}(),C={docsURL:"https://raw.githubusercontent.com/CityScope/CS_cityscopeJS/master/docs/",cityIO:{baseURL:function(){var t=window.location,e="cityio_local"in O.a.parse(t.search)?"http://127.0.0.1:5000/api/":"https://cityio.media.mit.edu/api/";return console.log("cityIO server location: ",e),e}(),ListOfTables:"tables/list/",interval:500,cityIOmodules:[{name:"header",expectUpdate:!1},{name:"GEOGRID",expectUpdate:!1},{name:"ABM2",expectUpdate:!0},{name:"geojson",expectUpdate:!0},{name:"grid",expectUpdate:!1},{name:"access",expectUpdate:!0},{name:"GEOGRIDDATA",expectUpdate:!1},{name:"indicators",expectUpdate:!0},{name:"textual",expectUpdate:!0},{name:"scenarios",expectUpdate:!0},{name:"tui",expectUpdate:!0}]}},I={map:{mapStyle:{sat:"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true",blue:"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true",inverse:"mapbox://styles/relnox/cjlu6w5sc1dy12rmn4kl2zljn?fresh=true",normal:"mapbox://styles/relnox/cl8dv36nv000t14qik9yg4ys6?fresh=true"},layers:{ABM:{endTime:86400,startTime:43200,animationSpeed:10}},initialViewState:{maxZoom:22,zoom:15,pitch:0,bearing:0}}},L={GRID_LAYER_CHECKBOX:{displayName:"CS Grid",cityIOmoduleName:"GEOGRID",initState:!0,initSliderValue:50},ABM_LAYER_CHECKBOX:{displayName:"Animated Trips",cityIOmoduleName:"ABM2",initState:!1,initSliderValue:100},AGGREGATED_TRIPS_LAYER_CHECKBOX:{displayName:"Aggregated Trips",cityIOmoduleName:"ABM2",initState:!1,initSliderValue:100},ACCESS_LAYER_CHECKBOX:{displayName:"Heatmap",cityIOmoduleName:"access",initState:!1,initSliderValue:100},TEXTUAL_LAYER_CHECKBOX:{displayName:"Text",cityIOmoduleName:"text",initState:!1,initSliderValue:100},GEOJSON_LAYER_CHECKBOX:{displayName:"GeoJson",cityIOmoduleName:"geojson",initState:!1,initSliderValue:50},MESH_LAYER_CHECKBOX:{displayName:"Mesh <beta>",cityIOmoduleName:"GEOGRID",initState:!1,initSliderValue:100}},_={ROTATE_CHECKBOX:{displayName:"Rotate Camera",initState:!1,initSliderValue:100},ANIMATION_CHECKBOX:{displayName:"Toggle Animation",initState:!1,initSliderValue:100}},T={RESET_VIEW_BUTTON:{displayName:"Reset View",initState:!1},ORTHO_VIEW_BUTTON:{displayName:"Ortho View",initState:!1},NORTH_VIEW_BUTTON:{displayName:"North View",initState:!1}},M={map:{mapStyle:{sat:"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true",dark:"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true",blue:"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"}},GEOGRIDDATA:{color:[0,0,0],height:[0,50,100],id:0,interactive:"Web",name:"name"},GEOGRID:{features:[],properties:{header:{tableName:"test",cellSize:50,latitude:42.3664655,longitude:-71.0854323,tz:-5,ncols:20,nrows:20,rotation:0,projection:"+proj=lcc +lat_1=42.68333333333333 +lat_2=41.71666666666667 +lat_0=41 +lon_0=-71.5 +x_0=200000 +y_0=750000 +ellps=GRS80 +datum=NAD83 +units=m +no_def"},types:{Office:{LBCS:[{proportion:1,use:{2310:1}}],NAICS:[{proportion:1,use:{5400:1}}],interactive:"Web",color:"#FF5277",height:[0,50,100]},Park:{LBCS:[{proportion:1,use:{7240:1}}],NAICS:null,interactive:"Web",color:"#38C9FF"},Residential:{LBCS:[{proportion:1,use:{1100:1}}],NAICS:null,interactive:"Web",color:"#FFFF33",height:[0,50,100]}}},type:"FeatureCollection"}},A=n(130),G=n.n(A);function k(){k=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new w(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(S([])));j&&j!==e&&n.call(j,a)&&(p=j);var g=f.prototype=d.prototype=Object.create(p);function O(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(g,"constructor",f),c(f,"constructor",h),h.displayName=c(f,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,i,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},O(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(g),c(g,i,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var D=function(){var t=Object(S.a)(k().mark((function t(e){var n;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,G.a.get(e);case 3:return n=t.sent,t.abrupt("return",n.data);case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}();function N(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}var R=function(t){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/i.test(t)},P=function(t,e,n){var r=C.cityIO.baseURL+"table/"+e+n,a={method:"post",url:r,data:t,headers:{"Content-Type":"application/json",Accept:"application/json"}};G()(a).then((function(t){"ok"===t.data.status&&console.log("--\x3e cityIO endpoint ".concat(r," was updated <--"))})).catch((function(t){console.log("ERROR:",t)}))},B=C.cityIO.baseURL,F=function(){var t=Object(S.a)(k().mark((function t(e,n){var r,a;return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,n);case 2:return r=t.sent,t.next=5,r.json();case 5:return a=t.sent,t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),z=function(){var t=Object(S.a)(k().mark((function t(e){return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F("".concat(B,"table/").concat(e,"/meta/hashes/GEOGRIDDATA/"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),V=function(){var t=Object(S.a)(k().mark((function t(e){return k().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F("".concat(B,"module/").concat(e,"/"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),H=n(397),U=n(218),W=n(371),Y=n(1),X=function(t){var e=t.loadingModules,n=t.verticalPosition,r=t.barHeight;return Object(Y.jsx)(Y.Fragment,{children:e.map((function(t,e){return Object(Y.jsxs)(H.a,{sx:{position:"fixed",bottom:"bottom"===n?10*(e+1):"auto",width:"100%",zIndex:1e4},children:[Object(Y.jsx)(W.a,{sx:{height:r||10},color:"secondary"}),Object(Y.jsxs)(U.a,{variant:"caption",color:"primary",style:{marginRight:"1vw"},children:["Loading ",t]})]},"box_"+t)}))})};function J(){J=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new w(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(S([])));j&&j!==e&&n.call(j,a)&&(p=j);var g=f.prototype=d.prototype=Object.create(p);function O(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(g,"constructor",f),c(f,"constructor",h),h.displayName=c(f,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,i,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},O(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(g),c(g,i,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var K=function(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),t},q=function(t){var e=C,n=Object(u.b)(),r=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),a=t.tableName,c=Object(i.useState)(null),s=Object(o.a)(c,2),l=s[0],d=s[1],h=Object(i.useState)({}),b=Object(o.a)(h,2),j=b[0],g=b[1],O=Object(i.useState)([]),v=Object(o.a)(O,2),m=v[0],y=v[1],E="".concat(e.cityIO.baseURL,"table/").concat(a,"/");function I(){return L.apply(this,arguments)}function L(){return(L=Object(S.a)(J().mark((function t(){var n;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D(E+"meta/id/");case 2:n=t.sent,l!==n&&d(n),setTimeout(I,e.cityIO.interval);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return _=Object(S.a)(J().mark((function t(){var o,i,c,s,u,l,d;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("--- starting update ---"),t.next=3,D(E+"meta/hashes/");case 3:return o=t.sent,i=[],c=[],(s=e.cityIO.cityIOmodules.map((function(t){return t.name}))).forEach((function(t){j[t]!==o[t]?(i.push(D("".concat(E).concat(t,"/"))),c.push(t)):i.push(null),y(c)})),t.next=10,Promise.all(i);case 10:u=t.sent,g(o),l=s.reduce((function(t,e,n){return u[n]?(y(K(m,e)),Object(w.a)(Object(w.a)({},t),{},Object(x.a)({},e,u[n]))):t}),r),d=Object(w.a)(Object(w.a)({},l),{},{tableName:a}),n(f(d)),console.log("--- done updating from cityIO ---"),n(p(!0));case 17:case"end":return t.stop()}}),t)}))),_.apply(this,arguments)}return Object(i.useEffect)((function(){var t=setTimeout(I,e.cityIO.interval);return console.log("reading cityIO every "+e.cityIO.interval+"ms"),function(){return clearTimeout(t)}}),[]),Object(i.useEffect)((function(){l&&function(){_.apply(this,arguments)}()}),[l]),Object(Y.jsx)(X,{loadingModules:m})},Q=n(674),Z=n(684),$=n(685),tt=n(686),et=n(372),nt=n(671),rt=Object(l.b)({name:"menuState",initialState:{editMenuState:{},typesMenuState:{},layersMenuState:{},viewSettingsMenuState:{},animationMenuState:{toggleAnimationState:!1,animationSpeedSliderValue:10}},reducers:{updateLayersMenuState:function(t,e){t.layersMenuState=e.payload},updateTypesMenuState:function(t,e){t.typesMenuState=e.payload},updateEditMenuState:function(t,e){t.editMenuState=e.payload},updateViewSettingsMenuState:function(t,e){t.viewSettingsMenuState=e.payload},updateAnimationMenuState:function(t,e){t.animationMenuState=e.payload}}}),at=rt.actions,ot=at.updateLayersMenuState,it=at.updateTypesMenuState,ct=at.updateEditMenuState,st=at.updateViewSettingsMenuState,ut=(at.updateAnimationMenuState,rt.reducer);function lt(){var t=Object(u.b)(),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})).GEOGRID.properties.types,n=Object(i.useState)(),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(i.useState)(),l=Object(o.a)(s,2),d=l[0],h=l[1];Object(i.useEffect)((function(){t(it({SELECTED_TYPE:a}))}),[a]);var f=a&&a.LBCS,p=a&&a.NAICS,b=a&&a.description?a.description:null;return Object(Y.jsx)(Y.Fragment,{children:function(t){var e=[];return Object.keys(t).forEach((function(n,r){var o=t[n].color;"string"!==typeof o&&(o="rgb("+t[n].color[0]+","+t[n].color[1]+","+t[n].color[2]+")"),e.push(Object(Y.jsxs)("div",{children:[Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(et.a,{fullWidth:!0,size:"small",variant:"outlined",sx:{"&.MuiButton-text":{color:{col:o}},border:"solid 1px "+o},onClick:function(){return e=t[n],r=n,e=Object(w.a)(Object(w.a)({},e),{},{thisTypeName:r}),void c(e);var e,r},children:Object(Y.jsx)(U.a,{color:o,variant:"caption",children:n})},Math.random())},"li_menu_".concat(r)),a&&a.thisTypeName===n&&Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(Z.a,{variant:"outlined",sx:{width:"100%"},children:Object(Y.jsxs)($.a,{children:[b&&Object(Y.jsx)(U.a,{variant:"caption",children:b}),a&&a.thisTypeName&&a.height&&Object(Y.jsxs)("div",{children:[Object(Y.jsx)(U.a,{children:"Set Height"}),Object(Y.jsx)(nt.a,{valueLabelDisplay:"auto",size:"small",onChange:function(t,e){return h((function(t){var n=Object(w.a)({},t),r=[a.height[0],e,a.height[2]];return Object.assign(n,{height:r}),n}))},onChangeCommitted:function(t,e){c(Object(w.a)(Object(w.a)({},a),{},{height:[a.height[0],e,a.height[2]]}))},min:a.height[0],value:d&&d[a]&&d[a].height[1],max:a.height[2]},"li_types_slider_".concat(a.thisTypeName))]},"li_types_div_".concat(r)),f&&Object(Y.jsxs)("div",{children:[Object(Y.jsx)(U.a,{children:"LBCS"}),Object(Y.jsx)(U.a,{variant:"caption",children:JSON.stringify(f,null,"\t")})]}),p&&Object(Y.jsxs)("div",{children:[Object(Y.jsx)(U.a,{children:"NAICS"}),Object(Y.jsx)(U.a,{variant:"caption",children:JSON.stringify(p,null,"\t")})]})]})},"li_types_card_".concat(r))},"li_types_".concat(r))]},"li_types_top_div_".concat(r)))})),Object(Y.jsx)(tt.a,{sx:{display:"flex",flexDirection:"column",maxHeight:400,overflow:"hidden",overflowY:"scroll"},children:e})}(e)})}var dt=n(678),ht=n(373),ft=n(394);var pt=function(){var t=Object(u.b)(),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),n=Object.keys(e),r={},a=Object(i.useState)((function(){for(var t in L)r[t]={isOn:L[t].initState,slider:L[t].initSliderValue};return r})),c=Object(o.a)(a,2),s=c[0],l=c[1];Object(i.useEffect)((function(){t(ot(s))}),[s]);var d=Object(i.useState)({}),h=Object(o.a)(d,2),f=h[0],p=h[1],b=[];return Object(Y.jsx)(dt.a,{container:!0,children:function(){var t=function(t){var e=L[t].cityIOmoduleName;n.includes(e)&&b.push(Object(Y.jsxs)(dt.a,{container:!0,children:[Object(Y.jsx)(dt.a,{item:!0,xs:4,children:Object(Y.jsx)(ht.a,{control:Object(Y.jsx)(ft.a,{checked:s[t]&&s[t].isOn,color:"primary",onChange:function(e){l(Object(w.a)(Object(w.a)({},s),{},Object(x.a)({},t,Object(w.a)(Object(w.a)({},s[t]),{},{isOn:e.target.checked}))))}},"checkbox_"+t),label:Object(Y.jsx)(U.a,{variant:"caption",children:L[t].displayName},"label_"+t)},"formControl_"+t)},"grid_i_1_"+t),s[t]&&s[t].isOn&&Object(Y.jsx)(dt.a,{item:!0,xs:8,children:Object(Y.jsx)(nt.a,{size:"small",valueLabelDisplay:"auto",onChangeCommitted:function(e,n){return function(t,e){p(Object(w.a)(Object(w.a)({},f),{},Object(x.a)({},t,e))),l(Object(w.a)(Object(w.a)({},s),{},Object(x.a)({},t,Object(w.a)(Object(w.a)({},s[t]),{},{slider:e}))))}(t,n)}},"slider_"+t)},"grid_i_2_"+t)]},"grid_con_"+t))};for(var e in L)t(e);return b}()})},bt=n(687);var jt=function(){var t=Object(u.b)(),e=Object(i.useState)((function(){var t={};for(var e in _)t[e]={isOn:_[e].initState,slider:_[e].initSliderValue&&_[e].initSliderValue};return t})),n=Object(o.a)(e,2),r=n[0],a=n[1];Object(i.useLayoutEffect)((function(){t(st(r))}),[r]);var c=Object(i.useState)({}),s=Object(o.a)(c,2),l=s[0],d=s[1];return Object(Y.jsxs)(tt.a,{children:[function(t){var e=[],n=function(n){e.push(Object(Y.jsx)(et.a,{size:"small",onClick:function(){return function(t){a(Object(w.a)(Object(w.a)({},r),{},{VIEW_CONTROL_BUTTONS:t}))}(n)},children:t[n].displayName},Math.random()))};for(var o in t)n(o);return Object(Y.jsx)(bt.a,{color:"primary",children:e})}(T),function(t){var e=[],n=function(n){var o=t[n].initSliderValue;e.push(Object(Y.jsxs)("div",{children:[Object(Y.jsxs)(Q.a,{children:[Object(Y.jsx)(ft.a,{checked:r[n]&&r[n].isOn,name:n,onChange:function(t){return a(Object(w.a)(Object(w.a)({},r),{},Object(x.a)({},n,Object(w.a)(Object(w.a)({},r[n]),{},{isOn:t.target.checked}))))}},"viewSettingCheckBox_"+n),Object(Y.jsx)(U.a,{variant:"caption",children:t[n].displayName},"viewSettingCaption_"+n)]},"viewSettingListItem_"+n),o&&r[n]&&r[n].isOn&&Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(nt.a,{size:"small",valueLabelDisplay:"auto",onChangeCommitted:function(t,e){return function(t,e){d(Object(w.a)(Object(w.a)({},l),{},Object(x.a)({},t,e))),a(Object(w.a)(Object(w.a)({},r),{},Object(x.a)({},t,Object(w.a)(Object(w.a)({},r[t]),{},{slider:e}))))}(n,e)}},"viewSettingSlider_"+n)},"viewSettingListItemSlider_"+n)]},"viewSettingDiv_"+n))};for(var o in t)n(o);return e}(_)]})},gt=n(18),Ot=n(374),vt=n(375),mt=n(672),yt=n(648),xt=n(651),wt=n(688),St=n(689),Et=n(376),Ct=n(690),It=n(274),Lt=n.n(It);function _t(){_t=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new w(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(S([])));j&&j!==e&&n.call(j,a)&&(p=j);var g=f.prototype=d.prototype=Object.create(p);function O(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(g,"constructor",f),c(f,"constructor",h),h.displayName=c(f,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,i,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},O(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(g),c(g,i,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function Tt(){var t=Object(i.useState)([]),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(i.useState)(),c=Object(o.a)(a,2),s=c[0],l=c[1],d=Object(i.useState)(!1),h=Object(o.a)(d,2),f=h[0],p=h[1],b=Object(i.useState)(!1),j=Object(o.a)(b,2),g=j[0],O=j[1],v=Object(i.useState)({name:"",description:""}),m=Object(o.a)(v,2),y=m[0],x=m[1],E=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),C=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName})),I=function(){O(!1),p(!1)},L=function(){var t=Object(S.a)(_t().mark((function t(){return _t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,V(s.hash).then((function(t){P(t,C,"/GEOGRIDDATA/")})).finally((function(){I()}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),_=function(){return E.scenarios.map((function(t,e){return Object(Y.jsxs)(Q.a,{children:[Object(Y.jsx)(Ot.a,{arrow:!0,placement:"right",title:t.description||"No description",children:Object(Y.jsx)(et.a,{fullWidth:!0,size:"small",variant:"outlined",onClick:function(){return function(t){l(t),O(!0)}(t)},children:Object(Y.jsxs)(tt.a,{children:[Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(U.a,{children:t.name.substring(0,12)+"..."})}),Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(U.a,{variant:"caption",children:t.description.substring(0,20)+"..."})})]})},"scenario_button_"+e)},"scenario_tt_"+e),Object(Y.jsx)(vt.a,{onClick:function(e){!function(t){var e=Object(gt.a)(E.scenarios),n=e.filter((function(e){return e.hash===t.hash})),r=e.indexOf(n[0]);-1!==r&&e.splice(r,1),P(e,C,"/scenarios/")}(t)},"aria-label":"delete",size:"small",children:Object(Y.jsx)(Lt.a,{color:"primary",fontSize:"inherit"},"scenario_delicon_"+e)},"scenario_ib_"+e)]},"scenario_grid_item_".concat(e))}))};return Object(i.useEffect)((function(){if(E.scenarios){var t=_();r(t)}}),[E]),Object(Y.jsxs)(dt.a,{sx:{flexGrow:1},container:!0,children:[Object(Y.jsx)(mt.a,{sx:{width:"100%"},badgeContent:E.scenarios&&E.scenarios.length||0,color:"primary",children:Object(Y.jsx)(et.a,{fullWidth:!0,variant:"outlined",onClick:function(){return p(!0)},children:Object(Y.jsx)(U.a,{children:"Save This Scenario"})},"save_state_button")}),Object(Y.jsx)(tt.a,{children:n}),Object(Y.jsxs)(yt.a,{open:f,onClose:I,children:[Object(Y.jsx)(xt.a,{id:"save-dialog-title",children:"Save this Scenario"}),Object(Y.jsxs)(wt.a,{children:[Object(Y.jsx)(St.a,{id:"alert-dialog-description",children:"Give your scenario a name and a description to help you remember what it is about."}),Object(Y.jsxs)(tt.a,{children:[Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(Et.a,{id:"name-basic",label:"Scenario Name",variant:"outlined",fullWidth:!0,onChange:function(t){return x(Object(w.a)(Object(w.a)({},y),{},{name:t.target.value}))}})}),Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(Et.a,{id:"desc-basic",label:"Description (optional)",fullWidth:!0,variant:"outlined",onChange:function(t){return x(Object(w.a)(Object(w.a)({},y),{},{description:t.target.value}))}})})]})]}),Object(Y.jsxs)(Ct.a,{children:[Object(Y.jsx)(et.a,{onClick:I,children:"Cancel"}),Object(Y.jsx)(et.a,{onClick:function(){I(),z(C).then((function(t){var e={name:y.name||"".concat(t),hash:t,description:y.description||"no description for ".concat(t," yet.")},n=E.scenarios?Object(gt.a)(E.scenarios):[];n.push(e),P(n,C,"/scenarios/")}))},autoFocus:!0,children:"Save"})]})]}),Object(Y.jsxs)(yt.a,{open:g,onClose:I,children:[Object(Y.jsx)(xt.a,{id:"alert-dialog-title",children:"Revert to saved scenario?"}),Object(Y.jsx)(wt.a,{children:Object(Y.jsx)(St.a,{id:"alert-dialog-description",children:"You can revert to this saved scenario by clicking the button below. Reverting will delete all changes made since the last commit."})}),Object(Y.jsxs)(Ct.a,{children:[Object(Y.jsx)(et.a,{onClick:I,children:"Cancel"}),Object(Y.jsx)(et.a,{onClick:L,autoFocus:!0,children:"Revert"})]})]})]})}var Mt=n(679),At=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)-1;function Gt(t){var e=t.children,n=t.direction,r=t.width,a=Math.floor(At/4),c=Object(i.useState)(r||a),s=Object(o.a)(c,2),u=s[0],l=s[1],d=function t(){document.removeEventListener("mouseup",t,!0),document.removeEventListener("mousemove",h,!0)},h=Object(i.useCallback)((function(t){var e=null;(e="right"===n?document.body.offsetLeft+document.body.offsetWidth-t.clientX+20:document.body.offsetLeft+t.clientX+20)>50&&e<At&&l(e)}),[]);return Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(H.a,{onMouseDown:function(t){return document.addEventListener("mouseup",d,!0),void document.addEventListener("mousemove",h,!0)},sx:{width:"".concat(5,"px"),padding:"5px 0 0",position:"fixed",height:"1000vh",left:"left"===n?u+"px":void 0,right:"right"===n?u+"px":void 0,zIndex:1,cursor:"ew-resize",backgroundColor:"gray"}}),Object(Y.jsx)(Mt.a,{anchor:n,open:!0,variant:"persistent",ModalProps:{keepMounted:!0},PaperProps:{style:{width:u}},sx:{display:"flex",flexDirection:"column"},children:e})]})}var kt=n(334),Dt=n.n(kt),Nt=n(278),Rt=n.n(Nt);function Pt(){var t=Object(u.b)(),e=Object(i.useState)({EDIT_BUTTON:!1}),n=Object(o.a)(e,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){t(ct(r))}),[r]),Object(Y.jsx)(et.a,{fullWidth:!0,id:"EDIT_BUTTON",variant:"outlined",endIcon:r.EDIT_BUTTON?Object(Y.jsx)(Rt.a,{}):Object(Y.jsx)(Dt.a,{}),onClick:function(t){return e=t,void a(Object(w.a)(Object(w.a)({},r),{},Object(x.a)({},e.currentTarget.id,!r[e.currentTarget.id])));var e},children:Object(Y.jsx)(U.a,{children:r.EDIT_BUTTON?"submit edits":"start editing"})})}var Bt=function(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(U.a,{gutterBottom:!0,children:"CityScope"}),Object(Y.jsx)(U.a,{variant:"h3",children:t})]})};var Ft=function(){var t=[Object(Y.jsx)(Bt,{}),Object(Y.jsx)(Pt,{}),Object(Y.jsx)(lt,{}),Object(Y.jsx)(Tt,{}),Object(Y.jsx)(pt,{}),Object(Y.jsx)(jt,{})],e=function(){var e=[];return t.forEach((function(t,n){e.push(Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(Z.a,{variant:"outlined",sx:{width:"100%"},children:Object(Y.jsx)($.a,{children:t})})},n))})),e};return Object(Y.jsx)(Gt,{direction:"left",width:300,children:Object(Y.jsx)(tt.a,{children:Object(Y.jsx)(e,{})})})},zt=n(11),Vt=n(409),Ht=n.n(Vt),Ut=function(t){if(!t.mousePos||!t.hoveredCells)return null;var e=t.selectedType,n=t.hoveredCells.object.properties.interactive,r=t.mousePos,a=t.divSize,o=e.color;R(o)&&(o=N(o));var i="rgb("+o[0]+","+o[1]+","+o[2]+")",c="rgba("+o[0]+","+o[1]+","+o[2]+",0.6)",s=r.clientX-a/2,u=r.clientY-a/2,l=n?e.name:": Not-interactive";return Object(Y.jsx)("div",{style:{border:"2px solid",backgroundColor:t.mouseDown?c:"rgba(0,0,0,0)",borderColor:i,color:i,borderRadius:"15%",position:"fixed",zIndex:10,pointerEvents:"none",width:a,height:a,left:s,top:u,fontFamily:"Roboto Mono"},children:Object(Y.jsxs)("div",{style:{position:"relative",left:a+10,fontSize:"0.8em"},children:[!n&&Object(Y.jsx)(Ht.a,{}),l]})})},Wt=function(t){if(!t.mousePos)return null;var e=t.mousePos,n=t.hoveredObj;return Object(Y.jsxs)("div",{style:{borderRadius:"10%",position:"fixed",pointerEvents:"none",backgroundColor:"rgba(0,0,0,0.5)",padding:"1vw",color:"rgba(255,255,255,0.9)",zIndex:10,left:e.clientX,top:e.clientY},children:[Object(Y.jsxs)(U.a,{children:["Type: ",n.object.properties.name]}),Object(Y.jsxs)(U.a,{children:["Height: ",n.object.properties.height]}),Object(Y.jsxs)(U.a,{children:["ID: ",n.object.properties.id]})]})};function Yt(t){var e=t.editOn,n=t.mousePos,r=t.selectedType,a=t.pickingRadius,o=t.mouseDown,i=t.hoveredObj,c=function(){return e&&r&&Object.keys(r).length&&i?Object(Y.jsx)(Ut,{mousePos:n,selectedType:r,divSize:a,mouseDown:o,hoveredCells:i}):i?Object(Y.jsx)(Wt,{mousePos:n,hoveredObj:i}):null};return Object(Y.jsx)(c,{})}var Xt=n(128),Jt=n(663),Kt=(n(228),n(667));function qt(t){var e=t.data,n=t.opacity,r=e.access&&e.access.features;return new Kt.a({id:"ACCESS",colorRange:[[233,62,58],[237,104,60],[243,144,63],[253,199,12],[255,243,59]],threshold:.5,data:r&&r,getPosition:function(t){return t.geometry.coordinates},getWeight:function(t){return t.properties[Math.floor(100*n)%e.access.properties.length]},updateTriggers:{getWeight:n}})}var Qt=n(346);function Zt(t){var e=t.data,n=t.ABMmode,r=t.opacity;if(e.ABM2)return new Qt.a({id:"AGGREGATED_TRIPS",shadowEnabled:!1,data:e.ABM2.trips,getPath:function(t){return t.path},getColor:function(t){return N(e.ABM2.attr.mode[t.mode].color)},opacity:r,getWidth:5,updateTriggers:{getColor:n},transitions:{getColor:500}})}var $t=n(656);function te(t){var e,n=t.data,r=t.ABMmode,a=t.zoomLevel,o=t.time,i=t.opacity;if(n.ABM2)return new $t.a({opacity:i,id:"ABM",data:n.ABM2.trips,getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},getColor:function(t){return N(n.ABM2.attr.mode[t.mode].color)},shadowEnabled:!1,getWidth:1,widthScale:(e=a,e>15&&e<25?3:e<15&&e>10?12:30),trailLength:500,currentTime:o,updateTriggers:{getColor:r},transitions:{getColor:500}})}var ee=n(665),ne=function(t,e,n,r,a){var o=e.height,i=e.color,c=e.name,s=function(t,e,n){var r=e,a=t.x-r/2,o=t.y-r/2;return n.current.pickObjects({x:a,y:o,width:r,height:r})}(t,r,a);s.forEach((function(t){var e=t.object.properties;e&&e.interactive&&(e.color=R(i)?N(i):i,e.height=o,e.name=c)})),n(s)},re=function(t){var e=t.GEOGRID,n=JSON.parse(JSON.stringify(e));if(t.GEOGRIDDATA&&t.GEOGRIDDATA.length===t.GEOGRID.features.length)for(var r=t.GEOGRIDDATA,a=0;a<e.features.length;a++)n.features[a].properties=r[a],n.features[a].properties=Object(w.a)(Object(w.a)({},n.features[a].properties),{},{id:a});return n};function ae(t){var e=t.data,n=t.editOn,r=t.state,a=r.selectedType,o=r.keyDownState,i=r.selectedCellsState,c=r.pickingRadius,s=r.opacity,u=t.updaters,l=u.setSelectedCellsState,d=u.setDraggingWhileEditing,h=u.setHoveredObj,f=t.deckGLref;return new ee.a({opacity:s,id:"GRID",data:e,pickable:!0,extruded:!0,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:2,getElevation:function(t){return t.properties.height[1]},getFillColor:function(t){return t.properties.color},onClick:function(t){a&&n&&"Shift"!==o&&ne(t,a,l,c,f)},onDrag:function(t){a&&n&&"Shift"!==o&&ne(t,a,l,c,f)},onDragStart:function(){a&&n&&"Shift"!==o&&d(!0)},onHover:function(t){t.object&&h(t)},onDragEnd:function(){d(!1)},updateTriggers:{getFillColor:i,getElevation:i},transitions:{getFillColor:300,getElevation:300}})}var oe=n(426);function ie(t){var e=t.data,n=t.coordinates,r=t.opacity;if(e&&e.text){var a=[];return e.text.forEach((function(t){a.push({coordinates:[n.features[t.id].geometry.coordinates[0][0][0],n.features[t.id].geometry.coordinates[0][0][1],100],info:t.info})})),new oe.a({opacity:r,id:"text-layer",data:a,pickable:!0,getPosition:function(t){return t.coordinates},getText:function(t){return t.info},getColor:[255,255,255],getSize:30,getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"center"})}}function ce(t){var e=t.data,n=t.opacity;if(e.geojson)return new ee.a({id:"GeojsonLayer",data:e.geojson,opacity:n,pickable:!0,wireframe:!1,stroked:!0,filled:!0,extruded:!0,lineWidthScale:1,getFillColor:function(t){return N(t.properties.fill)},getLineColor:function(t){return N(t.properties.stroke)},lineWidthMinPixels:2,getElevation:function(t){return t.properties.height},updateTriggers:{getFillColor:e,getElevation:e},transitions:{getFillColor:500,getElevation:500}})}var se=n(675),ue=n(294);function le(t){var e=t.data,n=t.opacity;if(e&&e.features)return new se.a({id:"mesh-layer",data:e.features,loaders:[ue.a],mesh:"./obj/model.obj",getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2]},getColor:function(t){return[255,255,255,255]},getOrientation:function(t){return[-180,90*Math.ceil(4*Math.random()),-90]},getScale:function(t){return t.properties.height>0?[e.properties.header.cellSize/2,n*t.properties.height,e.properties.header.cellSize/2]:[0,0,0]},updateTriggers:{getScale:n}})}function de(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(u.c)((function(t){return t.menuState})),n=Object(i.useState)(!1),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(i.useState)(),l=Object(o.a)(s,2),d=l[0],h=l[1],f=Object(i.useState)(I.map.initialViewState),p=Object(o.a)(f,2),b=p[0],j=p[1],g=Object(i.useState)(),O=Object(o.a)(g,2),v=O[0],m=O[1],y=Object(i.useState)(),x=Object(o.a)(y,2),S=x[0],E=x[1],C=Object(i.useState)(),L=Object(o.a)(C,2),_=L[0],T=L[1],M=Object(i.useState)(),A=Object(o.a)(M,2),G=A[0],k=A[1],D=Object(i.useState)(),N=Object(o.a)(D,2),R=N[0],B=N[1],F=Object(i.useRef)(),z=e.editMenuState.EDIT_BUTTON,V=e.typesMenuState.SELECTED_TYPE,H=e.layersMenuState,U=e.viewSettingsMenuState.VIEW_CONTROL_BUTTONS,W=e.viewSettingsMenuState.ANIMATION_CHECKBOX,X=e.viewSettingsMenuState.ROTATE_CHECKBOX,J=Object(i.useState)(0),K=Object(o.a)(J,2),q=K[0],Q=K[1],Z=Object(i.useState)({}),$=Object(o.a)(Z,1)[0],tt=function t(){W&&W.isOn&&(Q((function(t){return t>I.map.layers.ABM.endTime?I.map.layers.ABM.startTime:t+W.slider})),$.id=window.requestAnimationFrame(t))};!W||W.isOn||window.cancelAnimationFrame($.id),Object(i.useEffect)((function(){return $.id=window.requestAnimationFrame(tt),function(){window.cancelAnimationFrame($.id)}}),[W]),Object(i.useEffect)((function(){if(X&&X.isOn){var t=b.bearing||0;t<360?t+=q/1e8*X.slider:t=0,j(Object(w.a)(Object(w.a)({},b),{},{bearing:t}))}}),[X,q]);var et=function(e){var n=t.GEOGRID.features[t.GEOGRID.features.length-1].geometry.coordinates[0][0],r=t.GEOGRID.features[0].geometry.coordinates[0][0],a=[(r[0]+n[0])/2,(r[1]+n[1])/2],o=t.GEOGRID.properties.header;j(Object(w.a)(Object(w.a)({},b),{},{longitude:a[0],latitude:a[1],zoom:"RESET_VIEW_BUTTON"===e?15:b.zoom,pitch:"RESET_VIEW_BUTTON"===e?0:45,bearing:"NORTH_VIEW_BUTTON"===e?0:360-o.rotation,orthographic:"ORTHO_VIEW_BUTTON"===e}))};Object(i.useEffect)((function(){et(U)}),[U]),Object(i.useEffect)((function(){document.addEventListener("contextmenu",(function(t){return t.preventDefault()})),et()}),[]),Object(i.useEffect)((function(){B(re(t))}),[t.GEOGRIDDATA]),Object(i.useEffect)((function(){if(!z&&R){for(var e=[],n=0;n<R.features.length;n++)e[n]=R.features[n].properties;P(e,t.tableName,"/GEOGRIDDATA/")}}),[z]);var nt={ABM:te({data:t,ABMmode:0,zoomLevel:b.zoom,time:q,opacity:H&&H.ABM_LAYER_CHECKBOX&&.01*H.ABM_LAYER_CHECKBOX.slider}),AGGREGATED_TRIPS:Zt({data:t,ABMmode:0,opacity:H&&H.AGGREGATED_TRIPS_LAYER_CHECKBOX&&.01*H.AGGREGATED_TRIPS_LAYER_CHECKBOX.slider}),GRID:ae({data:R,editOn:z,state:{selectedType:V,keyDownState:v,selectedCellsState:d,pickingRadius:40,opacity:H&&H.GRID_LAYER_CHECKBOX&&.01*H.GRID_LAYER_CHECKBOX.slider},updaters:{setSelectedCellsState:h,setDraggingWhileEditing:c,setHoveredObj:k},deckGLref:F}),ACCESS:qt({data:t,opacity:H&&H.ACCESS_LAYER_CHECKBOX&&.01*H.ACCESS_LAYER_CHECKBOX.slider}),TEXTUAL:ie({data:t,coordinates:R&&R,opacity:H&&H.TEXTUAL_LAYER_CHECKBOX&&.01*H.TEXTUAL_LAYER_CHECKBOX.slider}),GEOJSON:ce({data:t,opacity:H&&H.GEOJSON_LAYER_CHECKBOX&&.01*H.GEOJSON_LAYER_CHECKBOX.slider}),MESH:le({data:R,opacity:H&&H.MESH_LAYER_CHECKBOX&&.01*H.MESH_LAYER_CHECKBOX.slider})},rt=["GRID","TEXTUAL","MESH","GEOJSON","ACCESS","AGGREGATED_TRIPS","ABM"];return Object(Y.jsx)(Y.Fragment,{children:Object(Y.jsxs)("div",{onKeyDown:function(t){m(t.nativeEvent.key)},onKeyUp:function(){return m(null)},onMouseMove:function(t){return E(t.nativeEvent)},onMouseUp:function(){return T(!1)},onMouseDown:function(){return T(!0)},children:[Object(Y.jsx)(Yt,{editOn:z,mousePos:S,selectedType:V,pickingRadius:40,mouseDown:_,hoveredObj:G}),Object(Y.jsx)(Jt.a,{ref:F,viewState:b,onViewStateChange:function(t){var e=t.viewState;e.orthographic="ORTHO_VIEW_BUTTON"===U,j(e)},layers:function(){var t,e=[],n=Object(zt.a)(rt);try{for(n.s();!(t=n.n()).done;){var r=t.value;H&&H[r+"_LAYER_CHECKBOX"]&&H[r+"_LAYER_CHECKBOX"].isOn&&e.push(nt[r])}}catch(a){n.e(a)}finally{n.f()}return e}(),controller:{touchZoom:!0,touchRotate:!0,dragPan:!a,dragRotate:!a,keyboard:!1},children:Object(Y.jsx)(Xt.c,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:I.map.mapStyle.sat,preventStyleDiffing:!0})})]})})}var he=n(50),fe=n(213),pe={scales:{r:{angleLines:{color:"#696969"},suggestedMin:0,suggestedMax:1,grid:{color:"#696969",circular:!0},pointLabels:{color:"#C0C0C0"},ticks:{color:"#696969"}}}},be={scales:{r:{angleLines:{color:"#363636"},grid:{color:"#363636",circular:!0},pointLabels:{color:"#363636"},ticks:{color:"#363636"}}}},je={labels:[null,null,null],datasets:[{label:"No indicator data...",data:[null,null,null],backgroundColor:"#363636",borderColor:"#363636",borderWidth:1}]};function ge(){he.f.register(he.q,he.n,he.k,he.h,he.t,he.i);var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(i.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1];return Object(i.useEffect)((function(){if(t.indicators){var e=function(t){for(var e={labels:[],datasets:[{label:"Project Values",data:[],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1},{label:"Reference Values",data:[],backgroundColor:"rgba(0, 33, 132, 0.2)",borderColor:"rgba(0, 99, 255, 1)",borderWidth:1}]},n=0;n<t.length;n++)"radar"===t[n].viz_type&&(e.labels.push(t[n].name),e.datasets[0].data.push(t[n].value),e.datasets[1].data.push(t[n].ref_value));return e}(t.indicators);a(e)}else a(je)}),[t]),Object(Y.jsx)(Y.Fragment,{children:r&&Object(Y.jsx)(fe.c,{data:r,options:t.indicators?pe:be})})}he.f.register(he.e,he.l,he.c,he.s,he.t,he.i);var Oe={maintainAspectRatio:!0,aspectRatio:1,scales:{r:{angleLines:{color:"#696969"},grid:{color:"#696969",circular:!0},pointLabels:{color:"#C0C0C0"},ticks:{color:"#696969"}}},responsive:!0},ve={labels:["no data..."],datasets:[{label:"No indicator data...",data:[0],backgroundColor:"#696969"}]};function me(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(i.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1];Object(i.useEffect)((function(){if(t.indicators){var e=c(t.indicators);a(e)}else a(ve)}),[t]);var c=function(t){for(var e={labels:[],datasets:[{label:"Chart Data",data:[],backgroundColor:"rgba(255, 99, 132, 0.3)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]},n=0;n<t.length;n++)"bar"===t[n].viz_type&&(e.labels.push(t[n].name),e.datasets[0].data.push(t[n].value));return e};return Object(Y.jsx)(Y.Fragment,{children:r&&Object(Y.jsx)(fe.a,{options:Oe,data:r||ve})})}function ye(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(i.useState)({labels:[],datasets:[]}),n=Object(o.a)(e,2),r=n[0],a=n[1];he.f.register(he.a,he.t,he.i);var c=t.GEOGRIDDATA;return Object(i.useEffect)((function(){t.GEOGRID.properties&&function(){var t={labels:[],datasets:[{label:"Area Calculation",data:[],backgroundColor:[],borderColor:[],borderWidth:1}]};c.forEach((function(e){var n=e.name;if(n&&"None"!==n&&""!==n||(n="Unknown type..."),t.labels.includes(n)){var r=t.labels.indexOf(n);t.datasets[0].data[r]=(e.height&&e.height,t.datasets[0].data[r]+1)}else t.labels.push(n),t.datasets[0].data.push(0),t.datasets[0].backgroundColor.push("rgba(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],", 0.2)")),t.datasets[0].borderColor.push("rgba(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],", 0.8)"))})),a(t)}()}),[t]),Object(Y.jsx)(Y.Fragment,{children:c&&Object(Y.jsx)(fe.b,{data:r})})}var xe=function(){return Object(Y.jsx)(Gt,{direction:"right",width:window.innerWidth/3,children:Object(Y.jsx)(H.a,{sx:{margin:1},children:Object(Y.jsxs)(dt.a,{container:!0,spacing:1,direction:"row",children:[Object(Y.jsx)(dt.a,{item:!0,xs:12,md:12,lg:12,xl:12,children:Object(Y.jsx)(Z.a,{variant:"outlined",children:Object(Y.jsx)($.a,{children:Object(Y.jsx)(ge,{})})})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:12,lg:6,xl:6,children:Object(Y.jsx)(Z.a,{variant:"outlined",children:Object(Y.jsx)($.a,{children:Object(Y.jsx)(ye,{})})})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:12,lg:6,xl:6,children:Object(Y.jsx)(Z.a,{variant:"outlined",children:Object(Y.jsx)($.a,{children:Object(Y.jsx)(me,{})})})})]})})})};function we(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(Y.jsxs)(Y.Fragment,{children:[!t&&Object(Y.jsx)(X,{loadingModules:[e]}),e&&Object(Y.jsx)(q,{tableName:e}),t&&Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(de,{}),Object(Y.jsx)(Ft,{}),Object(Y.jsx)(xe,{})]})]})}var Se=n(13);function Ee(){var t=Object(i.useState)(0),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(Se.a)(W.a)((function(t){t.theme;return{height:10}}));return Object(i.useEffect)((function(){var t=setInterval((function(){r((function(t){if(100===t)return 0;var e=10*Math.random();return Math.min(t+e,100)}))}),500);return function(){clearInterval(t)}}),[]),Object(Y.jsx)(H.a,{sx:{width:"100%",position:"fixed",bottom:"0px"},children:Object(Y.jsx)(a,{variant:"determinate",value:n})})}function Ce(){Ce=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new w(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(S([])));j&&j!==e&&n.call(j,a)&&(p=j);var g=f.prototype=d.prototype=Object.create(p);function O(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(g,"constructor",f),c(f,"constructor",h),h.displayName=c(f,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,i,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},O(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(g),c(g,i,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function Ie(t){var e=t.getTablesList,n=Object(i.useState)([]),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(i.useState)(!0),u=Object(o.a)(s,2),l=u[0],d=u[1];Object(i.useEffect)((function(){a&&e(a)}),[a]);var h=function(){var t=Object(S.a)(Ce().mark((function t(){var e,n,r;return Ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=C.cityIO.baseURL+C.cityIO.ListOfTables,t.next=3,G.a.get(e);case 3:n=t.sent,r=n.data.map(function(){var t=Object(S.a)(Ce().mark((function t(e){var n;return Ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(C.cityIO.baseURL,"table/").concat(e,"/"),t.abrupt("return",G.a.get("".concat(n,"GEOGRID/properties/header/")).then((function(t){return c((function(r){return[].concat(Object(gt.a)(r),[{tableURL:n,tableName:e,tableHeader:t.data}])}))})).catch((function(t){return console.log(t.toString())})));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Promise.all(r).then((function(){return d(!1),a}));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(i.useEffect)((function(){h()}),[]),Object(Y.jsx)(Y.Fragment,{children:l&&Object(Y.jsx)(Ee,{})})}var Le=n(673),_e=n(680);function Te(t){var e=t.clicked,n=E+"?cityscope=",r=E+"?projection=",a=Object(i.useState)(!1),c=Object(o.a)(a,2),s=c[0],u=c[1];Object(i.useEffect)((function(){u(!0)}),[e]);var l=function(){u(!1)};return Object(Y.jsxs)(yt.a,{open:s,onClose:l,"aria-labelledby":"table-select-dialog-title","aria-describedby":"table-select-dialog-description",children:[Object(Y.jsxs)(xt.a,{id:"table-select-dialog-title",children:["CityScope ",e.tableName]}),Object(Y.jsx)(wt.a,{children:Object(Y.jsx)(St.a,{id:"table-select-dialog-description",children:Object(Y.jsxs)(U.a,{component:"span",children:[Object(Y.jsx)(_e.a,{href:n+e.tableName.toLowerCase(),children:"Go to project"}),", ",Object(Y.jsx)(_e.a,{href:r+e.tableName.toLowerCase(),children:"project this table to TUI"})," ","or"," ",Object(Y.jsx)(_e.a,{target:"blank",href:e.tableURL,children:"view raw data on cityIO."})]})})}),Object(Y.jsx)(Ct.a,{children:Object(Y.jsx)(et.a,{onClick:l,children:"(x) Close"})})]})}function Me(t){var e=t.tablesList,n=Object(i.useState)(null),r=Object(o.a)(n,2),a=r[0],c=r[1],s={options:e,getOptionLabel:function(t){return t.tableName}};return Object(Y.jsxs)(Y.Fragment,{children:[a&&Object(Y.jsx)(Te,{clicked:a}),Object(Y.jsx)(Le.a,Object(w.a)(Object(w.a)({},s),{},{disablePortal:!0,id:"combo-box-demo",options:e,sx:{width:300},renderInput:function(t){return Object(Y.jsx)(Et.a,Object(w.a)(Object(w.a)({},t),{},{label:"Search CityScope Project..."}))},onChange:function(t,e){c(e)}}))]})}var Ae=n(417),Ge=n.n(Ae),ke=n(34),De=n(691),Ne=n(664),Re=n(658),Pe=n(676),Be=n(682),Fe=n(297),ze=n.p+"static/media/legoio.148c5ab6.png";function Ve(t){var e=Object(i.useState)([]),n=Object(o.a)(e,2),r=n[0],a=n[1],c=Object(i.useState)(),s=Object(o.a)(c,2),u=s[0],l=s[1],d=Object(i.useState)(),h=Object(o.a)(d,2),f=h[0],p=h[1],b={longitude:-71.060929,latitude:42.3545259,zoom:1,pitch:0,bearing:0,zHeight:2e6},j=Object(i.useState)(b),g=Object(o.a)(j,2),O=g[0],v=g[1],m=Object(i.useState)(O),y=Object(o.a)(m,2),x=y[0],w=y[1],S=!1;Object(i.useEffect)((function(){p(b.zoom),document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()}))}),[b.zoom]),Object(i.useEffect)((function(){var e=[];t.cityIOdata.forEach((function(t,n){e.push({tableURL:t.tableURL,tableName:t.tableName,index:n,tableHeader:t.tableHeader,coord:{from:[t.tableHeader.longitude,t.tableHeader.latitude],to:[t.tableHeader.longitude+n/10,t.tableHeader.latitude+n/10,b.zHeight]}})})),a(e)}),[t,b.zHeight]);var E=[new Ne.a({data:"https://basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,tileSize:96,renderSubLayers:function(t){var e=t.tile.bbox,n=e.west,r=e.south,a=e.east,o=e.north;return new Pe.a(t,{data:null,image:t.data,_imageCoordinateSystem:ke.a.CARTESIAN,bounds:[n,r,a,o]})}}),new Be.a({id:"LineLayer",data:r,pickable:!0,getWidth:f<2?.5:0,getSourcePosition:function(t){return t.coord.from},getTargetPosition:function(t){return t.coord.to},getColor:function(t){return[255,82,120]}}),new oe.a({id:"text-layer",data:r,pickable:!0,getPosition:function(t){return t.coord.to},getText:function(t){return t.tableName},getColor:[255,82,120],getSize:f<2?0:10,getAngle:0,getPixelOffset:[10,5],getTextAnchor:"start",getAlignmentBaseline:"center"}),new Fe.a({id:"icon-layer",data:r,pickable:!0,iconAtlas:ze,onClick:function(t){w({longitude:t.object.coord.to[0],latitude:t.object.coord.to[1],zoom:3,pitch:0,bearing:0,transitionDuration:1e3,transitionInterpolator:new Re.a}),l(t)},iconMapping:{marker:{x:0,y:0,width:768,height:768,mask:!1}},getIcon:function(t){return"marker"},sizeScale:1,getSize:f<5?20:10,getPosition:function(t){return[t.coord.to[0],t.coord.to[1],b.zHeight]}})];return Object(Y.jsxs)(Y.Fragment,{children:[u&&u.object&&Object(Y.jsx)(Te,{clicked:u.object}),Object(Y.jsx)(Jt.a,{views:new De.a,onHover:function(t){var e=t.object;return S=Boolean(e)},getCursor:function(t){return t.isDragging?"grabbing":S?"crosshair":"grab"},layers:E,controller:!0,initialViewState:x,onViewportChange:v,onViewStateChange:function(t){return p(t.viewState.zoom)},ContextProvider:Xt.b.Provider})]})}function He(){var t=Object(i.useState)([]),e=Object(o.a)(t,2),n=e[0],r=e[1];return Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(Ve,{cityIOdata:n}),Object(Y.jsxs)(H.a,{sx:{width:"100%",padding:5},children:[Object(Y.jsx)(Ie,{getTablesList:r}),Object(Y.jsxs)(dt.a,{container:!0,spacing:2,children:[Object(Y.jsx)(dt.a,{item:!0,xs:12,children:Object(Y.jsx)(Me,{tablesList:n})}),Object(Y.jsxs)(dt.a,{item:!0,xs:12,lg:6,zIndex:10,children:[Object(Y.jsx)(U.a,{variant:"h1",children:"MIT CityScope"}),Object(Y.jsxs)(U.a,{variant:"h4",children:["MIT CityScope is an open-source urban modeling and simulation platform. CityScope allows users to examine different design alternatives, and observe their impact through multiple layers of urban analytics.",Object(Y.jsx)(_e.a,{href:"https://github.com/CityScope",target:"blank",children:"Join the CityScope open-source development"}),"  ",Object(Y.jsx)(Ge.a,{fontSize:"small"})]})]})]})]})]})}var Ue=n(659),We=n(681),Ye=n(209),Xe=n(381),Je=n(660);function Ke(){Ke=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),i=new w(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return E()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=m(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,i),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(S([])));j&&j!==e&&n.call(j,a)&&(p=j);var g=f.prototype=d.prototype=Object.create(p);function O(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,o,i,c){var s=u(t[a],t,o);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(d).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function S(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(g,"constructor",f),c(f,"constructor",h),h.displayName=c(f,i,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,i,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},O(v.prototype),c(v.prototype,o,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new v(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(g),c(g,i,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var qe=new Ue.a({type:"x,z",xlen:0,ylen:0,zlen:0});function Qe(){Object(i.useEffect)((function(){document.addEventListener("contextmenu",(function(t){return t.preventDefault()}))}),[]);var t=Object(i.useRef)(),e=Object(i.useRef)(),n=Object(i.useState)(null),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(i.useState)(!1),l=Object(o.a)(s,2),d=l[0],h=l[1],f=Object(i.useState)("Aerial view of the MIT Campus in Cambridge, Massachusetts, with new buildings and development in the center. Realistic. Accurate. Sunset with long shadows. Beautiful."),p=Object(o.a)(f,2),b=p[0],j=p[1],g=Object(i.useState)(1024),O=Object(o.a)(g,2),v=O[0],m=O[1],y=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),x=re(y),w=x.properties.header,E=function(){var t=y.GEOGRID.features[y.GEOGRID.features.length-1].geometry.coordinates[0][0],e=y.GEOGRID.features[0].geometry.coordinates[0][0],n=[(e[0]+t[0])/2,(e[1]+t[1])/2];return n}(),C=Object(i.useState)({longitude:E[0],latitude:E[1],zoom:15,bearing:360-w.rotation,pitch:45}),L=Object(o.a)(C,2),_=L[0],T=L[1],M=Object(i.useState)(document.createElement("canvas")),A=Object(o.a)(M,1)[0],k=function(t){return new Promise((function(e){var n=new FileReader;n.onload=e,n.readAsDataURL(t)})).then((function(t){return t.target.result}))};return Object(Y.jsxs)(Y.Fragment,{children:[d&&Object(Y.jsx)(X,{loadingModules:[""]}),Object(Y.jsx)(H.a,{component:"main",sx:{flexGrow:1,height:"100vh",overflow:"auto"},children:Object(Y.jsx)(We.a,{maxWidth:"xl",sx:{mt:5,mb:5},children:Object(Y.jsxs)(dt.a,{container:!0,spacing:2,children:[Object(Y.jsx)(dt.a,{item:!0,xs:12,children:Object(Y.jsx)(dt.a,{sx:{display:"flex",flexDirection:"column"},children:Object(Y.jsx)(Ye.a,{variant:"outlined",sx:{variant:"outlined",p:2,flexDirection:"column",display:"flex",flexGrow:1},children:Object(Y.jsxs)(dt.a,{container:!0,spacing:2,children:[Object(Y.jsx)(dt.a,{item:!0,children:Object(Y.jsx)(U.a,{variant:"h2",children:"DeepScope 2.0"})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:6,children:Object(Y.jsx)(U.a,{children:"DeepScope attempts to substitute common practices of urban design with a machine-learnt, generative visualization approach. By implementing 'Stable diffusion', an open-source Transformer model, this tool allows for real-time prototyping and visualizations of urban design processes."})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:6,children:Object(Y.jsx)(Et.a,{fullWidth:!0,id:"outlined-basic",required:!0,label:"Text Prompt Description of the Scene",defaultValue:b,variant:"outlined",onChange:function(t){return j(t.target.value)}})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:6,children:Object(Y.jsx)(Et.a,{fullWidth:!0,id:"outlined-basic",InputProps:{inputProps:{max:1e4,min:0}},label:"Select a random seed (0-10000)",defaultValue:v,variant:"outlined",type:"number",onChange:function(t){return m(t.target.value)}})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:12,children:Object(Y.jsxs)(et.a,{fullWidth:!0,color:"secondary",variant:"outlined",onClick:function(){if(t.current&&e.current){h(!0);var n=t.current.getMap(),r=e.current.deck,a=n.getCanvas();r.redraw(!0);var o=r.canvas;A.width=a.width,A.height=a.height;var i=A.getContext("2d");i.globalAlpha=1,i.drawImage(a,0,0),i.globalAlpha=1,i.drawImage(o,0,0);var s=A.toDataURL("image/jpeg");c(s),A.toBlob(function(){var t=Object(S.a)(Ke().mark((function t(e){var n;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new FormData).append("image",e,"image.jpg"),n.append("prompt",b),n.append("user_seed",v),n.append("from","frontend"),t.next=7,G()({method:"post","Access-Control-Allow-Origin":"*",mode:"no-cors",url:"http://18.27.78.190:8080/",data:n,headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(function(){var t=Object(S.a)(Ke().mark((function t(e){var n;return Ke().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k(e.data);case 2:n=t.sent,c(n),h(!1);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){t.response?(console.log(t.response.data),console.log(t.response.status),console.log(t.response.headers)):t.request?console.log(t.request):console.log("Error",t.message)}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},disabled:d,children:[!d&&"Capture & Render",d&&Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(Xe.a,{size:14}),Object(Y.jsx)(U.a,{sx:{p:1},children:"Rendering captured view... [can take ~15 seconds]"})]})]})})]})})})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:6,lg:6,children:Object(Y.jsx)(Ye.a,{variant:"outlined",sx:{variant:"outlined",p:2,flexDirection:"column",display:"flex"},children:Object(Y.jsxs)(Je.a,{spacing:2,direction:"column",children:[Object(Y.jsx)(U.a,{variant:"h4",children:"CityScope Model View"}),Object(Y.jsx)(H.a,{sx:{height:"576px",minHeight:"576px",width:"auto",position:"relative"},children:Object(Y.jsx)(Jt.a,{ref:e,viewState:_,onViewStateChange:function(t){var e=t.viewState;return T(e)},controller:{touchZoom:!0,touchRotate:!0,keyboard:!1},layers:[new se.a({id:"mesh-layer",data:x.features,loaders:[ue.a],mesh:qe,getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2,t.properties.height.length>1?t.properties.height[1]>1?t.properties.height[1]/2:1:t.properties.height>1?t.properties.height/2:1]},getColor:function(t){return t.properties.interactive?t.properties.color:[0,0,0,0]},opacity:.75,getOrientation:function(t){return[-180,w.rotation,-90]},getScale:function(t){return[x.properties.header.cellSize/2,t.properties.height.length>1?t.properties.height[1]>1?t.properties.height[1]/2:1:t.properties.height>1?t.properties.height/2:1,x.properties.header.cellSize/2]},updateTriggers:{getScale:x}})],children:Object(Y.jsx)(Xt.c,{ref:t,preserveDrawingBuffer:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:I.map.mapStyle.normal})})})]})})}),Object(Y.jsx)(dt.a,{item:!0,xs:12,md:6,lg:6,children:Object(Y.jsx)(Ye.a,{variant:"outlined",sx:{p:2,display:"flex",flexDirection:"column",height:"auto",width:"auto"},children:Object(Y.jsxs)(Je.a,{spacing:2,direction:"column",children:[Object(Y.jsx)(U.a,{variant:"h4",children:"Captured & Rendered View"}),a&&Object(Y.jsx)("img",{style:{height:"576px"},src:a,alt:"screenshot"})]})})})]})})})]})}function Ze(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(Y.jsxs)(Y.Fragment,{children:[e&&Object(Y.jsx)(q,{tableName:e}),t&&Object(Y.jsx)(Qe,{})]})}var $e=function(t){var e=t.viewState,n=t.setViewState,r=Object.keys(e).map((function(t){return Number.isFinite(e[t])?Object(Y.jsx)(Et.a,{id:"outlined-number",label:t,type:"number",value:e[t],onChange:function(r){n(Object(w.a)(Object(w.a)({},e),{},Object(x.a)({},t,parseFloat(r.target.value))))}},t):null}));return Object(Y.jsxs)(H.a,{sx:{component:"form",backgroundColor:"rgba(0,0,0,0.95)","& .MuiTextField-root":{m:2,width:"90%"},bottom:"1vh",left:"1vw",maxWidth:"30%",position:"fixed",zIndex:"tooltip"},noValidate:!0,autoComplete:"off",children:[Object(Y.jsx)("div",{children:"Changes are saved automatically. Press [ z ] again to hide."}),Object(Y.jsx)("div",{children:r})]})};function tn(t){var e=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),n=e&&e.tui,r=e.GEOGRID.properties.header,a=t.viewStateEditMode,c=t.layers,s=t.editMode,l={active:n&&n.MAP_STYLE&&n.MAP_STYLE.active,style:I.map.mapStyle[n&&n.MAP_STYLE&&n.MAP_STYLE.style]||I.map.mapStyle.blue},d=Object(i.useState)(),h=Object(o.a)(d,2),f=h[0],p=h[1],b=Object(i.useRef)(null);Object(i.useEffect)((function(){if(document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()})),localStorage.getItem("projectionViewStateStorage")){console.log("loading prev. projectionViewStateStorage...");var t=localStorage.getItem("projectionViewStateStorage");p(JSON.parse(t))}else p(Object(w.a)(Object(w.a)({},f),{},{longitude:r.longitude,latitude:r.latitude,zoom:15,pitch:0,bearing:360-r.rotation,orthographic:!0}))}),[]);return Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(Jt.a,{ref:b,viewState:f,onViewStateChange:function(t){var e=t.viewState;localStorage.setItem("projectionViewStateStorage",JSON.stringify(e)),p(Object(w.a)(Object(w.a)({},e),{},{pitch:0,orthographic:!0}))},layers:c,controller:{},children:!s&&Object(Y.jsx)(Xt.c,{active:l.active,width:"100%",height:"100%",mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:l.style})}),a&&f&&Object(Y.jsx)($e,{setViewState:p,viewState:f})]})}function en(t){var e=t.editMode,n=t.viewStateEditMode,r=(t.layersVisibilityControl,Object(u.c)((function(t){return t.cityIOdataState.cityIOdata}))),a=r&&r.tui,c=Object(i.useState)(I.map.layers.ABM.startTime),s=Object(o.a)(c,2),l=s[0],d=s[1],h=Object(i.useState)({}),f=Object(o.a)(h,1)[0],p=function t(){d((function(t){return t>I.map.layers.ABM.endTime?I.map.layers.ABM.startTime:t+I.map.layers.ABM.animationSpeed})),f.id=window.requestAnimationFrame(t)};Object(i.useEffect)((function(){return f.id=window.requestAnimationFrame(p),function(){return window.cancelAnimationFrame(f.id)}}),[f]);return Object(Y.jsx)(tn,{editMode:e,viewStateEditMode:n,layers:a?[new ee.a({id:"GRID",visible:a.GRID.active,data:re(r),opacity:.5,extruded:!1,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:1,getFillColor:function(t){return t.properties.color},transitions:{getFillColor:500}}),new Kt.a({id:"ACCESS",visible:a.ACCESS.active,colorRange:[[233,62,58],[237,104,60],[243,144,63]],intensity:1,threshold:.5,data:r.access&&r.access.features,getPosition:function(t){return t.geometry.coordinates},getWeight:function(t){return t.properties[a.ACCESS.toggleArray.curr_active]||0},updateTriggers:{getWeight:a.ACCESS.toggleArray.curr_active}}),new oe.a({id:"text",visible:a.TEXT&&a.TEXT.active,data:r.GEOGRID&&r.GEOGRID.features,getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2]},getText:function(t){return t.properties.name.length>5?t.properties.name.substring(0,2)+"...":t.properties.name},getColor:function(t){return[0,0,0]},getSize:8}),new $t.a({id:"ABM",visible:a.ABM&&a.ABM.active,data:r.ABM2&&r.ABM2.trips,getColor:function(t){return N(r.ABM2.attr.mode[t.mode].color)},getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},fadeTrail:!0,getWidth:10,trailLength:200,currentTime:l})]:[]})}var nn=n(6),rn=n(7),an=n(14),on=n(15),cn=20/1.5,sn={container:{width:20,height:20,borderRadius:"50%",position:"absolute",border:"1px solid white",cursor:"move"},"top-left":{left:-cn,top:-cn},"bottom-left":{left:-cn,bottom:-cn},"top-right":{top:-cn,right:-cn},"bottom-right":{bottom:-cn,right:-cn}},un=function(t){var e,n=t.position,r=t.translation,a=t.onMouseEnter,o=t.onMouseDown,i=t.onMouseUp,c=t.className,s=void 0===c?"":c,u=t.style,l=void 0===u?{}:u;return Object(Y.jsx)("div",{onMouseEnter:function(){return a&&a(n)},onMouseDown:function(t){return o(t,n)},onMouseUp:function(){return i(n)},className:s,style:Object(w.a)(Object(w.a)(Object(w.a)(Object(w.a)({},sn.container),sn[n]),l),{},{transform:(e=r,"translate(".concat(e[0],"px, ").concat(e[1],"px)"))})})},ln=n(503).solve,dn=function(t,e){for(var n=[],r=[],a=0,i=t.length;a<i;++a){var c=Object(o.a)(t[a],2),s=c[0],u=c[1],l=Object(o.a)(e[a],2),d=l[0],h=l[1];n.push([s,u,1,0,0,0,-s*d,-u*d],[0,0,0,s,u,1,-s*h,-u*h]),r.push(d,h)}var f=ln(n,r,!0);return[f[0],f[3],0,f[6],f[1],f[4],0,f[7],0,0,1,0,f[2],f[5],0,1].map((function(t){return function(t,e){var n=Math.pow(10,e),r=t*n;return Math.round(r)/n}(t,10)}))},hn=function(t){return"matrix3d(".concat(t.join(", "),")")},fn={position:"relative"},pn=["top-left","top-right","bottom-right","bottom-left"],bn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],jn=function(){var t={};return pn.forEach((function(e){t[e]=[0,0]})),t},gn=function(t){Object(an.a)(n,t);var e=Object(on.a)(n);function n(){var t;Object(nn.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))).container=void 0,t.layerTranslateDelta=void 0,t.anchorTranslateDelta=void 0,t.isAnchorDragging=!1,t.targetPoints=void 0,t.anchorMoving=void 0,t.state={matrix:bn,translateDelta:jn(),sourcePoints:void 0,transformOrigin:[0,0],containerTranslate:[t.props.x||0,t.props.y||0]},t.onAnchorMouseDown=function(e,n){e.stopPropagation(),t.anchorTranslateDelta=[e.pageX-t.state.translateDelta[n][0],e.pageY-t.state.translateDelta[n][1]],t.anchorMoving=n},t.onAnchorMouseMove=function(e){if(t.anchorTranslateDelta&&t.state.sourcePoints&&t.anchorMoving){e.preventDefault(),e.stopPropagation();var n=pn.indexOf(t.anchorMoving),r=e.pageX-t.anchorTranslateDelta[0],a=e.pageY-t.anchorTranslateDelta[1];t.targetPoints[n]=[t.state.sourcePoints[n][0]+r,t.state.sourcePoints[n][1]+a],t.setState({matrix:dn(t.state.sourcePoints,t.targetPoints),translateDelta:Object(w.a)(Object(w.a)({},t.state.translateDelta),{},Object(x.a)({},t.anchorMoving,[r,a]))})}},t.onAnchorMouseUp=function(e){t.anchorTranslateDelta=void 0,t.anchorMoving=void 0},t.onMouseUp=function(){t.layerTranslateDelta=void 0},t.onMouseMove=function(e){if(t.layerTranslateDelta&&t.props.isEditMode){var n=[e.pageX-t.layerTranslateDelta[0],e.pageY-t.layerTranslateDelta[1]];t.setState({containerTranslate:n})}},t.onMouseDown=function(e){var n=t.state.containerTranslate;t.layerTranslateDelta=[e.pageX-n[0],e.pageY-n[1]]},t}return Object(rn.a)(n,[{key:"componentDidMount",value:function(){if(window.addEventListener("mousemove",this.onAnchorMouseMove),window.addEventListener("mousemove",this.onMouseMove),this.container){var t=this.container.getBoundingClientRect(),e=t.width,n=t.height,r=[[0,0],[e-0,0],[e-0,n-0],[0,n-0]];if(this.targetPoints=[].concat(r),this.setState({sourcePoints:r}),localStorage.getItem("projMap")){console.log("loading prev. projMap...");var a=localStorage.getItem("projMap");this.setState(JSON.parse(a))}}}},{key:"componentDidUpdate",value:function(t,e){localStorage.setItem("projMap",JSON.stringify(e))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onAnchorMouseMove),window.removeEventListener("mousemove",this.onMouseMove)}},{key:"render",value:function(){var t,e=this,n=this.props,r=n.style,a=n.isEditMode,o=n.className,i=n.anchorStyle,c=n.anchorClassName,s=this.state,u=s.translateDelta,l=s.matrix,d=s.containerTranslate,h=s.transformOrigin;return Object(Y.jsx)(Y.Fragment,{children:Object(Y.jsxs)("div",{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,style:{cursor:a?"all-scroll":"inherit",position:"relative",display:"inline-block",transform:(t=d,"translate(".concat(t[0],"px, ").concat(t[1],"px)"))},children:[Object(Y.jsx)("div",{ref:function(t){e.container=t},style:Object(w.a)(Object(w.a)(Object(w.a)({},fn),r),{},{pointerEvents:a?"none":"all",transform:hn(l),transformOrigin:"".concat(h[0],"px ").concat(h[1],"px 0px")}),className:o,children:this.props.children}),a&&Object(Y.jsx)("div",{children:pn.map((function(t,n){return Object(Y.jsx)(un,{style:i,className:c,translation:u[t],position:t,onMouseDown:e.onAnchorMouseDown,onMouseUp:e.onAnchorMouseUp},t)}))})]})})}}]),n}(i.Component);function On(){return Object(Y.jsx)(dt.a,{container:!0,alignItems:"center",justify:"center",children:Object(Y.jsx)(et.a,{sx:{zIndex:"tooltip",top:"50vh",left:"50vw"},variant:"contained",startIcon:Object(Y.jsx)(Lt.a,{}),children:"Reset Projection Mapping"})})}function vn(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=t.GEOGRID.properties.header.ncols/t.GEOGRID.properties.header.nrows,n=Object(i.useState)(!1),r=Object(o.a)(n,2),a=r[0],c=r[1],s=Object(i.useState)(!1),l=Object(o.a)(s,2),d=l[0],h=l[1];return Object(i.useEffect)((function(){console.log("Keystone starting...");var t=function(t){var e=t.key;" "===e&&c((function(t){return!t})),"z"===e&&h((function(t){return!t}))};return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}),[]),Object(Y.jsxs)(Y.Fragment,{children:[a&&Object(Y.jsx)("div",{onClick:function(){return localStorage.getItem("projMap")&&localStorage.removeItem("projMap"),localStorage.getItem("projectionViewStateStorage")&&localStorage.removeItem("projectionViewStateStorage"),void window.location.reload()},children:Object(Y.jsx)(On,{})}),Object(Y.jsx)("div",{style:{height:"100vh",width:"100vw",overflow:"hidden",position:"fixed",top:0,left:0,zIndex:1e3},children:Object(Y.jsx)("div",{children:Object(Y.jsx)(gn,{style:{height:"100vh",width:"".concat(100*e,"vh"),backgroundColor:a?"rgba(255,0,0)":null},isEditMode:a,children:Object(Y.jsx)(en,{editMode:a,viewStateEditMode:d})})})})]})}function mn(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(Y.jsxs)(Y.Fragment,{children:[e&&Object(Y.jsx)(q,{tableName:e}),t&&Object(Y.jsx)(vn,{})]})}function yn(t){if(!t.mousePos)return null;var e=t.mousePos,n=t.mouseDown,r=t.selectedType,a=t.divSize,o=e.x-a/2,i=e.y-a/2;return Object(Y.jsx)("div",{style:{border:"2px solid",backgroundColor:n?r.color:"rgba(0,0,0,0)",borderColor:r.color,color:r.color,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:a,height:a,left:o||0,top:i||0},children:Object(Y.jsx)("div",{style:{position:"relative",left:a+10,fontSize:"0.5em"},children:r.name})})}var xn=Object(l.b)({name:"menuState",initialState:{editorMapCenter:{latitude:M.GEOGRID.properties.header.latitude,longitude:M.GEOGRID.properties.header.longitude},gridMaker:{},gridProps:{},typesEditorState:{}},reducers:{updateEditorMapCenter:function(t,e){t.editorMapCenter=e.payload},updateGridProps:function(t,e){t.gridProps=e.payload},updateGridMaker:function(t,e){t.gridMaker=e.payload},updateTypesEditorState:function(t,e){t.typesEditorState=e.payload}}}),wn=xn.actions,Sn=wn.updateEditorMapCenter,En=wn.updateGridProps,Cn=wn.updateGridMaker,In=wn.updateTypesEditorState,Ln=xn.reducer;function _n(){var t=Object(u.b)(),e=Object(i.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1],c=Object(u.c)((function(t){return t.editorMenuState.typesEditorState.selectedRow})),s=Object(u.c)((function(t){return t.editorMenuState.gridMaker}));Object(i.useEffect)((function(){a(s)}),[s]);var l=Object(u.c)((function(t){return t.editorMenuState.editorMapCenter})),d=Object(i.useRef)(null);Object(i.useEffect)((function(){P(l)}),[l]);var h=Object(i.useState)(M.map.initialViewState),f=Object(o.a)(h,2),p=f[0],b=f[1],j=Object(i.useState)(),g=Object(o.a)(j,2),O=g[0],v=g[1],m=Object(i.useState)(),y=Object(o.a)(m,2),x=y[0],S=y[1],E=Object(i.useState)(),C=Object(o.a)(E,2),I=C[0],L=C[1],_=Object(i.useState)(!1),T=Object(o.a)(_,2),A=T[0],G=T[1],k=Object(i.useState)(),D=Object(o.a)(k,1)[0],P=function(t){b(Object(w.a)(Object(w.a)({},p),{},{latitude:t&&t.latCenter||M.GEOGRID.properties.header.latitude,longitude:t&&t.lonCenter||M.GEOGRID.properties.header.longitude,zoom:15,pitch:0,bearing:0,orthographic:!0}))};Object(i.useEffect)((function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()})),P()}),[]);var B=function(t){if(c){var e=c.height,n=c.name,r=c.color,o=c.interactive,i=function(t){var e=t.x-20,n=t.y-20;return d.current.pickObjects({x:e,y:n,width:40,height:40})}(t);i.forEach((function(t,i){var c=Object(w.a)({},t.object.properties);c.color=R(r)?N(r):r,c.height=e,c.name=n,"No"!==o?c.interactive=o:delete c.interactive,a((function(e){return Object(w.a)(Object(w.a)({},e),{},{features:e.features.map((function(e){return t.index===e.properties.id?Object(w.a)(Object(w.a)({},e),{},{properties:c}):e}))})}))}))}};return Object(Y.jsxs)("div",{onKeyDown:function(t){v(t.nativeEvent.key)},onKeyUp:function(){v(null)},onMouseMove:function(t){return S(t.nativeEvent)},onMouseUp:function(){t(Cn(r)),L(!1)},onMouseDown:function(){return L(!0)},children:[c&&Object(Y.jsx)(yn,{mousePos:x,selectedType:c,divSize:40,mouseDown:I}),Object(Y.jsx)(Jt.a,{ref:d,viewState:p,onViewStateChange:function(t){var e=t.viewState;b(e)},layers:[new ee.a({id:"GRID",opacity:.5,stroked:!1,filled:!0,wireframe:!0,visible:!0,pickable:!0,data:r,extruded:!0,lineWidthScale:1,lineWidthMinPixels:1,getElevation:function(t){return t.properties.height[1]},getFillColor:function(t){return t.properties.color},onClick:function(t,e){e.rightButton||"Shift"===O||B(t)},onDrag:function(t,e){e.rightButton||"Shift"===O||B(t)},onDragStart:function(t,e){e.rightButton||"Shift"===O||G(!0)},onDragEnd:function(){G(!1)},updateTriggers:{getFillColor:D,getElevation:D}})],controller:{touchZoom:!0,touchRotate:!0,dragPan:!A,dragRotate:!A,keyboard:!1},children:Object(Y.jsx)(Xt.a,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:M.map.mapStyle.sat,preventStyleDiffing:!0})})]})}var Tn=n(418),Mn=n.n(Tn);function An(t){var e=Object(u.b)();return Object(Y.jsx)(et.a,{onClick:function(){e(Sn({latCenter:parseFloat(t.mapCenter[0]),lonCenter:parseFloat(t.mapCenter[1])}))},variant:"outlined",startIcon:Object(Y.jsx)(Mn.a,{}),children:"Center Map to Grid"})}function Gn(){var t=M,e=Object(u.b)(),n=Object(i.useState)({tableName:t.GEOGRID.properties.header.tableName,latitude:t.GEOGRID.properties.header.latitude,longitude:t.GEOGRID.properties.header.longitude,tz:t.GEOGRID.properties.header.tz,nrows:t.GEOGRID.properties.header.nrows,ncols:t.GEOGRID.properties.header.nrows,rotation:t.GEOGRID.properties.header.rotation,cellSize:t.GEOGRID.properties.header.cellSize,projection:t.GEOGRID.properties.header.projection}),r=Object(o.a)(n,2),a=r[0],c=r[1],s=function(t){var e=t.target,n=e.id,r=e.value;c(Object(w.a)(Object(w.a)({},a),{},Object(x.a)({},n,r)))};return Object(i.useEffect)((function(){e(En(a))}),[a]),Object(Y.jsxs)(tt.a,{children:[Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(U.a,{variant:"h4",children:"Project Properties"})}),Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"tableName",label:"CityScope Project Name",defaultValue:a.tableName})}),Object(Y.jsx)(Q.a,{children:Object(Y.jsxs)(Je.a,{direction:"row",spacing:1,children:[Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"latitude",label:"Latitude",defaultValue:a.latitude,type:"number"}),Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"longitude",label:"Longitude",defaultValue:a.longitude,type:"number"}),Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"tz",label:"Time Zone (GMT)",defaultValue:a.tz,type:"number"})]})}),Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(An,{mapCenter:[a.latitude,a.longitude]})}),Object(Y.jsx)(Q.a,{children:Object(Y.jsxs)(Je.a,{direction:"row",spacing:1,children:[Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"nrows",label:"Rows",defaultValue:a.nrows,type:"number",InputProps:{inputProps:{max:100,min:0}}}),Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"ncols",label:"Columns",defaultValue:a.ncols,type:"number",InputProps:{inputProps:{max:100,min:0}}}),Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"rotation",label:"Rotation (deg)",defaultValue:a.rotation,type:"number",InputProps:{inputProps:{max:360,min:0}}}),Object(Y.jsx)(Et.a,{onChange:function(t){return s(t)},variant:"outlined",id:"cellSize",label:"Cell Size (m^2)",defaultValue:a.cellSize,type:"number",InputProps:{inputProps:{max:1e3,min:1}}})]})}),Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(Et.a,{size:"small",onChange:function(t){return s(t)},variant:"outlined",id:"projection",label:"Projection",defaultValue:a.projection,type:"string",helperText:"Default projection should work for most CityScope cases. Find specific projections at: https://epsg.io/"})})]})}var kn=n(419),Dn=n.n(kn),Nn=n(693),Rn=n(251);function Pn(t){return t*Math.PI/180}function Bn(t){return 180*t/Math.PI}var Fn=function(t){var e=Object.keys(t);return t[e[e.length*Math.random()<<0]]};function zn(){var t=Object(u.b)(),e=Object(i.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1],c=Object(i.useState)(!1),s=Object(o.a)(c,2),l=s[0],d=s[1],h=Object(u.c)((function(t){return t.editorMenuState.gridProps})),f=Object(u.c)((function(t){return t.editorMenuState.typesEditorState.tableData}));Object(i.useEffect)((function(){t(Cn(r))}),[r]);var p=function(){a(function(t,e){for(var n=parseFloat(t.longitude),r=parseFloat(t.latitude),a=parseFloat(t.rotation),o=t.projection,i=parseFloat(t.cellSize),c=parseFloat(t.nrows),s=parseFloat(t.ncols),u=Rn.a.defs("EPSG:4326"),l={lon:n,lat:r},d=(90-a+360)%360,h=i*s/6371e3,f=Pn(l.lat),p=Pn(l.lon),b=Pn(d),j=Math.asin(Math.sin(f)*Math.cos(h)+Math.cos(f)*Math.sin(h)*Math.cos(b)),g={lon:Bn(p+Math.atan2(Math.sin(b)*Math.sin(h)*Math.cos(f),Math.cos(h)-Math.sin(f)*Math.sin(j))),lat:Bn(j)},O=Object(Rn.a)(u,o,[l.lon,l.lat]),v=Object(Rn.a)(u,o,[g.lon,g.lat]),m=(v[1]-O[1])/(v[0]-O[0]),y=Math.atan(m),x=Math.cos(y),w=Math.sin(y),S=[],E=[],C=0;C<c;C++)for(var I=0;I<s;I++)S.push(I*i),E.push(-C*i);for(var L=[],_=[],T=0;T<S.length;T++)L.push(S[T]*x-E[T]*w),_.push(S[T]*w+E[T]*x);for(var M=[],A=[],G=0;G<L.length;G++)M.push(O[0]+L[G]),A.push(O[1]+_[G]);for(var k=M[1]-M[0],D=A[1]-A[0],R=M[s]-M[0],P=A[s]-A[0],B=[],F={type:"FeatureCollection",features:[]},z=e,V=0;V<M.length;V++){for(var H=Fn(z),U={type:"Feature",geometry:{type:"Polygon",coordinates:null},properties:{color:N(H.color),height:H.height,name:H.name,interactive:H.interactive,id:V}},W=[[M[V],A[V]],[M[V]+R,A[V]+P],[M[V]+R+k,A[V]+P+D],[M[V]+k,A[V]+D],[M[V],A[V]]],Y=[],X=0;X<5;X++){var J=Object(Rn.a)(o,u,W[X]);Y.push(J)}U.geometry.coordinates=[Y],B.push(U)}return F.features=B,F}(h,f))};return Object(Y.jsx)(Y.Fragment,{children:h&&f&&Object(Y.jsx)(Nn.a,{onClick:function(){d(!0),new Promise((function(t){setTimeout((function(){d(!1),p()}),100),t()}))},loading:l,loadingPosition:"start",variant:"outlined",startIcon:Object(Y.jsx)(Dn.a,{}),children:"Generate Grid"})})}var Vn=n(420),Hn=n.n(Vn),Un={columns:[{title:"Type",field:"name"},{title:"Description",field:"description"},{title:"Height Min.",field:"height[0]",type:"numeric"},{title:"Height Default",field:"height[1]",type:"numeric"},{title:"Height Max.",field:"height[2]",type:"numeric"},{title:"Interactive",field:"interactive",lookup:{No:"No",Web:"Web",TUI:"TUI"}},{title:"Color",field:"color",type:"string"},{title:"LBCS",field:"LBCS",type:"string"},{title:"NAICS",field:"NAICS",type:"string"}],data:function(t){var e=[];return Object.keys(t).forEach((function(n,r){e.push({id:r,name:n,description:"[edit info for type: "+n+"]",color:t[n].color,height:t[n].height?t[n].height:[0,0,0],LBCS:t[n].LBCS?JSON.stringify(t[n].LBCS):null,NAICS:t[n].NAICS?JSON.stringify(t[n].NAICS):null,interactive:t[n].interactive})})),e}(M.GEOGRID.properties.types)};function Wn(){var t=Object(i.useState)(Un),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(u.b)(),c=Object(i.useState)(),s=Object(o.a)(c,2),l=s[0],d=s[1],h=Object(i.useState)(),f=Object(o.a)(h,2),p=f[0],b=f[1];return Object(i.useEffect)((function(){a(In({tableData:n.data,selectedRow:l,rowColor:p}))}),[n,l,p]),Object(Y.jsx)(Hn.a,{title:Object(Y.jsx)(U.a,{variant:"h4",children:"Types Editor"}),columns:n.columns,data:n.data,options:{paging:!1,search:!0,selection:!1,rowStyle:function(t){return{backgroundColor:l&&l.tableData.id===t.tableData.id?p:null,color:l&&l.tableData.id===t.tableData.id?"black":"white"}}},onRowClick:function(t,e){d(e),b(e.color)},editable:{onRowAdd:function(t){return new Promise((function(e){e(),setTimeout((function(){r((function(e){var n=Object(gt.a)(e.data);return t.id=n.length,n.push(t),Object(w.a)(Object(w.a)({},e),{},{data:n})}))}),50)}))},onRowUpdate:function(t,e){return new Promise((function(n){n(),setTimeout((function(){e&&r((function(n){var r=Object(gt.a)(n.data),a=r.map((function(t){return t.id})).indexOf(e.id);return r[a]=t,Object(w.a)(Object(w.a)({},n),{},{data:r})}))}),50)}))}}})}function Yn(){var t=Object(i.useState)(!1),e=Object(o.a)(t,2),n=e[0],r=e[1],a=Object(i.useState)(),c=Object(o.a)(a,2),s=c[0],l=c[1],d=Object(u.c)((function(t){return t.editorMenuState.gridProps})),h=Object(u.c)((function(t){return t.editorMenuState.typesEditorState.tableData})),f=Object(u.c)((function(t){return t.editorMenuState.gridMaker})),p=f&&f.features&&f.features.length>0,b=function(){var t,e,n=M.GEOGRID,r=f.features,a=function(t,e,n,r){var a=Object(w.a)({},t),o={};return e.forEach((function(t){o[t.name]=Object(w.a)({},t),o[t.name].LBCS="string"===typeof t.LBCS?JSON.parse(t.LBCS):t.LBCS,o[t.name].NAICS="string"===typeof t.NAICS?JSON.parse(t.NAICS):t.NAICS})),a.properties.types=o,a.properties.header=Object(w.a)({},r),["longitude","latitude","rotation","nrows","ncols","cellSize"].forEach((function(t){a.properties.header[t]=parseFloat(a.properties.header[t])})),a.features=n,a}(n,h,r,d),o=function(t){var e=[];return t.forEach((function(t){e.push(t.properties)})),e}(r),i=a.properties.header.tableName.toLowerCase(),c="".concat(C.cityIO.baseURL,"table/").concat(i,"/"),s={GEOGRID:a,GEOGRIDDATA:o};G()((t=c,e=s,{method:"post",url:t,data:e,headers:{"Content-Type":"application/json",Accept:"application/json"}})).then((function(t){l(function(t,e){var n="https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+e;return Object(Y.jsxs)(U.a,{color:"textPrimary",variant:"caption",children:["CityIO is ",t.data.status,". Grid deployed to"," ",Object(Y.jsx)(_e.a,{color:"textSecondary",href:n,children:n})]})}(t,i))})).catch((function(t){return console.log("ERROR: ".concat(t))}))};return Object(Y.jsx)(Y.Fragment,{children:p&&Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(Nn.a,{onClick:function(){r(!0),new Promise((function(t){setTimeout((function(){r(!1),b()}),1500),t()}))},loading:n,loadingPosition:"start",variant:"outlined",startIcon:Object(Y.jsx)(Rt.a,{}),children:"Commit Grid to cityIO"}),Object(Y.jsxs)("div",{style:{width:"100%"},children:[" ",s]})]})})}function Xn(){var t=[Object(Y.jsx)(U.a,{variant:"h2",children:"CityScope Grid Editor"}),Object(Y.jsx)(U.a,{children:"This editor can create and `commit` spatial layouts (`grids`) as a baseline for CityScope projects. Use the menus and map to edit girds, types, and props, and commit them to cityIO."}),Object(Y.jsx)(Gn,{}),Object(Y.jsxs)(dt.a,{container:!0,spacing:2,children:[Object(Y.jsx)(dt.a,{item:!0,children:Object(Y.jsx)(zn,{})}),Object(Y.jsx)(dt.a,{item:!0,children:Object(Y.jsx)(Yn,{})})]}),Object(Y.jsx)(Wn,{})],e=function(){var e=[];return t.forEach((function(t,n){e.push(Object(Y.jsx)(Q.a,{children:Object(Y.jsx)(Z.a,{variant:"outlined",sx:{width:"100%"},children:Object(Y.jsx)($.a,{children:t})})},n))})),e};return Object(Y.jsx)(Gt,{direction:"left",width:500,children:Object(Y.jsx)(tt.a,{children:Object(Y.jsx)(e,{})})})}function Jn(){return Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(Xn,{}),Object(Y.jsx)(_n,{})]})}var Kn=function(){var t=Object(u.b)(),e=Object(i.useState)(),n=Object(o.a)(e,2),r=n[0],a=n[1];Object(i.useEffect)((function(){document.title=r?"CityScopeJS | ".concat(r):"CityScopeJS"}),[r]);var l=Object(i.useState)(),d=Object(o.a)(l,2),h=d[0],f=d[1],p=function(e,n){var r=n&&n.toLowerCase();r&&""!==r?(a(r),t(b(r)),f(e)):f("cityio")};return Object(i.useEffect)((function(){var t=window.location,e=O.a.parse(t.search),n=Object.keys(e);n.includes("cityscope")?p("cityscopejs",e.cityscope):n.includes("projection")?p("projection",e.projection):n.includes("render")?p("render",e.render):n.includes("editor")?f("grideditor"):f("cityio")}),[]),Object(Y.jsxs)(s.a,{theme:y,children:[Object(Y.jsx)(c.a,{}),Object(Y.jsxs)(Y.Fragment,{children:["cityscopejs"===h&&Object(Y.jsx)(we,{}),"grideditor"===h&&Object(Y.jsx)(Jn,{}),"cityio"===h&&Object(Y.jsx)(He,{}),"projection"===h&&Object(Y.jsx)(mn,{}),"render"===h&&Object(Y.jsx)(Ze,{})]})]})},qn=n(73),Qn=Object(qn.c)({cityIOdataState:j,menuState:ut,editorMenuState:Ln}),Zn=Object(l.a)({reducer:Qn});a.a.render(Object(Y.jsx)(Y.Fragment,{children:Object(Y.jsx)(u.a,{store:Zn,children:Object(Y.jsx)(Kn,{})})}),document.getElementById("root"))}},[[571,1,2]]]);
//# sourceMappingURL=main.b34049fc.chunk.js.map