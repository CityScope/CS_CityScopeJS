/*! For license information please see main.7fe19d83.chunk.js.LICENSE.txt */
(this.webpackJsonpcityscopejs=this.webpackJsonpcityscopejs||[]).push([[0],{160:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return s}));var r=n(5),a=n(611),i=n(51),o=function(t,e,n,r,a){var o=e.height,c=e.color,s=e.name,u=function(t,e,n){var r=e,a=t.x-r/2,i=t.y-r/2;return n.current.pickObjects({x:a,y:i,width:r,height:r})}(t,r,a);u.forEach((function(t){var e=t.object.properties;e&&e.interactive&&(e.color=Object(i.f)(c)?Object(i.d)(c):c,e.height=o,e.name=s)})),n(u)},c=function(t){var e=t.GEOGRID,n=JSON.parse(JSON.stringify(e));if(t.GEOGRIDDATA&&t.GEOGRIDDATA.length===t.GEOGRID.features.length)for(var a=t.GEOGRIDDATA,i=0;i<e.features.length;i++)n.features[i].properties=a[i],n.features[i].properties=Object(r.a)(Object(r.a)({},n.features[i].properties),{},{id:i});return n};function s(t){var e=t.data,n=t.editOn,r=t.state,i=r.selectedType,c=r.keyDownState,s=r.selectedCellsState,u=r.pickingRadius,l=r.opacity,d=t.updaters,h=d.setSelectedCellsState,f=d.setDraggingWhileEditing,p=d.setHoveredObj,b=t.deckGLref;return new a.a({opacity:l,id:"GRID",data:e,pickable:!0,extruded:!0,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:2,getElevation:function(t){return t.properties.height[1]},getFillColor:function(t){return t.properties.color},onClick:function(t){i&&n&&"Shift"!==c&&o(t,i,h,u,b)},onDrag:function(t){i&&n&&"Shift"!==c&&o(t,i,h,u,b)},onDragStart:function(){i&&n&&"Shift"!==c&&f(!0)},onHover:function(t){t.object&&p(t)},onDragEnd:function(){f(!1)},updateTriggers:{getFillColor:s,getElevation:s},transitions:{getFillColor:300,getElevation:300}})}},215:function(t,e,n){"use strict";var r=n(253),a=n(120),i=n(341),o=n(1);e.a=function(t){var e=t.loadingModules,n=t.verticalPosition,c=t.barHeight,s=t.noFixed;return Object(o.jsx)(o.Fragment,{children:e.map((function(t,e){return Object(o.jsxs)(r.a,{sx:{position:s?"absolute":"fixed",bottom:"bottom"===n?10*(e+1):"auto",width:s?"90%":"100%",zIndex:1e4},children:[Object(o.jsx)(i.a,{sx:{height:c||10},color:"secondary"}),Object(o.jsxs)(a.a,{variant:"caption",color:"primary",style:{marginRight:"1vw"},children:["Loading ",t]})]},"box_"+t)}))})}},266:function(t,e){},298:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return L}));var r=n(32),a=n(8),i=n(0),o=n(31),c=n(610),s=n(614),u=n(304),l=n(160),d=n(609),h=n(36),f=n(131),p=(n(234),n(215)),b=n(253),j=n(174),O=n(120),g=n(246),v=n(342),m=n(347),y=n(171),x=n(441),S=n(133),w=n.n(S),E=n(1);function C(){C=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(I){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return E()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var c=m(o,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,o),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(I){return{type:"throw",arg:I}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=f.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,i,o,c){var s=u(t[a],t,i);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,c)}),(function(t){r("throw",t,o,c)})):e.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function i(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(i,i):i()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(O,"constructor",f),c(f,"constructor",h),h.displayName=c(f,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,o,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,i,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new v(s(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},g(O),c(O,o,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var I=new d.a({type:"x,z",xlen:0,ylen:0,zlen:0});function L(){Object(i.useEffect)((function(){document.addEventListener("contextmenu",(function(t){return t.preventDefault()}))}),[]);var e=Object(i.useRef)(),n=Object(i.useRef)(),d=Object(i.useRef)(),S=Object(i.useState)(null),L=Object(a.a)(S,2),_=L[0],T=L[1],M=Object(i.useState)(!1),A=Object(a.a)(M,2),G=A[0],k=A[1],R=Object(i.useState)("Aerial view of the MIT Campus in Cambridge, Massachusetts. Realistic. Accurate. Sunset with long shadows. Beautiful."),D=Object(a.a)(R,2),N=D[0],P=D[1],B=Object(i.useState)(1024),F=Object(a.a)(B,2),z=F[0],V=F[1],U=Object(i.useState)("https://virtualscope.media.mit.edu/"),W=Object(a.a)(U,2),H=W[0],Y=W[1],X=Object(o.c)((function(t){return t.cityIOdataState.cityIOdata})),K=Object(l.b)(X),J=K.properties.header,q=function(){var t=X.GEOGRID.features[X.GEOGRID.features.length-1].geometry.coordinates[0][0],e=X.GEOGRID.features[0].geometry.coordinates[0][0],n=[(e[0]+t[0])/2,(e[1]+t[1])/2];return n}(),Q=Object(i.useState)({longitude:q[0],latitude:q[1],zoom:15,bearing:360-J.rotation,pitch:45}),Z=Object(a.a)(Q,2),$=Z[0],tt=Z[1],et=Object(i.useState)(document.createElement("canvas")),nt=Object(a.a)(et,1)[0],rt=function(t){return new Promise((function(e){var n=new FileReader;n.onload=e,n.readAsDataURL(t)})).then((function(t){return t.target.result}))};return Object(E.jsx)(E.Fragment,{children:Object(E.jsx)(b.a,{p:2,children:Object(E.jsxs)(j.a,{container:!0,spacing:2,children:[Object(E.jsxs)(j.a,{item:!0,children:[G&&Object(E.jsx)(p.a,{loadingModules:["..."]}),Object(E.jsx)(O.a,{variant:"caption",children:"DeepScope uses a machine learning model to generate urban scenes in real-time, based on designs preform in the CitySCcope platform. By implementing 'Stable diffusion', an open-source Transformer model, this tool allows for real-time prototyping and visualizations of urban design proposals, bypassing the need for expensive and time-consuming rendering."})]}),Object(E.jsx)(j.a,{item:!0,xs:12,md:7,children:Object(E.jsx)(g.a,{fullWidth:!0,id:"outlined-basic",required:!0,label:"Text Prompt Description of the Scene",defaultValue:N,variant:"outlined",onChange:function(t){return P(t.target.value)}})}),Object(E.jsx)(j.a,{item:!0,xs:12,md:2,children:Object(E.jsx)(g.a,{fullWidth:!0,id:"outlined-basic",InputProps:{inputProps:{max:1e4,min:0}},label:"Random seed",defaultValue:z,variant:"outlined",type:"number",onChange:function(t){return V(t.target.value)}})}),Object(E.jsx)(j.a,{item:!0,xs:12,md:3,children:Object(E.jsx)(g.a,{fullWidth:!0,id:"outlined-basic",label:"Server URL",defaultValue:H,variant:"outlined",onChange:function(t){return Y(t.target.value)}})}),Object(E.jsx)(j.a,{item:!0,xs:12,md:12,children:Object(E.jsxs)(v.a,{fullWidth:!0,color:"secondary",variant:"outlined",onClick:function(){var a;if(e.current&&n.current){k(!0);var i=e.current.getMap(),o=n.current.deck,c=i.getCanvas();o.redraw(!0);var s=o.canvas;nt.width=c.width,nt.height=c.height;var u=nt.getContext("2d");u.globalAlpha=1,u.drawImage(c,0,0),u.globalAlpha=1,u.drawImage(s,0,0);var l=nt.toDataURL("image/jpeg");T(l),null===(a=d.current)||void 0===a||a.scrollIntoView({behavior:"smooth"}),nt.toBlob(function(){var e=Object(r.a)(C().mark((function e(n){var a,i;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("image",n,"image.jpg"),a.append("prompt",N),a.append("user_seed",z),a.append("from","frontend"),i={method:"POST",url:H,data:a,responseType:"arraybuffer"},e.next=8,w()(i).then(function(){var e=Object(r.a)(C().mark((function e(n){var r,a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.from(n.data,"base64"),e.next=3,rt(new Blob([r]));case 3:a=e.sent,T(a),k(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){k(!1),console.log(t)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},disabled:G,children:[!G&&"Capture & Render",G&&Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(m.a,{size:14}),Object(E.jsx)(O.a,{children:"Rendering captured view... [can take ~15 seconds]"})]})]})}),Object(E.jsx)(j.a,{item:!0,xs:12,children:Object(E.jsx)(y.a,{variant:"outlined",sx:{variant:"outlined",p:2,flexDirection:"column",display:"flex"},children:Object(E.jsxs)(x.a,{spacing:2,direction:"column",children:[Object(E.jsx)(O.a,{variant:"h5",children:"CityScope Model View"}),Object(E.jsx)(b.a,{sx:{height:"576px",minHeight:"576px",width:"auto",position:"relative"},children:Object(E.jsx)(c.a,{ref:n,viewState:$,onViewStateChange:function(t){var e=t.viewState;return tt(e)},controller:!G&&{touchZoom:!0,touchRotate:!0,keyboard:!1},layers:[new s.a({id:"mesh-layer",data:K.features,loaders:[u.a],mesh:I,getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2,t.properties.height.length>1?t.properties.height[1]>1?t.properties.height[1]/2:1:t.properties.height>1?t.properties.height/2:1]},getColor:function(t){return t.properties.interactive?t.properties.color:[0,0,0,0]},opacity:.75,getOrientation:function(t){return[-180,J.rotation,-90]},getScale:function(t){return[K.properties.header.cellSize/2,t.properties.height.length>1?t.properties.height[1]>1?t.properties.height[1]/2:1:t.properties.height>1?t.properties.height/2:1,K.properties.header.cellSize/2]},updateTriggers:{getScale:K}})],children:Object(E.jsx)(f.c,{ref:e,preserveDrawingBuffer:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:h.e.map.mapStyle.normal})})})]})})}),Object(E.jsx)(j.a,{item:!0,xs:12,children:Object(E.jsx)(y.a,{variant:"outlined",sx:{p:2,display:"flex",flexDirection:"column",height:"auto",width:"auto"},children:Object(E.jsxs)(x.a,{spacing:2,direction:"column",children:[Object(E.jsx)(O.a,{variant:"h5",children:"Captured & Rendered View"}),_&&Object(E.jsx)("div",{ref:d,children:Object(E.jsx)("img",{style:{maxWidth:"100%",maxHeight:"100%",minWidth:"100%",objectFit:"contain",filter:G?"blur(3px)":"none",WebkitFilter:G?"blur(3px)":"none"},src:_,alt:"screenshot"})})]})})})]})})})}}).call(this,n(513).Buffer)},356:function(t,e){},36:function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"e",(function(){return c})),n.d(e,"c",(function(){return s})),n.d(e,"g",(function(){return u})),n.d(e,"f",(function(){return l})),n.d(e,"a",(function(){return d}));var r=n(245),a=n.n(r),i={csjsURL:function(){var t=window.location,e="csjs_local"in a.a.parse(t.search)?"http://localhost:3000/CS_cityscopeJS/":"https://cityscope.media.mit.edu/CS_cityscopeJS/";return console.log("cityScopeJS location: ",e),e}()},o={docsURL:"https://raw.githubusercontent.com/CityScope/CS_cityscopeJS/master/docs/",cityIO:{baseURL:function(){var t=window.location,e="cityio_local"in a.a.parse(t.search)?"http://127.0.0.1:5000/api/":"https://cityio.media.mit.edu/api/";return console.log("cityIO server location: ",e),e}(),ListOfTables:"tables/list/",interval:500,cityIOmodules:[{name:"header",expectUpdate:!1},{name:"GEOGRID",expectUpdate:!1},{name:"ABM2",expectUpdate:!0},{name:"geojson",expectUpdate:!0},{name:"grid",expectUpdate:!1},{name:"access",expectUpdate:!0},{name:"GEOGRIDDATA",expectUpdate:!1},{name:"indicators",expectUpdate:!0},{name:"textual",expectUpdate:!0},{name:"scenarios",expectUpdate:!0},{name:"tui",expectUpdate:!0}]}},c={map:{mapStyle:{sat:"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true",blue:"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true",inverse:"mapbox://styles/relnox/cjlu6w5sc1dy12rmn4kl2zljn?fresh=true",normal:"mapbox://styles/relnox/cl8dv36nv000t14qik9yg4ys6?fresh=true"},layers:{ABM:{endTime:86400,startTime:43200,animationSpeed:10}},initialViewState:{maxZoom:22,zoom:15,pitch:0,bearing:0}}},s={GRID_LAYER_CHECKBOX:{displayName:"CS Grid",cityIOmoduleName:"GEOGRID",initState:!0,initSliderValue:50},ABM_LAYER_CHECKBOX:{displayName:"Animated Trips",cityIOmoduleName:"ABM2",initState:!1,initSliderValue:100},AGGREGATED_TRIPS_LAYER_CHECKBOX:{displayName:"Aggregated Trips",cityIOmoduleName:"ABM2",initState:!1,initSliderValue:100},ACCESS_LAYER_CHECKBOX:{displayName:"Heatmap",cityIOmoduleName:"access",initState:!1,initSliderValue:100},TEXTUAL_LAYER_CHECKBOX:{displayName:"Text",cityIOmoduleName:"text",initState:!1,initSliderValue:100},GEOJSON_LAYER_CHECKBOX:{displayName:"GeoJson",cityIOmoduleName:"geojson",initState:!1,initSliderValue:50},MESH_LAYER_CHECKBOX:{displayName:"Mesh <beta>",cityIOmoduleName:"GEOGRID",initState:!1,initSliderValue:100}},u={ROTATE_CHECKBOX:{displayName:"Rotate Camera",initState:!1,initSliderValue:100},ANIMATION_CHECKBOX:{displayName:"Toggle Animation",initState:!1,initSliderValue:100}},l={RESET_VIEW_BUTTON:{displayName:"Reset View",initState:!1},ORTHO_VIEW_BUTTON:{displayName:"Ortho View",initState:!1},NORTH_VIEW_BUTTON:{displayName:"North View",initState:!1}},d={map:{mapStyle:{sat:"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true",dark:"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true",blue:"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"}},GEOGRIDDATA:{color:[0,0,0],height:[0,50,100],id:0,interactive:"Web",name:"name"},GEOGRID:{features:[],properties:{header:{tableName:"test",cellSize:50,latitude:42.3664655,longitude:-71.0854323,tz:-5,ncols:20,nrows:20,rotation:0,projection:"+proj=lcc +lat_1=42.68333333333333 +lat_2=41.71666666666667 +lat_0=41 +lon_0=-71.5 +x_0=200000 +y_0=750000 +ellps=GRS80 +datum=NAD83 +units=m +no_def"},types:{Office:{LBCS:[{proportion:1,use:{2310:1}}],NAICS:[{proportion:1,use:{5400:1}}],interactive:"Web",color:"#FF5277",height:[0,50,100]},Park:{LBCS:[{proportion:1,use:{7240:1}}],NAICS:null,interactive:"Web",color:"#38C9FF"},Residential:{LBCS:[{proportion:1,use:{1100:1}}],NAICS:null,interactive:"Web",color:"#FFFF33",height:[0,50,100]}}},type:"FeatureCollection"}}},388:function(t,e){},419:function(t,e){},51:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"d",(function(){return u})),n.d(e,"f",(function(){return l})),n.d(e,"e",(function(){return d})),n.d(e,"c",(function(){return p})),n.d(e,"b",(function(){return b}));var r=n(32),a=n(133),i=n.n(a),o=n(36);function c(){c=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(I){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var a=e&&e.prototype instanceof h?e:h,i=Object.create(a.prototype),o=new w(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return C()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var c=y(o,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=l(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,o),i}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(I){return{type:"throw",arg:I}}}t.wrap=u;var d={};function h(){}function f(){}function p(){}var b={};s(b,a,(function(){return this}));var j=Object.getPrototypeOf,O=j&&j(j(E([])));O&&O!==e&&n.call(O,a)&&(b=O);var g=p.prototype=h.prototype=Object.create(b);function v(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function m(t,e){function r(a,i,o,c){var s=l(t[a],t,i);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,c)}),(function(t){r("throw",t,o,c)})):e.resolve(d).then((function(t){u.value=t,o(u)}),(function(t){return r("throw",t,o,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function i(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(i,i):i()}}function y(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,y(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=l(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function E(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}return f.prototype=p,s(g,"constructor",p),s(p,"constructor",f),f.displayName=s(p,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,o,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(m.prototype),s(m.prototype,i,(function(){return this})),t.AsyncIterator=m,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new m(u(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},v(g),s(g,o,"Generator"),s(g,a,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=E,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;S(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}var s=function(){var t=Object(r.a)(c().mark((function t(e){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.a.get(e);case 3:return n=t.sent,t.abrupt("return",n.data);case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}();function u(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}var l=function(t){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/i.test(t)},d=function(t,e,n){var r=o.b.cityIO.baseURL+"table/"+e+n,a={method:"post",url:r,data:t,headers:{"Content-Type":"application/json",Accept:"application/json"}};i()(a).then((function(t){"ok"===t.data.status&&console.log("--\x3e cityIO endpoint ".concat(r," was updated <--"))})).catch((function(t){console.log("ERROR:",t)}))},h=o.b.cityIO.baseURL,f=function(){var t=Object(r.a)(c().mark((function t(e,n){var r,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,n);case 2:return r=t.sent,t.next=5,r.json();case 5:return a=t.sent,t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),p=function(){var t=Object(r.a)(c().mark((function t(e){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f("".concat(h,"table/").concat(e,"/meta/hashes/GEOGRIDDATA/"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),b=function(){var t=Object(r.a)(c().mark((function t(e){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f("".concat(h,"module/").concat(e,"/"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},586:function(t,e,n){"use strict";n.r(e);var r=n(73),a=n.n(r),i=n(8),o=n(0),c=n(682),s=n(699),u=n(31),l=n(163),d=Object(l.b)({name:"cityIOdataState",initialState:{},cityIOisDone:!1,cityIOtableName:"",reducers:{updateCityIOdata:function(t,e){t.cityIOdata=e.payload},toggleCityIOisDone:function(t,e){t.cityIOisDone=e.payload},updateCityIOtableName:function(t,e){t.cityIOtableName=e.payload}}}),h=d.actions,f=h.updateCityIOdata,p=h.toggleCityIOisDone,b=h.updateCityIOtableName,j=d.reducer,O=n(245),g=n.n(O),v={fontFamily:'"Roboto Mono", sans-serif',fontSize:11,fontWeightLight:100,fontWeightRegular:500,fontWeightMedium:700,h1:{fontWeight:700,fontSize:45,letterSpacing:"-1px"},h2:{fontWeight:800,fontSize:29,letterSpacing:"-0.24px"},h3:{fontWeight:700,fontSize:24,letterSpacing:"-0.06px"},h4:{fontWeight:500,fontSize:20,letterSpacing:"-0.06px"},h5:{fontWeight:500,fontSize:16,letterSpacing:"-0.05px"},h6:{fontWeight:500,fontSize:14,letterSpacing:"-0.05px"},overline:{fontWeight:500}},m=n(121),y=Object(m.b)({typography:v,palette:{mode:"dark",primary:{main:"#FFF",light:"#ff5278"},secondary:{main:"#ff5278"},text:{primary:"#fff",secondary:"#ff5278"}},shape:{borderRadius:10},overrides:{MuiOutlinedInput:{notchedOutline:{borderColor:"#ff5278"}}}}),x=n(2),S=n(5),w=n(32),E=n(36),C=n(51),I=n(215),L=n(1);function _(){_=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return E()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var c=m(o,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,o),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=f.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,i,o,c){var s=u(t[a],t,i);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,c)}),(function(t){r("throw",t,o,c)})):e.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function i(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(i,i):i()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(O,"constructor",f),c(f,"constructor",h),h.displayName=c(f,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,o,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,i,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new v(s(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},g(O),c(O,o,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}var T=function(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),t},M=function(t){var e=E.b,n=Object(u.b)(),r=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),a=t.tableName,c=Object(o.useState)(null),s=Object(i.a)(c,2),l=s[0],d=s[1],h=Object(o.useState)({}),b=Object(i.a)(h,2),j=b[0],O=b[1],g=Object(o.useState)([]),v=Object(i.a)(g,2),m=v[0],y=v[1],M="".concat(e.cityIO.baseURL,"table/").concat(a,"/");function A(){return G.apply(this,arguments)}function G(){return(G=Object(w.a)(_().mark((function t(){var n;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(C.a)(M+"meta/id/");case 2:n=t.sent,l!==n&&d(n),setTimeout(A,e.cityIO.interval);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(){return k=Object(w.a)(_().mark((function t(){var i,o,c,s,u,l,d;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("--- starting update ---"),t.next=3,Object(C.a)(M+"meta/hashes/");case 3:return i=t.sent,o=[],c=[],(s=e.cityIO.cityIOmodules.map((function(t){return t.name}))).forEach((function(t){j[t]!==i[t]?(o.push(Object(C.a)("".concat(M).concat(t,"/"))),c.push(t)):o.push(null),y(c)})),t.next=10,Promise.all(o);case 10:u=t.sent,O(i),l=s.reduce((function(t,e,n){return u[n]?(y(T(m,e)),Object(S.a)(Object(S.a)({},t),{},Object(x.a)({},e,u[n]))):t}),r),d=Object(S.a)(Object(S.a)({},l),{},{tableName:a}),n(f(d)),console.log("--- done updating from cityIO ---"),n(p(!0));case 17:case"end":return t.stop()}}),t)}))),k.apply(this,arguments)}return Object(o.useEffect)((function(){var t=setTimeout(A,e.cityIO.interval);return console.log("reading cityIO every "+e.cityIO.interval+"ms"),function(){return clearTimeout(t)}}),[]),Object(o.useEffect)((function(){l&&function(){k.apply(this,arguments)}()}),[l]),Object(L.jsx)(I.a,{loadingModules:m})},A=n(692),G=n(700),k=n(701),R=n(702),D=n(342),N=n(120),P=n(689),B=Object(l.b)({name:"menuState",initialState:{editMenuState:{},typesMenuState:{},layersMenuState:{},viewSettingsMenuState:{},animationMenuState:{toggleAnimationState:!1,animationSpeedSliderValue:10}},reducers:{updateLayersMenuState:function(t,e){t.layersMenuState=e.payload},updateTypesMenuState:function(t,e){t.typesMenuState=e.payload},updateEditMenuState:function(t,e){t.editMenuState=e.payload},updateViewSettingsMenuState:function(t,e){t.viewSettingsMenuState=e.payload},updateAnimationMenuState:function(t,e){t.animationMenuState=e.payload}}}),F=B.actions,z=F.updateLayersMenuState,V=F.updateTypesMenuState,U=F.updateEditMenuState,W=F.updateViewSettingsMenuState,H=(F.updateAnimationMenuState,B.reducer);function Y(){var t=Object(u.b)(),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})).GEOGRID.properties.types,n=Object(o.useState)(),r=Object(i.a)(n,2),a=r[0],c=r[1],s=Object(o.useState)(),l=Object(i.a)(s,2),d=l[0],h=l[1];Object(o.useEffect)((function(){t(V({SELECTED_TYPE:a}))}),[a]);var f=a&&a.LBCS,p=a&&a.NAICS,b=a&&a.description?a.description:null;return Object(L.jsx)(L.Fragment,{children:function(t){var e=[];return Object.keys(t).forEach((function(n,r){var i=t[n].color;"string"!==typeof i&&(i="rgb("+t[n].color[0]+","+t[n].color[1]+","+t[n].color[2]+")"),e.push(Object(L.jsxs)("div",{children:[Object(L.jsx)(A.a,{children:Object(L.jsx)(D.a,{fullWidth:!0,size:"small",variant:"outlined",sx:{"&.MuiButton-text":{color:{col:i}},border:"solid 1px "+i},onClick:function(){return e=t[n],r=n,e=Object(S.a)(Object(S.a)({},e),{},{thisTypeName:r}),void c(e);var e,r},children:Object(L.jsx)(N.a,{color:i,variant:"caption",children:n})},Math.random())},"li_menu_".concat(r)),a&&a.thisTypeName===n&&Object(L.jsx)(A.a,{children:Object(L.jsx)(G.a,{variant:"outlined",sx:{width:"100%"},children:Object(L.jsxs)(k.a,{children:[b&&Object(L.jsx)(N.a,{variant:"caption",children:b}),a&&a.thisTypeName&&a.height&&Object(L.jsxs)("div",{children:[Object(L.jsx)(N.a,{children:"Set Height"}),Object(L.jsx)(P.a,{valueLabelDisplay:"auto",size:"small",onChange:function(t,e){return h((function(t){var n=Object(S.a)({},t),r=[a.height[0],e,a.height[2]];return Object.assign(n,{height:r}),n}))},onChangeCommitted:function(t,e){c(Object(S.a)(Object(S.a)({},a),{},{height:[a.height[0],e,a.height[2]]}))},min:a.height[0],value:d&&d[a]&&d[a].height[1],max:a.height[2]},"li_types_slider_".concat(a.thisTypeName))]},"li_types_div_".concat(r)),f&&Object(L.jsxs)("div",{children:[Object(L.jsx)(N.a,{children:"LBCS"}),Object(L.jsx)(N.a,{variant:"caption",children:JSON.stringify(f,null,"\t")})]}),p&&Object(L.jsxs)("div",{children:[Object(L.jsx)(N.a,{children:"NAICS"}),Object(L.jsx)(N.a,{variant:"caption",children:JSON.stringify(p,null,"\t")})]})]})},"li_types_card_".concat(r))},"li_types_".concat(r))]},"li_types_top_div_".concat(r)))})),Object(L.jsx)(R.a,{sx:{display:"flex",flexDirection:"column",maxHeight:400,overflow:"hidden",overflowY:"scroll"},children:e})}(e)})}var X=n(174),K=n(383),J=n(403);var q=function(){var t=Object(u.b)(),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),n=Object.keys(e),r={},a=Object(o.useState)((function(){for(var t in E.c)r[t]={isOn:E.c[t].initState,slider:E.c[t].initSliderValue};return r})),c=Object(i.a)(a,2),s=c[0],l=c[1];Object(o.useEffect)((function(){t(z(s))}),[s]);var d=Object(o.useState)({}),h=Object(i.a)(d,2),f=h[0],p=h[1],b=[];return Object(L.jsx)(X.a,{container:!0,children:function(){var t=function(t){var e=E.c[t].cityIOmoduleName;n.includes(e)&&b.push(Object(L.jsxs)(X.a,{container:!0,children:[Object(L.jsx)(X.a,{item:!0,xs:4,children:Object(L.jsx)(K.a,{control:Object(L.jsx)(J.a,{checked:s[t]&&s[t].isOn,color:"primary",onChange:function(e){l(Object(S.a)(Object(S.a)({},s),{},Object(x.a)({},t,Object(S.a)(Object(S.a)({},s[t]),{},{isOn:e.target.checked}))))}},"checkbox_"+t),label:Object(L.jsx)(N.a,{variant:"caption",children:E.c[t].displayName},"label_"+t)},"formControl_"+t)},"grid_i_1_"+t),s[t]&&s[t].isOn&&Object(L.jsx)(X.a,{item:!0,xs:8,children:Object(L.jsx)(P.a,{size:"small",valueLabelDisplay:"auto",onChangeCommitted:function(e,n){return function(t,e){p(Object(S.a)(Object(S.a)({},f),{},Object(x.a)({},t,e))),l(Object(S.a)(Object(S.a)({},s),{},Object(x.a)({},t,Object(S.a)(Object(S.a)({},s[t]),{},{slider:e}))))}(t,n)}},"slider_"+t)},"grid_i_2_"+t)]},"grid_con_"+t))};for(var e in E.c)t(e);return b}()})},Q=n(703);var Z=function(){var t=Object(u.b)(),e=Object(o.useState)((function(){var t={};for(var e in E.g)t[e]={isOn:E.g[e].initState,slider:E.g[e].initSliderValue&&E.g[e].initSliderValue};return t})),n=Object(i.a)(e,2),r=n[0],a=n[1];Object(o.useLayoutEffect)((function(){t(W(r))}),[r]);var c=Object(o.useState)({}),s=Object(i.a)(c,2),l=s[0],d=s[1];return Object(L.jsxs)(R.a,{children:[function(t){var e=[],n=function(n){e.push(Object(L.jsx)(D.a,{size:"small",onClick:function(){return function(t){a(Object(S.a)(Object(S.a)({},r),{},{VIEW_CONTROL_BUTTONS:t}))}(n)},children:t[n].displayName},Math.random()))};for(var i in t)n(i);return Object(L.jsx)(Q.a,{color:"primary",children:e})}(E.f),function(t){var e=[],n=function(n){var i=t[n].initSliderValue;e.push(Object(L.jsxs)("div",{children:[Object(L.jsxs)(A.a,{children:[Object(L.jsx)(J.a,{checked:r[n]&&r[n].isOn,name:n,onChange:function(t){return a(Object(S.a)(Object(S.a)({},r),{},Object(x.a)({},n,Object(S.a)(Object(S.a)({},r[n]),{},{isOn:t.target.checked}))))}},"viewSettingCheckBox_"+n),Object(L.jsx)(N.a,{variant:"caption",children:t[n].displayName},"viewSettingCaption_"+n)]},"viewSettingListItem_"+n),i&&r[n]&&r[n].isOn&&Object(L.jsx)(A.a,{children:Object(L.jsx)(P.a,{size:"small",valueLabelDisplay:"auto",onChangeCommitted:function(t,e){return function(t,e){d(Object(S.a)(Object(S.a)({},l),{},Object(x.a)({},t,e))),a(Object(S.a)(Object(S.a)({},r),{},Object(x.a)({},t,Object(S.a)(Object(S.a)({},r[t]),{},{slider:e}))))}(n,e)}},"viewSettingSlider_"+n)},"viewSettingListItemSlider_"+n)]},"viewSettingDiv_"+n))};for(var i in t)n(i);return e}(E.g)]})},$=n(18),tt=n(384),et=n(385),nt=n(690),rt=n(668),at=n(671),it=n(704),ot=n(705),ct=n(246),st=n(706),ut=n(283),lt=n.n(ut);function dt(){dt=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return E()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var c=m(o,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,o),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=f.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,i,o,c){var s=u(t[a],t,i);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,c)}),(function(t){r("throw",t,o,c)})):e.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function i(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(i,i):i()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(O,"constructor",f),c(f,"constructor",h),h.displayName=c(f,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,o,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,i,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new v(s(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},g(O),c(O,o,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function ht(){var t=Object(o.useState)([]),e=Object(i.a)(t,2),n=e[0],r=e[1],a=Object(o.useState)(),c=Object(i.a)(a,2),s=c[0],l=c[1],d=Object(o.useState)(!1),h=Object(i.a)(d,2),f=h[0],p=h[1],b=Object(o.useState)(!1),j=Object(i.a)(b,2),O=j[0],g=j[1],v=Object(o.useState)({name:"",description:""}),m=Object(i.a)(v,2),y=m[0],x=m[1],E=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),I=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName})),_=function(){g(!1),p(!1)},T=function(){var t=Object(w.a)(dt().mark((function t(){return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Object(C.b)(s.hash).then((function(t){Object(C.e)(t,I,"/GEOGRIDDATA/")})).finally((function(){_()}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),M=function(){return E.scenarios.map((function(t,e){return Object(L.jsxs)(A.a,{children:[Object(L.jsx)(tt.a,{arrow:!0,placement:"right",title:t.description||"No description",children:Object(L.jsx)(D.a,{fullWidth:!0,size:"small",variant:"outlined",onClick:function(){return function(t){l(t),g(!0)}(t)},children:Object(L.jsxs)(R.a,{children:[Object(L.jsx)(A.a,{children:Object(L.jsx)(N.a,{children:t.name.substring(0,12)+"..."})}),Object(L.jsx)(A.a,{children:Object(L.jsx)(N.a,{variant:"caption",children:t.description.substring(0,20)+"..."})})]})},"scenario_button_"+e)},"scenario_tt_"+e),Object(L.jsx)(et.a,{onClick:function(e){!function(t){var e=Object($.a)(E.scenarios),n=e.filter((function(e){return e.hash===t.hash})),r=e.indexOf(n[0]);-1!==r&&e.splice(r,1),Object(C.e)(e,I,"/scenarios/")}(t)},"aria-label":"delete",size:"small",children:Object(L.jsx)(lt.a,{color:"primary",fontSize:"inherit"},"scenario_delicon_"+e)},"scenario_ib_"+e)]},"scenario_grid_item_".concat(e))}))};return Object(o.useEffect)((function(){if(E.scenarios){var t=M();r(t)}}),[E]),Object(L.jsxs)(X.a,{sx:{flexGrow:1},container:!0,children:[Object(L.jsx)(nt.a,{sx:{width:"100%"},badgeContent:E.scenarios&&E.scenarios.length||0,color:"primary",children:Object(L.jsx)(D.a,{fullWidth:!0,variant:"outlined",onClick:function(){return p(!0)},children:Object(L.jsx)(N.a,{children:"Save This Scenario"})},"save_state_button")}),Object(L.jsx)(R.a,{children:n}),Object(L.jsxs)(rt.a,{open:f,onClose:_,children:[Object(L.jsx)(at.a,{id:"save-dialog-title",children:"Save this Scenario"}),Object(L.jsxs)(it.a,{children:[Object(L.jsx)(ot.a,{id:"alert-dialog-description",children:"Give your scenario a name and a description to help you remember what it is about."}),Object(L.jsxs)(R.a,{children:[Object(L.jsx)(A.a,{children:Object(L.jsx)(ct.a,{id:"name-basic",label:"Scenario Name",variant:"outlined",fullWidth:!0,onChange:function(t){return x(Object(S.a)(Object(S.a)({},y),{},{name:t.target.value}))}})}),Object(L.jsx)(A.a,{children:Object(L.jsx)(ct.a,{id:"desc-basic",label:"Description (optional)",fullWidth:!0,variant:"outlined",onChange:function(t){return x(Object(S.a)(Object(S.a)({},y),{},{description:t.target.value}))}})})]})]}),Object(L.jsxs)(st.a,{children:[Object(L.jsx)(D.a,{onClick:_,children:"Cancel"}),Object(L.jsx)(D.a,{onClick:function(){_(),Object(C.c)(I).then((function(t){var e={name:y.name||"".concat(t),hash:t,description:y.description||"no description for ".concat(t," yet.")},n=E.scenarios?Object($.a)(E.scenarios):[];n.push(e),Object(C.e)(n,I,"/scenarios/")}))},autoFocus:!0,children:"Save"})]})]}),Object(L.jsxs)(rt.a,{open:O,onClose:_,children:[Object(L.jsx)(at.a,{id:"alert-dialog-title",children:"Revert to saved scenario?"}),Object(L.jsx)(it.a,{children:Object(L.jsx)(ot.a,{id:"alert-dialog-description",children:"You can revert to this saved scenario by clicking the button below. Reverting will delete all changes made since the last commit."})}),Object(L.jsxs)(st.a,{children:[Object(L.jsx)(D.a,{onClick:_,children:"Cancel"}),Object(L.jsx)(D.a,{onClick:T,autoFocus:!0,children:"Revert"})]})]})]})}var ft=n(253),pt=n(695),bt=n(171),jt=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)-1;function Ot(t){var e=t.children,n=t.direction,r=t.width,a=Math.floor(jt/4),c=Object(o.useState)(r||a),s=Object(i.a)(c,2),u=s[0],l=s[1],d=function t(e){document.removeEventListener("mouseup",t,!0),document.removeEventListener("mousemove",h,!0),e.preventDefault()},h=Object(o.useCallback)((function(t){var e=null;(e="right"===n?document.body.offsetLeft+document.body.offsetWidth-t.clientX+20:document.body.offsetLeft+t.clientX+20)>50&&e<jt&&l(e)}),[]);return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(ft.a,{onMouseDown:function(t){return function(t){document.addEventListener("mouseup",d,!0),document.addEventListener("mousemove",h,!0),t.preventDefault()}(t)},sx:{width:"".concat(5,"px"),padding:"5px 0 0",position:"fixed",height:"1000vh",left:"left"===n?u+"px":void 0,right:"right"===n?u+"px":void 0,zIndex:1,cursor:"ew-resize",backgroundColor:"gray"}}),Object(L.jsx)(pt.a,{anchor:n,open:!0,variant:"persistent",ModalProps:{keepMounted:!0},PaperProps:{style:{width:u}},sx:{display:"flex",flexDirection:"column"},children:Object(L.jsx)(bt.a,{children:e})})]})}var gt=n(345),vt=n.n(gt),mt=n(287),yt=n.n(mt);function xt(){var t=Object(u.b)(),e=Object(o.useState)({EDIT_BUTTON:!1}),n=Object(i.a)(e,2),r=n[0],a=n[1];return Object(o.useEffect)((function(){t(U(r))}),[r]),Object(L.jsx)(D.a,{fullWidth:!0,id:"EDIT_BUTTON",variant:"outlined",endIcon:r.EDIT_BUTTON?Object(L.jsx)(yt.a,{}):Object(L.jsx)(vt.a,{}),onClick:function(t){return e=t,void a(Object(S.a)(Object(S.a)({},r),{},Object(x.a)({},e.currentTarget.id,!r[e.currentTarget.id])));var e},children:Object(L.jsx)(N.a,{children:r.EDIT_BUTTON?"submit edits":"start editing"})})}var St=function(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(N.a,{gutterBottom:!0,children:"CityScope"}),Object(L.jsx)(N.a,{variant:"h3",children:t})]})};var wt=function(){var t=[Object(L.jsx)(St,{}),Object(L.jsx)(xt,{}),Object(L.jsx)(Y,{}),Object(L.jsx)(ht,{}),Object(L.jsx)(q,{}),Object(L.jsx)(Z,{})],e=function(){var e=[];return t.forEach((function(t,n){e.push(Object(L.jsx)(A.a,{children:Object(L.jsx)(G.a,{variant:"outlined",sx:{width:"100%"},children:Object(L.jsx)(k.a,{children:t})})},n))})),e};return Object(L.jsx)(Ot,{direction:"left",width:300,children:Object(L.jsx)(R.a,{children:Object(L.jsx)(e,{})})})},Et=n(11),Ct=n(417),It=n.n(Ct),Lt=function(t){if(!t.mousePos||!t.hoveredCells)return null;var e=t.selectedType,n=t.hoveredCells.object.properties.interactive,r=t.mousePos,a=t.divSize,i=e.color;Object(C.f)(i)&&(i=Object(C.d)(i));var o="rgb("+i[0]+","+i[1]+","+i[2]+")",c="rgba("+i[0]+","+i[1]+","+i[2]+",0.6)",s=r.clientX-a/2,u=r.clientY-a/2,l=n?e.name:": Not-interactive";return Object(L.jsx)("div",{style:{border:"2px solid",backgroundColor:t.mouseDown?c:"rgba(0,0,0,0)",borderColor:o,color:o,borderRadius:"15%",position:"fixed",zIndex:10,pointerEvents:"none",width:a,height:a,left:s,top:u,fontFamily:"Roboto Mono"},children:Object(L.jsxs)("div",{style:{position:"relative",left:a+10,fontSize:"0.8em"},children:[!n&&Object(L.jsx)(It.a,{}),l]})})},_t=function(t){if(!t.mousePos)return null;var e=t.mousePos,n=t.hoveredObj;return Object(L.jsxs)("div",{style:{borderRadius:"10%",position:"fixed",pointerEvents:"none",backgroundColor:"rgba(0,0,0,0.5)",padding:"1vw",color:"rgba(255,255,255,0.9)",zIndex:10,left:e.clientX,top:e.clientY},children:[Object(L.jsxs)(N.a,{children:["Type: ",n.object.properties.name]}),Object(L.jsxs)(N.a,{children:["Height: ",n.object.properties.height]}),Object(L.jsxs)(N.a,{children:["ID: ",n.object.properties.id]})]})};function Tt(t){var e=t.editOn,n=t.mousePos,r=t.selectedType,a=t.pickingRadius,i=t.mouseDown,o=t.hoveredObj,c=function(){return e&&r&&Object.keys(r).length&&o?Object(L.jsx)(Lt,{mousePos:n,selectedType:r,divSize:a,mouseDown:i,hoveredCells:o}):o?Object(L.jsx)(_t,{mousePos:n,hoveredObj:o}):null};return Object(L.jsx)(c,{})}var Mt=n(131),At=n(610),Gt=(n(234),n(685));function kt(t){var e=t.data,n=t.opacity,r=e.access&&e.access.features;return new Gt.a({id:"ACCESS",colorRange:[[233,62,58],[237,104,60],[243,144,63],[253,199,12],[255,243,59]],threshold:.5,data:r&&r,getPosition:function(t){return t.geometry.coordinates},getWeight:function(t){return t.properties[Math.floor(100*n)%e.access.properties.length]},updateTriggers:{getWeight:n}})}var Rt=n(358);function Dt(t){var e=t.data,n=t.ABMmode,r=t.opacity;if(e.ABM2)return new Rt.a({id:"AGGREGATED_TRIPS",shadowEnabled:!1,data:e.ABM2.trips,getPath:function(t){return t.path},getColor:function(t){return Object(C.d)(e.ABM2.attr.mode[t.mode].color)},opacity:r,getWidth:5,updateTriggers:{getColor:n},transitions:{getColor:500}})}var Nt=n(676);function Pt(t){var e,n=t.data,r=t.ABMmode,a=t.zoomLevel,i=t.time,o=t.opacity;if(n.ABM2)return new Nt.a({opacity:o,id:"ABM",data:n.ABM2.trips,getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},getColor:function(t){return Object(C.d)(n.ABM2.attr.mode[t.mode].color)},shadowEnabled:!1,getWidth:1,widthScale:(e=a,e>15&&e<25?3:e<15&&e>10?12:30),trailLength:500,currentTime:i,updateTriggers:{getColor:r},transitions:{getColor:500}})}var Bt=n(160),Ft=n(435);function zt(t){var e=t.data,n=t.coordinates,r=t.opacity;if(e&&e.text){var a=[];return e.text.forEach((function(t){a.push({coordinates:[n.features[t.id].geometry.coordinates[0][0][0],n.features[t.id].geometry.coordinates[0][0][1],100],info:t.info})})),new Ft.a({opacity:r,id:"text-layer",data:a,pickable:!0,getPosition:function(t){return t.coordinates},getText:function(t){return t.info},getColor:[255,255,255],getSize:30,getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"center"})}}var Vt=n(611);function Ut(t){var e=t.data,n=t.opacity;if(e.geojson)return new Vt.a({id:"GeojsonLayer",data:e.geojson,opacity:n,pickable:!0,wireframe:!1,stroked:!0,filled:!0,extruded:!0,lineWidthScale:1,getFillColor:function(t){return Object(C.d)(t.properties.fill)},getLineColor:function(t){return Object(C.d)(t.properties.stroke)},lineWidthMinPixels:2,getElevation:function(t){return t.properties.height},updateTriggers:{getFillColor:e,getElevation:e},transitions:{getFillColor:500,getElevation:500}})}var Wt=n(614),Ht=n(304);function Yt(t){var e=t.data,n=t.opacity;if(e&&e.features)return new Wt.a({id:"mesh-layer",data:e.features,loaders:[Ht.a],mesh:"./obj/model.obj",getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2]},getColor:function(t){return[255,255,255,255]},getOrientation:function(t){return[-180,90*Math.ceil(4*Math.random()),-90]},getScale:function(t){return t.properties.height>0?[e.properties.header.cellSize/2,n*t.properties.height,e.properties.header.cellSize/2]:[0,0,0]},updateTriggers:{getScale:n}})}function Xt(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(u.c)((function(t){return t.menuState})),n=Object(o.useState)(!1),r=Object(i.a)(n,2),a=r[0],c=r[1],s=Object(o.useState)(),l=Object(i.a)(s,2),d=l[0],h=l[1],f=Object(o.useState)(E.e.map.initialViewState),p=Object(i.a)(f,2),b=p[0],j=p[1],O=Object(o.useState)(),g=Object(i.a)(O,2),v=g[0],m=g[1],y=Object(o.useState)(),x=Object(i.a)(y,2),w=x[0],I=x[1],_=Object(o.useState)(),T=Object(i.a)(_,2),M=T[0],A=T[1],G=Object(o.useState)(),k=Object(i.a)(G,2),R=k[0],D=k[1],N=Object(o.useState)(),P=Object(i.a)(N,2),B=P[0],F=P[1],z=Object(o.useRef)(),V=e.editMenuState.EDIT_BUTTON,U=e.typesMenuState.SELECTED_TYPE,W=e.layersMenuState,H=e.viewSettingsMenuState.VIEW_CONTROL_BUTTONS,Y=e.viewSettingsMenuState.ANIMATION_CHECKBOX,X=e.viewSettingsMenuState.ROTATE_CHECKBOX,K=Object(o.useState)(0),J=Object(i.a)(K,2),q=J[0],Q=J[1],Z=Object(o.useState)({}),$=Object(i.a)(Z,1)[0],tt=function t(){Y&&Y.isOn&&(Q((function(t){return t>E.e.map.layers.ABM.endTime?E.e.map.layers.ABM.startTime:t+Y.slider})),$.id=window.requestAnimationFrame(t))};!Y||Y.isOn||window.cancelAnimationFrame($.id),Object(o.useEffect)((function(){return $.id=window.requestAnimationFrame(tt),function(){window.cancelAnimationFrame($.id)}}),[Y]),Object(o.useEffect)((function(){if(X&&X.isOn){var t=b.bearing||0;t<360?t+=q/1e8*X.slider:t=0,j(Object(S.a)(Object(S.a)({},b),{},{bearing:t}))}}),[X,q]);var et=function(e){var n=t.GEOGRID.features[t.GEOGRID.features.length-1].geometry.coordinates[0][0],r=t.GEOGRID.features[0].geometry.coordinates[0][0],a=[(r[0]+n[0])/2,(r[1]+n[1])/2],i=t.GEOGRID.properties.header;j(Object(S.a)(Object(S.a)({},b),{},{longitude:a[0],latitude:a[1],zoom:"RESET_VIEW_BUTTON"===e?15:b.zoom,pitch:"RESET_VIEW_BUTTON"===e?0:45,bearing:"NORTH_VIEW_BUTTON"===e?0:360-i.rotation,orthographic:"ORTHO_VIEW_BUTTON"===e}))};Object(o.useEffect)((function(){et(H)}),[H]),Object(o.useEffect)((function(){document.addEventListener("contextmenu",(function(t){return t.preventDefault()})),et()}),[]),Object(o.useEffect)((function(){F(Object(Bt.b)(t))}),[t.GEOGRIDDATA]),Object(o.useEffect)((function(){if(!V&&B){for(var e=[],n=0;n<B.features.length;n++)e[n]=B.features[n].properties;Object(C.e)(e,t.tableName,"/GEOGRIDDATA/")}}),[V]);var nt={ABM:Pt({data:t,ABMmode:0,zoomLevel:b.zoom,time:q,opacity:W&&W.ABM_LAYER_CHECKBOX&&.01*W.ABM_LAYER_CHECKBOX.slider}),AGGREGATED_TRIPS:Dt({data:t,ABMmode:0,opacity:W&&W.AGGREGATED_TRIPS_LAYER_CHECKBOX&&.01*W.AGGREGATED_TRIPS_LAYER_CHECKBOX.slider}),GRID:Object(Bt.a)({data:B,editOn:V,state:{selectedType:U,keyDownState:v,selectedCellsState:d,pickingRadius:40,opacity:W&&W.GRID_LAYER_CHECKBOX&&.01*W.GRID_LAYER_CHECKBOX.slider},updaters:{setSelectedCellsState:h,setDraggingWhileEditing:c,setHoveredObj:D},deckGLref:z}),ACCESS:kt({data:t,opacity:W&&W.ACCESS_LAYER_CHECKBOX&&.01*W.ACCESS_LAYER_CHECKBOX.slider}),TEXTUAL:zt({data:t,coordinates:B&&B,opacity:W&&W.TEXTUAL_LAYER_CHECKBOX&&.01*W.TEXTUAL_LAYER_CHECKBOX.slider}),GEOJSON:Ut({data:t,opacity:W&&W.GEOJSON_LAYER_CHECKBOX&&.01*W.GEOJSON_LAYER_CHECKBOX.slider}),MESH:Yt({data:B,opacity:W&&W.MESH_LAYER_CHECKBOX&&.01*W.MESH_LAYER_CHECKBOX.slider})},rt=["GRID","TEXTUAL","MESH","GEOJSON","ACCESS","AGGREGATED_TRIPS","ABM"];return Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)("div",{onKeyDown:function(t){m(t.nativeEvent.key)},onKeyUp:function(){return m(null)},onMouseMove:function(t){return I(t.nativeEvent)},onMouseUp:function(){return A(!1)},onMouseDown:function(){return A(!0)},children:[Object(L.jsx)(Tt,{editOn:V,mousePos:w,selectedType:U,pickingRadius:40,mouseDown:M,hoveredObj:R}),Object(L.jsx)(At.a,{ref:z,viewState:b,onViewStateChange:function(t){var e=t.viewState;e.orthographic="ORTHO_VIEW_BUTTON"===H,j(e)},layers:function(){var t,e=[],n=Object(Et.a)(rt);try{for(n.s();!(t=n.n()).done;){var r=t.value;W&&W[r+"_LAYER_CHECKBOX"]&&W[r+"_LAYER_CHECKBOX"].isOn&&e.push(nt[r])}}catch(a){n.e(a)}finally{n.f()}return e}(),controller:{touchZoom:!0,touchRotate:!0,dragPan:!a,dragRotate:!a,keyboard:!1},children:Object(L.jsx)(Mt.c,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:E.e.map.mapStyle.sat,preventStyleDiffing:!0})})]})})}var Kt=n(52),Jt=n(220),qt={scales:{r:{angleLines:{color:"#696969"},suggestedMin:0,suggestedMax:1,grid:{color:"#696969",circular:!0},pointLabels:{color:"#C0C0C0"},ticks:{color:"#696969"}}}},Qt={scales:{r:{angleLines:{color:"#363636"},grid:{color:"#363636",circular:!0},pointLabels:{color:"#363636"},ticks:{color:"#363636"}}}},Zt={labels:[null,null,null],datasets:[{label:"No indicator data...",data:[null,null,null],backgroundColor:"#363636",borderColor:"#363636",borderWidth:1}]};function $t(){Kt.f.register(Kt.q,Kt.n,Kt.k,Kt.h,Kt.t,Kt.i);var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(o.useState)(),n=Object(i.a)(e,2),r=n[0],a=n[1];return Object(o.useEffect)((function(){if(t.indicators){var e=function(t){for(var e={labels:[],datasets:[{label:"Project Values",data:[],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1},{label:"Reference Values",data:[],backgroundColor:"rgba(0, 33, 132, 0.2)",borderColor:"rgba(0, 99, 255, 1)",borderWidth:1}]},n=0;n<t.length;n++)"radar"===t[n].viz_type&&(e.labels.push(t[n].name),e.datasets[0].data.push(t[n].value),e.datasets[1].data.push(t[n].ref_value));return e}(t.indicators);a(e)}else a(Zt)}),[t]),Object(L.jsx)(L.Fragment,{children:r&&Object(L.jsx)(Jt.c,{data:r,options:t.indicators?qt:Qt})})}Kt.f.register(Kt.e,Kt.l,Kt.c,Kt.s,Kt.t,Kt.i);var te={maintainAspectRatio:!0,aspectRatio:1,scales:{r:{angleLines:{color:"#696969"},grid:{color:"#696969",circular:!0},pointLabels:{color:"#C0C0C0"},ticks:{color:"#696969"}}},responsive:!0},ee={labels:["no data..."],datasets:[{label:"No indicator data...",data:[0],backgroundColor:"#696969"}]};function ne(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(o.useState)(),n=Object(i.a)(e,2),r=n[0],a=n[1];Object(o.useEffect)((function(){if(t.indicators){var e=c(t.indicators);a(e)}else a(ee)}),[t]);var c=function(t){for(var e={labels:[],datasets:[{label:"Chart Data",data:[],backgroundColor:"rgba(255, 99, 132, 0.3)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]},n=0;n<t.length;n++)"bar"===t[n].viz_type&&(e.labels.push(t[n].name),e.datasets[0].data.push(t[n].value));return e};return Object(L.jsx)(L.Fragment,{children:r&&Object(L.jsx)(Jt.a,{options:te,data:r||ee})})}function re(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=Object(o.useState)({labels:[],datasets:[]}),n=Object(i.a)(e,2),r=n[0],a=n[1];Kt.f.register(Kt.a,Kt.t,Kt.i);var c=t.GEOGRIDDATA;return Object(o.useEffect)((function(){t.GEOGRID.properties&&function(){var t={labels:[],datasets:[{label:"Area Calculation",data:[],backgroundColor:[],borderColor:[],borderWidth:1}]};c.forEach((function(e){var n=e.name;if(n&&"None"!==n&&""!==n||(n="Unknown type..."),t.labels.includes(n)){var r=t.labels.indexOf(n);t.datasets[0].data[r]=(e.height&&e.height,t.datasets[0].data[r]+1)}else t.labels.push(n),t.datasets[0].data.push(0),t.datasets[0].backgroundColor.push("rgba(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],", 0.2)")),t.datasets[0].borderColor.push("rgba(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],", 0.8)"))})),a(t)}()}),[t]),Object(L.jsx)(L.Fragment,{children:c&&Object(L.jsx)(Jt.b,{data:r})})}var ae=n(298),ie=n(707),oe=n(708),ce=n(678),se=n(389),ue=n(677);function le(t){var e=t.children,n=t.variant,r=t.title,a=t.subheader,c=Object(o.useState)(!0),s=Object(i.a)(c,2),u=s[0],l=s[1];return Object(L.jsx)(L.Fragment,{children:Object(L.jsx)(bt.a,{children:Object(L.jsx)(G.a,{variant:n||"outlined",children:Object(L.jsxs)(k.a,{children:[Object(L.jsx)(ie.a,{title:r||"",subheader:a||""}),Object(L.jsx)(oe.a,{children:Object(L.jsx)(X.a,{container:!0,sx:{justifyContent:"center"},children:Object(L.jsx)(et.a,{onClick:function(){return l(!u)},children:Object(L.jsx)(ue.a,{})})})}),Object(L.jsx)(ce.a,{variant:"middle"}),Object(L.jsx)(se.a,{in:u,children:e})]})})})})}var de=function(){return Object(L.jsx)(Ot,{direction:"right",width:window.innerWidth/3,children:Object(L.jsx)(ft.a,{p:2,children:Object(L.jsxs)(X.a,{container:!0,spacing:1,children:[Object(L.jsx)(X.a,{item:!0,xs:12,md:12,lg:12,xl:12,children:Object(L.jsx)(le,{variant:"outlined",title:"Radar Chart",subheader:"Metrics and KPIs",children:Object(L.jsx)($t,{})})}),Object(L.jsx)(X.a,{item:!0,xs:12,md:12,lg:6,xl:6,children:Object(L.jsx)(le,{variant:"outlined",title:"Land-use",subheader:"Distribution of Land-use in the Grid",children:Object(L.jsx)(re,{})})}),Object(L.jsx)(X.a,{item:!0,xs:12,md:12,lg:6,xl:6,children:Object(L.jsx)(le,{variant:"outlined",title:"Bar Chart",subheader:"Metrics and KPIs",children:Object(L.jsx)(ne,{})})}),Object(L.jsx)(X.a,{item:!0,xs:12,md:12,lg:12,xl:12,children:Object(L.jsx)(le,{variant:"outlined",title:"DeepScope",subheader:"Distribution of Land-use in the Grid",children:Object(L.jsx)(ae.a,{})})})]})})})};function he(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(L.jsxs)(L.Fragment,{children:[!t&&Object(L.jsx)(I.a,{loadingModules:[e]}),e&&Object(L.jsx)(M,{tableName:e}),t&&Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(Xt,{}),Object(L.jsx)(wt,{}),Object(L.jsx)(de,{})]})]})}var fe=n(341),pe=n(12);function be(){var t=Object(o.useState)(0),e=Object(i.a)(t,2),n=e[0],r=e[1],a=Object(pe.a)(fe.a)((function(t){t.theme;return{height:10}}));return Object(o.useEffect)((function(){var t=setInterval((function(){r((function(t){if(100===t)return 0;var e=10*Math.random();return Math.min(t+e,100)}))}),500);return function(){clearInterval(t)}}),[]),Object(L.jsx)(ft.a,{sx:{width:"100%",position:"fixed",bottom:"0px"},children:Object(L.jsx)(a,{variant:"determinate",value:n})})}var je=n(133),Oe=n.n(je);function ge(){ge=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(C){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a=e&&e.prototype instanceof d?e:d,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return E()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var c=m(o,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,o),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(C){return{type:"throw",arg:C}}}t.wrap=s;var l={};function d(){}function h(){}function f(){}var p={};c(p,a,(function(){return this}));var b=Object.getPrototypeOf,j=b&&b(b(w([])));j&&j!==e&&n.call(j,a)&&(p=j);var O=f.prototype=d.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function v(t,e){function r(a,i,o,c){var s=u(t[a],t,i);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,c)}),(function(t){r("throw",t,o,c)})):e.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,c)}))}c(s.arg)}var a;this._invoke=function(t,n){function i(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(i,i):i()}}function m(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,m(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function w(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=f,c(O,"constructor",f),c(f,"constructor",h),h.displayName=c(f,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,o,"GeneratorFunction")),t.prototype=Object.create(O),t},t.awrap=function(t){return{__await:t}},g(v.prototype),c(v.prototype,i,(function(){return this})),t.AsyncIterator=v,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new v(s(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},g(O),c(O,o,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=w,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:w(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}function ve(t){var e=t.getTablesList,n=Object(o.useState)([]),r=Object(i.a)(n,2),a=r[0],c=r[1],s=Object(o.useState)(!0),u=Object(i.a)(s,2),l=u[0],d=u[1];Object(o.useEffect)((function(){a&&e(a)}),[a]);var h=function(){var t=Object(w.a)(ge().mark((function t(){var e,n,r;return ge().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=E.b.cityIO.baseURL+E.b.cityIO.ListOfTables,t.next=3,Oe.a.get(e);case 3:n=t.sent,r=n.data.map(function(){var t=Object(w.a)(ge().mark((function t(e){var n;return ge().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(E.b.cityIO.baseURL,"table/").concat(e,"/"),t.abrupt("return",Oe.a.get("".concat(n,"GEOGRID/properties/header/")).then((function(t){return c((function(r){return[].concat(Object($.a)(r),[{tableURL:n,tableName:e,tableHeader:t.data}])}))})).catch((function(t){return console.log(t.toString())})));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Promise.all(r).then((function(){return d(!1),a}));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(o.useEffect)((function(){h()}),[]),Object(L.jsx)(L.Fragment,{children:l&&Object(L.jsx)(be,{})})}var me=n(691),ye=n(696);function xe(t){var e=t.clicked,n=E.d.csjsURL+"?cityscope=",r=E.d.csjsURL+"?projection=",a=Object(o.useState)(!1),c=Object(i.a)(a,2),s=c[0],u=c[1];Object(o.useEffect)((function(){u(!0)}),[e]);var l=function(){u(!1)};return Object(L.jsxs)(rt.a,{open:s,onClose:l,"aria-labelledby":"table-select-dialog-title","aria-describedby":"table-select-dialog-description",children:[Object(L.jsxs)(at.a,{id:"table-select-dialog-title",children:["CityScope ",e.tableName]}),Object(L.jsx)(it.a,{children:Object(L.jsx)(ot.a,{id:"table-select-dialog-description",children:Object(L.jsxs)(N.a,{component:"span",children:[Object(L.jsx)(ye.a,{href:n+e.tableName.toLowerCase(),children:"Go to project"}),", ",Object(L.jsx)(ye.a,{href:r+e.tableName.toLowerCase(),children:"project this table to TUI"})," ","or"," ",Object(L.jsx)(ye.a,{target:"blank",href:e.tableURL,children:"view raw data on cityIO."})]})})}),Object(L.jsx)(st.a,{children:Object(L.jsx)(D.a,{onClick:l,children:"(x) Close"})})]})}function Se(t){var e=t.tablesList,n=Object(o.useState)(null),r=Object(i.a)(n,2),a=r[0],c=r[1],s={options:e,getOptionLabel:function(t){return t.tableName}};return Object(L.jsxs)(L.Fragment,{children:[a&&Object(L.jsx)(xe,{clicked:a}),Object(L.jsx)(me.a,Object(S.a)(Object(S.a)({},s),{},{disablePortal:!0,id:"combo-box-demo",options:e,sx:{width:300},renderInput:function(t){return Object(L.jsx)(ct.a,Object(S.a)(Object(S.a)({},t),{},{label:"Search CityScope Project..."}))},onChange:function(t,e){c(e)}}))]})}var we=n(426),Ee=n.n(we),Ce=n(34),Ie=n(709),Le=n(683),_e=n(680),Te=n(693),Me=n(698),Ae=n(307),Ge=n.p+"static/media/legoio.148c5ab6.png";function ke(t){var e=Object(o.useState)([]),n=Object(i.a)(e,2),r=n[0],a=n[1],c=Object(o.useState)(),s=Object(i.a)(c,2),u=s[0],l=s[1],d=Object(o.useState)(),h=Object(i.a)(d,2),f=h[0],p=h[1],b={longitude:-71.060929,latitude:42.3545259,zoom:1,pitch:0,bearing:0,zHeight:2e6},j=Object(o.useState)(b),O=Object(i.a)(j,2),g=O[0],v=O[1],m=Object(o.useState)(g),y=Object(i.a)(m,2),x=y[0],S=y[1],w=!1;Object(o.useEffect)((function(){p(b.zoom),document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()}))}),[b.zoom]),Object(o.useEffect)((function(){var e=[];t.cityIOdata.forEach((function(t,n){e.push({tableURL:t.tableURL,tableName:t.tableName,index:n,tableHeader:t.tableHeader,coord:{from:[t.tableHeader.longitude,t.tableHeader.latitude],to:[t.tableHeader.longitude+n/10,t.tableHeader.latitude+n/10,b.zHeight]}})})),a(e)}),[t,b.zHeight]);var E=[new Le.a({data:"https://basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,tileSize:96,renderSubLayers:function(t){var e=t.tile.bbox,n=e.west,r=e.south,a=e.east,i=e.north;return new Te.a(t,{data:null,image:t.data,_imageCoordinateSystem:Ce.a.CARTESIAN,bounds:[n,r,a,i]})}}),new Me.a({id:"LineLayer",data:r,pickable:!0,getWidth:f<2?.5:0,getSourcePosition:function(t){return t.coord.from},getTargetPosition:function(t){return t.coord.to},getColor:function(t){return[255,82,120]}}),new Ft.a({id:"text-layer",data:r,pickable:!0,getPosition:function(t){return t.coord.to},getText:function(t){return t.tableName},getColor:[255,82,120],getSize:f<2?0:10,getAngle:0,getPixelOffset:[10,5],getTextAnchor:"start",getAlignmentBaseline:"center"}),new Ae.a({id:"icon-layer",data:r,pickable:!0,iconAtlas:Ge,onClick:function(t){S({longitude:t.object.coord.to[0],latitude:t.object.coord.to[1],zoom:3,pitch:0,bearing:0,transitionDuration:1e3,transitionInterpolator:new _e.a}),l(t)},iconMapping:{marker:{x:0,y:0,width:768,height:768,mask:!1}},getIcon:function(t){return"marker"},sizeScale:1,getSize:f<5?20:10,getPosition:function(t){return[t.coord.to[0],t.coord.to[1],b.zHeight]}})];return Object(L.jsxs)(L.Fragment,{children:[u&&u.object&&Object(L.jsx)(xe,{clicked:u.object}),Object(L.jsx)(At.a,{views:new Ie.a,onHover:function(t){var e=t.object;return w=Boolean(e)},getCursor:function(t){return t.isDragging?"grabbing":w?"crosshair":"grab"},layers:E,controller:!0,initialViewState:x,onViewportChange:v,onViewStateChange:function(t){return p(t.viewState.zoom)},ContextProvider:Mt.b.Provider})]})}function Re(){var t=Object(o.useState)([]),e=Object(i.a)(t,2),n=e[0],r=e[1];return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(ke,{cityIOdata:n}),Object(L.jsxs)(ft.a,{sx:{width:"100%",padding:5},children:[Object(L.jsx)(ve,{getTablesList:r}),Object(L.jsxs)(X.a,{container:!0,spacing:2,children:[Object(L.jsx)(X.a,{item:!0,xs:12,children:Object(L.jsx)(Se,{tablesList:n})}),Object(L.jsxs)(X.a,{item:!0,xs:12,lg:6,zIndex:10,children:[Object(L.jsx)(N.a,{variant:"h1",children:"MIT CityScope"}),Object(L.jsxs)(N.a,{variant:"h4",children:["MIT CityScope is an open-source urban modeling and simulation platform. CityScope allows users to examine different design alternatives, and observe their impact through multiple layers of urban analytics.",Object(L.jsx)(ye.a,{href:"https://github.com/CityScope",target:"blank",children:"Join the CityScope open-source development"}),"  ",Object(L.jsx)(Ee.a,{fontSize:"small"})]})]})]})]})]})}var De=n(697);function Ne(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(L.jsxs)(L.Fragment,{children:[e&&Object(L.jsx)(M,{tableName:e}),Object(L.jsx)(De.a,{maxWidth:"md",sx:{mt:5,mb:5},children:t&&Object(L.jsx)(ae.a,{})})]})}var Pe=function(t){var e=t.viewState,n=t.setViewState,r=Object.keys(e).map((function(t){return Number.isFinite(e[t])?Object(L.jsx)(ct.a,{id:"outlined-number",label:t,type:"number",value:e[t],onChange:function(r){n(Object(S.a)(Object(S.a)({},e),{},Object(x.a)({},t,parseFloat(r.target.value))))}},t):null}));return Object(L.jsxs)(ft.a,{sx:{component:"form",backgroundColor:"rgba(0,0,0,0.95)","& .MuiTextField-root":{m:2,width:"90%"},bottom:"1vh",left:"1vw",maxWidth:"30%",position:"fixed",zIndex:"tooltip"},noValidate:!0,autoComplete:"off",children:[Object(L.jsx)("div",{children:"Changes are saved automatically. Press [ z ] again to hide."}),Object(L.jsx)("div",{children:r})]})};function Be(t){var e=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),n=e&&e.tui,r=e.GEOGRID.properties.header,a=t.viewStateEditMode,c=t.layers,s=t.editMode,l={active:n&&n.MAP_STYLE&&n.MAP_STYLE.active,style:E.e.map.mapStyle[n&&n.MAP_STYLE&&n.MAP_STYLE.style]||E.e.map.mapStyle.blue},d=Object(o.useState)(),h=Object(i.a)(d,2),f=h[0],p=h[1],b=Object(o.useRef)(null);Object(o.useEffect)((function(){if(document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()})),localStorage.getItem("projectionViewStateStorage")){console.log("loading prev. projectionViewStateStorage...");var t=localStorage.getItem("projectionViewStateStorage");p(JSON.parse(t))}else p(Object(S.a)(Object(S.a)({},f),{},{longitude:r.longitude,latitude:r.latitude,zoom:15,pitch:0,bearing:360-r.rotation,orthographic:!0}))}),[]);return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(At.a,{ref:b,viewState:f,onViewStateChange:function(t){var e=t.viewState;localStorage.setItem("projectionViewStateStorage",JSON.stringify(e)),p(Object(S.a)(Object(S.a)({},e),{},{pitch:0,orthographic:!0}))},layers:c,controller:{},children:!s&&Object(L.jsx)(Mt.c,{active:l.active,width:"100%",height:"100%",mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:l.style})}),a&&f&&Object(L.jsx)(Pe,{setViewState:p,viewState:f})]})}function Fe(t){var e=t.editMode,n=t.viewStateEditMode,r=(t.layersVisibilityControl,Object(u.c)((function(t){return t.cityIOdataState.cityIOdata}))),a=r&&r.tui,c=Object(o.useState)(E.e.map.layers.ABM.startTime),s=Object(i.a)(c,2),l=s[0],d=s[1],h=Object(o.useState)({}),f=Object(i.a)(h,1)[0],p=function t(){d((function(t){return t>E.e.map.layers.ABM.endTime?E.e.map.layers.ABM.startTime:t+E.e.map.layers.ABM.animationSpeed})),f.id=window.requestAnimationFrame(t)};Object(o.useEffect)((function(){return f.id=window.requestAnimationFrame(p),function(){return window.cancelAnimationFrame(f.id)}}),[f]);return Object(L.jsx)(Be,{editMode:e,viewStateEditMode:n,layers:a?[new Vt.a({id:"GRID",visible:a.GRID&&a.GRID.active,data:Object(Bt.b)(r),opacity:.5,extruded:!1,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:1,getFillColor:function(t){return t.properties.color},transitions:{getFillColor:500}}),new Gt.a({id:"ACCESS",visible:a.ACCESS&&a.ACCESS.active,colorRange:[[233,62,58],[237,104,60],[243,144,63]],intensity:1,threshold:.5,data:r.access&&r.access.features,getPosition:function(t){return t.geometry.coordinates},getWeight:function(t){return t.properties[a.ACCESS.toggleArray.curr_active]||0},updateTriggers:{getWeight:a.ACCESS.toggleArray.curr_active}}),new Ft.a({id:"text",visible:a.TEXT&&a.TEXT.active,data:r.GEOGRID&&r.GEOGRID.features,getPosition:function(t){var e=t.geometry.coordinates[0],n=e[1],r=e[e.length-2];return[(n[0]+r[0])/2,(n[1]+r[1])/2]},getText:function(t){return t.properties.name.length>5?t.properties.name.substring(0,2)+"...":t.properties.name},getColor:function(t){return[0,0,0]},getSize:8}),new Nt.a({id:"ABM",visible:a.ABM&&a.ABM.active,data:r.ABM2&&r.ABM2.trips,getColor:function(t){return Object(C.d)(r.ABM2.attr.mode[t.mode].color)},getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},fadeTrail:!0,getWidth:10,trailLength:200,currentTime:l})]:[]})}var ze=n(6),Ve=n(7),Ue=n(14),We=n(15),He=20/1.5,Ye={container:{width:20,height:20,borderRadius:"50%",position:"absolute",border:"1px solid white",cursor:"move"},"top-left":{left:-He,top:-He},"bottom-left":{left:-He,bottom:-He},"top-right":{top:-He,right:-He},"bottom-right":{bottom:-He,right:-He}},Xe=function(t){var e,n=t.position,r=t.translation,a=t.onMouseEnter,i=t.onMouseDown,o=t.onMouseUp,c=t.className,s=void 0===c?"":c,u=t.style,l=void 0===u?{}:u;return Object(L.jsx)("div",{onMouseEnter:function(){return a&&a(n)},onMouseDown:function(t){return i(t,n)},onMouseUp:function(){return o(n)},className:s,style:Object(S.a)(Object(S.a)(Object(S.a)(Object(S.a)({},Ye.container),Ye[n]),l),{},{transform:(e=r,"translate(".concat(e[0],"px, ").concat(e[1],"px)"))})})},Ke=n(517).solve,Je=function(t,e){for(var n=[],r=[],a=0,o=t.length;a<o;++a){var c=Object(i.a)(t[a],2),s=c[0],u=c[1],l=Object(i.a)(e[a],2),d=l[0],h=l[1];n.push([s,u,1,0,0,0,-s*d,-u*d],[0,0,0,s,u,1,-s*h,-u*h]),r.push(d,h)}var f=Ke(n,r,!0);return[f[0],f[3],0,f[6],f[1],f[4],0,f[7],0,0,1,0,f[2],f[5],0,1].map((function(t){return function(t,e){var n=Math.pow(10,e),r=t*n;return Math.round(r)/n}(t,10)}))},qe=function(t){return"matrix3d(".concat(t.join(", "),")")},Qe={position:"relative"},Ze=["top-left","top-right","bottom-right","bottom-left"],$e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tn=function(){var t={};return Ze.forEach((function(e){t[e]=[0,0]})),t},en=function(t){Object(Ue.a)(n,t);var e=Object(We.a)(n);function n(){var t;Object(ze.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).container=void 0,t.layerTranslateDelta=void 0,t.anchorTranslateDelta=void 0,t.isAnchorDragging=!1,t.targetPoints=void 0,t.anchorMoving=void 0,t.state={matrix:$e,translateDelta:tn(),sourcePoints:void 0,transformOrigin:[0,0],containerTranslate:[t.props.x||0,t.props.y||0]},t.onAnchorMouseDown=function(e,n){e.stopPropagation(),t.anchorTranslateDelta=[e.pageX-t.state.translateDelta[n][0],e.pageY-t.state.translateDelta[n][1]],t.anchorMoving=n},t.onAnchorMouseMove=function(e){if(t.anchorTranslateDelta&&t.state.sourcePoints&&t.anchorMoving){e.preventDefault(),e.stopPropagation();var n=Ze.indexOf(t.anchorMoving),r=e.pageX-t.anchorTranslateDelta[0],a=e.pageY-t.anchorTranslateDelta[1];t.targetPoints[n]=[t.state.sourcePoints[n][0]+r,t.state.sourcePoints[n][1]+a],t.setState({matrix:Je(t.state.sourcePoints,t.targetPoints),translateDelta:Object(S.a)(Object(S.a)({},t.state.translateDelta),{},Object(x.a)({},t.anchorMoving,[r,a]))})}},t.onAnchorMouseUp=function(e){t.anchorTranslateDelta=void 0,t.anchorMoving=void 0},t.onMouseUp=function(){t.layerTranslateDelta=void 0},t.onMouseMove=function(e){if(t.layerTranslateDelta&&t.props.isEditMode){var n=[e.pageX-t.layerTranslateDelta[0],e.pageY-t.layerTranslateDelta[1]];t.setState({containerTranslate:n})}},t.onMouseDown=function(e){var n=t.state.containerTranslate;t.layerTranslateDelta=[e.pageX-n[0],e.pageY-n[1]]},t}return Object(Ve.a)(n,[{key:"componentDidMount",value:function(){if(window.addEventListener("mousemove",this.onAnchorMouseMove),window.addEventListener("mousemove",this.onMouseMove),this.container){var t=this.container.getBoundingClientRect(),e=t.width,n=t.height,r=[[0,0],[e-0,0],[e-0,n-0],[0,n-0]];if(this.targetPoints=[].concat(r),this.setState({sourcePoints:r}),localStorage.getItem("projMap")){console.log("loading prev. projMap...");var a=localStorage.getItem("projMap");this.setState(JSON.parse(a))}}}},{key:"componentDidUpdate",value:function(t,e){localStorage.setItem("projMap",JSON.stringify(e))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onAnchorMouseMove),window.removeEventListener("mousemove",this.onMouseMove)}},{key:"render",value:function(){var t,e=this,n=this.props,r=n.style,a=n.isEditMode,i=n.className,o=n.anchorStyle,c=n.anchorClassName,s=this.state,u=s.translateDelta,l=s.matrix,d=s.containerTranslate,h=s.transformOrigin;return Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)("div",{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,style:{cursor:a?"all-scroll":"inherit",position:"relative",display:"inline-block",transform:(t=d,"translate(".concat(t[0],"px, ").concat(t[1],"px)"))},children:[Object(L.jsx)("div",{ref:function(t){e.container=t},style:Object(S.a)(Object(S.a)(Object(S.a)({},Qe),r),{},{pointerEvents:a?"none":"all",transform:qe(l),transformOrigin:"".concat(h[0],"px ").concat(h[1],"px 0px")}),className:i,children:this.props.children}),a&&Object(L.jsx)("div",{children:Ze.map((function(t,n){return Object(L.jsx)(Xe,{style:o,className:c,translation:u[t],position:t,onMouseDown:e.onAnchorMouseDown,onMouseUp:e.onAnchorMouseUp},t)}))})]})})}}]),n}(o.Component);function nn(){return Object(L.jsx)(X.a,{container:!0,alignItems:"center",justify:"center",children:Object(L.jsx)(D.a,{sx:{zIndex:"tooltip",top:"50vh",left:"50vw"},variant:"contained",startIcon:Object(L.jsx)(lt.a,{}),children:"Reset Projection Mapping"})})}function rn(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOdata})),e=t.GEOGRID.properties.header.ncols/t.GEOGRID.properties.header.nrows,n=Object(o.useState)(!1),r=Object(i.a)(n,2),a=r[0],c=r[1],s=Object(o.useState)(!1),l=Object(i.a)(s,2),d=l[0],h=l[1];return Object(o.useEffect)((function(){console.log("Keystone starting...");var t=function(t){var e=t.key;" "===e&&c((function(t){return!t})),"z"===e&&h((function(t){return!t}))};return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}),[]),Object(L.jsxs)(L.Fragment,{children:[a&&Object(L.jsx)("div",{onClick:function(){return localStorage.getItem("projMap")&&localStorage.removeItem("projMap"),localStorage.getItem("projectionViewStateStorage")&&localStorage.removeItem("projectionViewStateStorage"),void window.location.reload()},children:Object(L.jsx)(nn,{})}),Object(L.jsx)("div",{style:{height:"100vh",width:"100vw",overflow:"hidden",position:"fixed",top:0,left:0,zIndex:1e3},children:Object(L.jsx)("div",{children:Object(L.jsx)(en,{style:{height:"100vh",width:"".concat(100*e,"vh"),backgroundColor:a?"rgba(255,0,0)":null},isEditMode:a,children:Object(L.jsx)(Fe,{editMode:a,viewStateEditMode:d})})})})]})}function an(){var t=Object(u.c)((function(t){return t.cityIOdataState.cityIOisDone})),e=Object(u.c)((function(t){return t.cityIOdataState.cityIOtableName}));return Object(L.jsxs)(L.Fragment,{children:[e&&Object(L.jsx)(M,{tableName:e}),t&&Object(L.jsx)(rn,{})]})}function on(t){if(!t.mousePos)return null;var e=t.mousePos,n=t.mouseDown,r=t.selectedType,a=t.divSize,i=e.x-a/2,o=e.y-a/2;return Object(L.jsx)("div",{style:{border:"2px solid",backgroundColor:n?r.color:"rgba(0,0,0,0)",borderColor:r.color,color:r.color,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:a,height:a,left:i||0,top:o||0},children:Object(L.jsx)("div",{style:{position:"relative",left:a+10,fontSize:"0.5em"},children:r.name})})}var cn=Object(l.b)({name:"menuState",initialState:{editorMapCenter:{latitude:E.a.GEOGRID.properties.header.latitude,longitude:E.a.GEOGRID.properties.header.longitude},gridMaker:{},gridProps:{},typesEditorState:{}},reducers:{updateEditorMapCenter:function(t,e){t.editorMapCenter=e.payload},updateGridProps:function(t,e){t.gridProps=e.payload},updateGridMaker:function(t,e){t.gridMaker=e.payload},updateTypesEditorState:function(t,e){t.typesEditorState=e.payload}}}),sn=cn.actions,un=sn.updateEditorMapCenter,ln=sn.updateGridProps,dn=sn.updateGridMaker,hn=sn.updateTypesEditorState,fn=cn.reducer;function pn(){var t=Object(u.b)(),e=Object(o.useState)(),n=Object(i.a)(e,2),r=n[0],a=n[1],c=Object(u.c)((function(t){return t.editorMenuState.typesEditorState.selectedRow})),s=Object(u.c)((function(t){return t.editorMenuState.gridMaker}));Object(o.useEffect)((function(){a(s)}),[s]);var l=Object(u.c)((function(t){return t.editorMenuState.editorMapCenter})),d=Object(o.useRef)(null);Object(o.useEffect)((function(){P(l)}),[l]);var h=Object(o.useState)(E.a.map.initialViewState),f=Object(i.a)(h,2),p=f[0],b=f[1],j=Object(o.useState)(),O=Object(i.a)(j,2),g=O[0],v=O[1],m=Object(o.useState)(),y=Object(i.a)(m,2),x=y[0],w=y[1],I=Object(o.useState)(),_=Object(i.a)(I,2),T=_[0],M=_[1],A=Object(o.useState)(!1),G=Object(i.a)(A,2),k=G[0],R=G[1],D=Object(o.useState)(),N=Object(i.a)(D,1)[0],P=function(t){b(Object(S.a)(Object(S.a)({},p),{},{latitude:t&&t.latCenter||E.a.GEOGRID.properties.header.latitude,longitude:t&&t.lonCenter||E.a.GEOGRID.properties.header.longitude,zoom:15,pitch:0,bearing:0,orthographic:!0}))};Object(o.useEffect)((function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(t){return t.preventDefault()})),P()}),[]);var B=function(t){if(c){var e=c.height,n=c.name,r=c.color,i=c.interactive,o=function(t){var e=t.x-20,n=t.y-20;return d.current.pickObjects({x:e,y:n,width:40,height:40})}(t);o.forEach((function(t,o){var c=Object(S.a)({},t.object.properties);c.color=Object(C.f)(r)?Object(C.d)(r):r,c.height=e,c.name=n,"No"!==i?c.interactive=i:delete c.interactive,a((function(e){return Object(S.a)(Object(S.a)({},e),{},{features:e.features.map((function(e){return t.index===e.properties.id?Object(S.a)(Object(S.a)({},e),{},{properties:c}):e}))})}))}))}};return Object(L.jsxs)("div",{onKeyDown:function(t){v(t.nativeEvent.key)},onKeyUp:function(){v(null)},onMouseMove:function(t){return w(t.nativeEvent)},onMouseUp:function(){t(dn(r)),M(!1)},onMouseDown:function(){return M(!0)},children:[c&&Object(L.jsx)(on,{mousePos:x,selectedType:c,divSize:40,mouseDown:T}),Object(L.jsx)(At.a,{ref:d,viewState:p,onViewStateChange:function(t){var e=t.viewState;b(e)},layers:[new Vt.a({id:"GRID",opacity:.5,stroked:!1,filled:!0,wireframe:!0,visible:!0,pickable:!0,data:r,extruded:!0,lineWidthScale:1,lineWidthMinPixels:1,getElevation:function(t){return t.properties.height[1]},getFillColor:function(t){return t.properties.color},onClick:function(t,e){e.rightButton||"Shift"===g||B(t)},onDrag:function(t,e){e.rightButton||"Shift"===g||B(t)},onDragStart:function(t,e){e.rightButton||"Shift"===g||R(!0)},onDragEnd:function(){R(!1)},updateTriggers:{getFillColor:N,getElevation:N}})],controller:{touchZoom:!0,touchRotate:!0,dragPan:!k,dragRotate:!k,keyboard:!1},children:Object(L.jsx)(Mt.a,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:E.a.map.mapStyle.sat,preventStyleDiffing:!0})})]})}var bn=n(441),jn=n(427),On=n.n(jn);function gn(t){var e=Object(u.b)();return Object(L.jsx)(D.a,{onClick:function(){e(un({latCenter:parseFloat(t.mapCenter[0]),lonCenter:parseFloat(t.mapCenter[1])}))},variant:"outlined",startIcon:Object(L.jsx)(On.a,{}),children:"Center Map to Grid"})}function vn(){var t=E.a,e=Object(u.b)(),n=Object(o.useState)({tableName:t.GEOGRID.properties.header.tableName,latitude:t.GEOGRID.properties.header.latitude,longitude:t.GEOGRID.properties.header.longitude,tz:t.GEOGRID.properties.header.tz,nrows:t.GEOGRID.properties.header.nrows,ncols:t.GEOGRID.properties.header.nrows,rotation:t.GEOGRID.properties.header.rotation,cellSize:t.GEOGRID.properties.header.cellSize,projection:t.GEOGRID.properties.header.projection}),r=Object(i.a)(n,2),a=r[0],c=r[1],s=function(t){var e=t.target,n=e.id,r=e.value;c(Object(S.a)(Object(S.a)({},a),{},Object(x.a)({},n,r)))};return Object(o.useEffect)((function(){e(ln(a))}),[a]),Object(L.jsxs)(R.a,{children:[Object(L.jsx)(A.a,{children:Object(L.jsx)(N.a,{variant:"h4",children:"Project Properties"})}),Object(L.jsx)(A.a,{children:Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"tableName",label:"CityScope Project Name",defaultValue:a.tableName})}),Object(L.jsx)(A.a,{children:Object(L.jsxs)(bn.a,{direction:"row",spacing:1,children:[Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"latitude",label:"Latitude",defaultValue:a.latitude,type:"number"}),Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"longitude",label:"Longitude",defaultValue:a.longitude,type:"number"}),Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"tz",label:"Time Zone (GMT)",defaultValue:a.tz,type:"number"})]})}),Object(L.jsx)(A.a,{children:Object(L.jsx)(gn,{mapCenter:[a.latitude,a.longitude]})}),Object(L.jsx)(A.a,{children:Object(L.jsxs)(bn.a,{direction:"row",spacing:1,children:[Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"nrows",label:"Rows",defaultValue:a.nrows,type:"number",InputProps:{inputProps:{max:100,min:0}}}),Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"ncols",label:"Columns",defaultValue:a.ncols,type:"number",InputProps:{inputProps:{max:100,min:0}}}),Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"rotation",label:"Rotation (deg)",defaultValue:a.rotation,type:"number",InputProps:{inputProps:{max:360,min:0}}}),Object(L.jsx)(ct.a,{onChange:function(t){return s(t)},variant:"outlined",id:"cellSize",label:"Cell Size (m^2)",defaultValue:a.cellSize,type:"number",InputProps:{inputProps:{max:1e3,min:1}}})]})}),Object(L.jsx)(A.a,{children:Object(L.jsx)(ct.a,{size:"small",onChange:function(t){return s(t)},variant:"outlined",id:"projection",label:"Projection",defaultValue:a.projection,type:"string",helperText:"Default projection should work for most CityScope cases. Find specific projections at: https://epsg.io/"})})]})}var mn=n(428),yn=n.n(mn),xn=n(711),Sn=n(259);function wn(t){return t*Math.PI/180}function En(t){return 180*t/Math.PI}var Cn=function(t){var e=Object.keys(t);return t[e[e.length*Math.random()<<0]]};function In(){var t=Object(u.b)(),e=Object(o.useState)(),n=Object(i.a)(e,2),r=n[0],a=n[1],c=Object(o.useState)(!1),s=Object(i.a)(c,2),l=s[0],d=s[1],h=Object(u.c)((function(t){return t.editorMenuState.gridProps})),f=Object(u.c)((function(t){return t.editorMenuState.typesEditorState.tableData}));Object(o.useEffect)((function(){t(dn(r))}),[r]);var p=function(){a(function(t,e){for(var n=parseFloat(t.longitude),r=parseFloat(t.latitude),a=parseFloat(t.rotation),i=t.projection,o=parseFloat(t.cellSize),c=parseFloat(t.nrows),s=parseFloat(t.ncols),u=Sn.a.defs("EPSG:4326"),l={lon:n,lat:r},d=(90-a+360)%360,h=o*s/6371e3,f=wn(l.lat),p=wn(l.lon),b=wn(d),j=Math.asin(Math.sin(f)*Math.cos(h)+Math.cos(f)*Math.sin(h)*Math.cos(b)),O={lon:En(p+Math.atan2(Math.sin(b)*Math.sin(h)*Math.cos(f),Math.cos(h)-Math.sin(f)*Math.sin(j))),lat:En(j)},g=Object(Sn.a)(u,i,[l.lon,l.lat]),v=Object(Sn.a)(u,i,[O.lon,O.lat]),m=(v[1]-g[1])/(v[0]-g[0]),y=Math.atan(m),x=Math.cos(y),S=Math.sin(y),w=[],E=[],I=0;I<c;I++)for(var L=0;L<s;L++)w.push(L*o),E.push(-I*o);for(var _=[],T=[],M=0;M<w.length;M++)_.push(w[M]*x-E[M]*S),T.push(w[M]*S+E[M]*x);for(var A=[],G=[],k=0;k<_.length;k++)A.push(g[0]+_[k]),G.push(g[1]+T[k]);for(var R=A[1]-A[0],D=G[1]-G[0],N=A[s]-A[0],P=G[s]-G[0],B=[],F={type:"FeatureCollection",features:[]},z=e,V=0;V<A.length;V++){for(var U=Cn(z),W={type:"Feature",geometry:{type:"Polygon",coordinates:null},properties:{color:Object(C.d)(U.color),height:U.height,name:U.name,interactive:U.interactive,id:V}},H=[[A[V],G[V]],[A[V]+N,G[V]+P],[A[V]+N+R,G[V]+P+D],[A[V]+R,G[V]+D],[A[V],G[V]]],Y=[],X=0;X<5;X++){var K=Object(Sn.a)(i,u,H[X]);Y.push(K)}W.geometry.coordinates=[Y],B.push(W)}return F.features=B,F}(h,f))};return Object(L.jsx)(L.Fragment,{children:h&&f&&Object(L.jsx)(xn.a,{onClick:function(){d(!0),new Promise((function(t){setTimeout((function(){d(!1),p()}),100),t()}))},loading:l,loadingPosition:"start",variant:"outlined",startIcon:Object(L.jsx)(yn.a,{}),children:"Generate Grid"})})}var Ln=n(429),_n=n.n(Ln),Tn={columns:[{title:"Type",field:"name"},{title:"Description",field:"description"},{title:"Height Min.",field:"height[0]",type:"numeric"},{title:"Height Default",field:"height[1]",type:"numeric"},{title:"Height Max.",field:"height[2]",type:"numeric"},{title:"Interactive",field:"interactive",lookup:{No:"No",Web:"Web",TUI:"TUI"}},{title:"Color",field:"color",type:"string"},{title:"LBCS",field:"LBCS",type:"string"},{title:"NAICS",field:"NAICS",type:"string"}],data:function(t){var e=[];return Object.keys(t).forEach((function(n,r){e.push({id:r,name:n,description:"[edit info for type: "+n+"]",color:t[n].color,height:t[n].height?t[n].height:[0,0,0],LBCS:t[n].LBCS?JSON.stringify(t[n].LBCS):null,NAICS:t[n].NAICS?JSON.stringify(t[n].NAICS):null,interactive:t[n].interactive})})),e}(E.a.GEOGRID.properties.types)};function Mn(){var t=Object(o.useState)(Tn),e=Object(i.a)(t,2),n=e[0],r=e[1],a=Object(u.b)(),c=Object(o.useState)(),s=Object(i.a)(c,2),l=s[0],d=s[1],h=Object(o.useState)(),f=Object(i.a)(h,2),p=f[0],b=f[1];return Object(o.useEffect)((function(){a(hn({tableData:n.data,selectedRow:l,rowColor:p}))}),[n,l,p]),Object(L.jsx)(_n.a,{title:Object(L.jsx)(N.a,{variant:"h4",children:"Types Editor"}),columns:n.columns,data:n.data,options:{paging:!1,search:!0,selection:!1,rowStyle:function(t){return{backgroundColor:l&&l.tableData.id===t.tableData.id?p:null,color:l&&l.tableData.id===t.tableData.id?"black":"white"}}},onRowClick:function(t,e){d(e),b(e.color)},editable:{onRowAdd:function(t){return new Promise((function(e){e(),setTimeout((function(){r((function(e){var n=Object($.a)(e.data);return t.id=n.length,n.push(t),Object(S.a)(Object(S.a)({},e),{},{data:n})}))}),50)}))},onRowUpdate:function(t,e){return new Promise((function(n){n(),setTimeout((function(){e&&r((function(n){var r=Object($.a)(n.data),a=r.map((function(t){return t.id})).indexOf(e.id);return r[a]=t,Object(S.a)(Object(S.a)({},n),{},{data:r})}))}),50)}))}}})}function An(){var t=Object(o.useState)(!1),e=Object(i.a)(t,2),n=e[0],r=e[1],a=Object(o.useState)(),c=Object(i.a)(a,2),s=c[0],l=c[1],d=Object(u.c)((function(t){return t.editorMenuState.gridProps})),h=Object(u.c)((function(t){return t.editorMenuState.typesEditorState.tableData})),f=Object(u.c)((function(t){return t.editorMenuState.gridMaker})),p=f&&f.features&&f.features.length>0,b=function(){var t,e,n=E.a.GEOGRID,r=f.features,a=function(t,e,n,r){var a=Object(S.a)({},t),i={};return e.forEach((function(t){i[t.name]=Object(S.a)({},t),i[t.name].LBCS="string"===typeof t.LBCS?JSON.parse(t.LBCS):t.LBCS,i[t.name].NAICS="string"===typeof t.NAICS?JSON.parse(t.NAICS):t.NAICS})),a.properties.types=i,a.properties.header=Object(S.a)({},r),["longitude","latitude","rotation","nrows","ncols","cellSize"].forEach((function(t){a.properties.header[t]=parseFloat(a.properties.header[t])})),a.features=n,a}(n,h,r,d),i=function(t){var e=[];return t.forEach((function(t){e.push(t.properties)})),e}(r),o=a.properties.header.tableName.toLowerCase(),c="".concat(E.b.cityIO.baseURL,"table/").concat(o,"/"),s={GEOGRID:a,GEOGRIDDATA:i};Oe()((t=c,e=s,{method:"post",url:t,data:e,headers:{"Content-Type":"application/json",Accept:"application/json"}})).then((function(t){l(function(t,e){var n="https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+e;return Object(L.jsxs)(N.a,{color:"textPrimary",variant:"caption",children:["CityIO is ",t.data.status,". Grid deployed to"," ",Object(L.jsx)(ye.a,{color:"textSecondary",href:n,children:n})]})}(t,o))})).catch((function(t){return console.log("ERROR: ".concat(t))}))};return Object(L.jsx)(L.Fragment,{children:p&&Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(xn.a,{onClick:function(){r(!0),new Promise((function(t){setTimeout((function(){r(!1),b()}),1500),t()}))},loading:n,loadingPosition:"start",variant:"outlined",startIcon:Object(L.jsx)(yt.a,{}),children:"Commit Grid to cityIO"}),Object(L.jsxs)("div",{style:{width:"100%"},children:[" ",s]})]})})}function Gn(){var t=[Object(L.jsx)(N.a,{variant:"h2",children:"CityScope Grid Editor"}),Object(L.jsx)(N.a,{children:"This editor can create and `commit` spatial layouts (`grids`) as a baseline for CityScope projects. Use the menus and map to edit girds, types, and props, and commit them to cityIO."}),Object(L.jsx)(vn,{}),Object(L.jsxs)(X.a,{container:!0,spacing:2,children:[Object(L.jsx)(X.a,{item:!0,children:Object(L.jsx)(In,{})}),Object(L.jsx)(X.a,{item:!0,children:Object(L.jsx)(An,{})})]}),Object(L.jsx)(Mn,{})],e=function(){var e=[];return t.forEach((function(t,n){e.push(Object(L.jsx)(A.a,{children:Object(L.jsx)(G.a,{variant:"outlined",sx:{width:"100%"},children:Object(L.jsx)(k.a,{children:t})})},n))})),e};return Object(L.jsx)(Ot,{direction:"left",width:500,children:Object(L.jsx)(R.a,{children:Object(L.jsx)(e,{})})})}function kn(){return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(Gn,{}),Object(L.jsx)(pn,{})]})}var Rn=function(){var t=Object(u.b)(),e=Object(o.useState)(),n=Object(i.a)(e,2),r=n[0],a=n[1];Object(o.useEffect)((function(){document.title=r?"CityScopeJS | ".concat(r):"CityScopeJS"}),[r]);var l=Object(o.useState)(),d=Object(i.a)(l,2),h=d[0],f=d[1],p=function(e,n){var r=n&&n.toLowerCase();r&&""!==r?(a(r),t(b(r)),f(e)):f("cityio")};return Object(o.useEffect)((function(){var t=window.location,e=g.a.parse(t.search),n=Object.keys(e);n.includes("cityscope")?p("cityscopejs",e.cityscope):n.includes("projection")?p("projection",e.projection):n.includes("render")?p("render",e.render):n.includes("editor")?f("grideditor"):f("cityio")}),[]),Object(L.jsxs)(s.a,{theme:y,children:[Object(L.jsx)(c.a,{}),Object(L.jsxs)(L.Fragment,{children:["cityscopejs"===h&&Object(L.jsx)(he,{}),"grideditor"===h&&Object(L.jsx)(kn,{}),"cityio"===h&&Object(L.jsx)(Re,{}),"projection"===h&&Object(L.jsx)(an,{}),"render"===h&&Object(L.jsx)(Ne,{})]})]})},Dn=n(76),Nn=Object(Dn.c)({cityIOdataState:j,menuState:H,editorMenuState:fn}),Pn=Object(l.a)({reducer:Nn});a.a.render(Object(L.jsx)(L.Fragment,{children:Object(L.jsx)(u.a,{store:Pn,children:Object(L.jsx)(Rn,{})})}),document.getElementById("root"))}},[[586,1,2]]]);
//# sourceMappingURL=main.7fe19d83.chunk.js.map